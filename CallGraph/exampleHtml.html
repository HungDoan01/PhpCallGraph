<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>My Project: WordPress/wp-admin/includes/upgrade.php File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('includes_2upgrade_8php.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">upgrade.php File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="includes_2upgrade_8php_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespace_word_press"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_word_press.html">WordPress</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac5fd71d697cebc747e03eb3f7159bb75"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75">upgrade_all</a> ()</td></tr>
<tr class="separator:ac5fd71d697cebc747e03eb3f7159bb75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9f9f0f1c15e3c295fbe0eea4fcad01b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#ac9f9f0f1c15e3c295fbe0eea4fcad01b">upgrade_100</a> ()</td></tr>
<tr class="separator:ac9f9f0f1c15e3c295fbe0eea4fcad01b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e6d4fb5df8f86dc0aafa740bf1dfe60"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a6e6d4fb5df8f86dc0aafa740bf1dfe60">upgrade_101</a> ()</td></tr>
<tr class="separator:a6e6d4fb5df8f86dc0aafa740bf1dfe60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe18c72dcd93806bfefc8bde68fccd8a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#afe18c72dcd93806bfefc8bde68fccd8a">upgrade_110</a> ()</td></tr>
<tr class="separator:afe18c72dcd93806bfefc8bde68fccd8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1681e2b2e9fc1c0ebaa20a05c278067"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#aa1681e2b2e9fc1c0ebaa20a05c278067">upgrade_130</a> ()</td></tr>
<tr class="separator:aa1681e2b2e9fc1c0ebaa20a05c278067"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fb25174b5e402c9666da33248094bfe"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a3fb25174b5e402c9666da33248094bfe">upgrade_160</a> ()</td></tr>
<tr class="separator:a3fb25174b5e402c9666da33248094bfe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab67ca7d2045305d3847acdc086ffae3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#aab67ca7d2045305d3847acdc086ffae3">upgrade_210</a> ()</td></tr>
<tr class="separator:aab67ca7d2045305d3847acdc086ffae3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2592de93ead8b5ad27d0c4881f04d4c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#ae2592de93ead8b5ad27d0c4881f04d4c">upgrade_230</a> ()</td></tr>
<tr class="separator:ae2592de93ead8b5ad27d0c4881f04d4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8bbabcdc52ae172d75e457cab5aed16b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a8bbabcdc52ae172d75e457cab5aed16b">upgrade_230_options_table</a> ()</td></tr>
<tr class="separator:a8bbabcdc52ae172d75e457cab5aed16b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27bc17575990d42ea587d1473b2344a5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a27bc17575990d42ea587d1473b2344a5">upgrade_230_old_tables</a> ()</td></tr>
<tr class="separator:a27bc17575990d42ea587d1473b2344a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5d2c7b121d8c5a2936b991c31739be7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#af5d2c7b121d8c5a2936b991c31739be7">upgrade_old_slugs</a> ()</td></tr>
<tr class="separator:af5d2c7b121d8c5a2936b991c31739be7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8de9897e7cf8de14bb1d857f63d7eb31"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a8de9897e7cf8de14bb1d857f63d7eb31">upgrade_250</a> ()</td></tr>
<tr class="separator:a8de9897e7cf8de14bb1d857f63d7eb31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa067f5e7c95f1f875412140fc6c3b0c6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#aa067f5e7c95f1f875412140fc6c3b0c6">upgrade_252</a> ()</td></tr>
<tr class="separator:aa067f5e7c95f1f875412140fc6c3b0c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad54593aefc766c0b0070e2d4d09d9b6b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#ad54593aefc766c0b0070e2d4d09d9b6b">upgrade_260</a> ()</td></tr>
<tr class="separator:ad54593aefc766c0b0070e2d4d09d9b6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a368ab1a3cf990a5d56d850ebf43134e3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a368ab1a3cf990a5d56d850ebf43134e3">upgrade_270</a> ()</td></tr>
<tr class="separator:a368ab1a3cf990a5d56d850ebf43134e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0070e44c50c79d7fd455a3b1ea6f13d9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a0070e44c50c79d7fd455a3b1ea6f13d9">upgrade_280</a> ()</td></tr>
<tr class="separator:a0070e44c50c79d7fd455a3b1ea6f13d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a657edc069a4c61d359944a04164a7ee3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a657edc069a4c61d359944a04164a7ee3">upgrade_290</a> ()</td></tr>
<tr class="separator:a657edc069a4c61d359944a04164a7ee3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b4be04ded870faab3352e69cb616b04"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a5b4be04ded870faab3352e69cb616b04">upgrade_300</a> ()</td></tr>
<tr class="separator:a5b4be04ded870faab3352e69cb616b04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a308cd978af2b74dfdf5ebfac83df9b3e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a308cd978af2b74dfdf5ebfac83df9b3e">upgrade_330</a> ()</td></tr>
<tr class="separator:a308cd978af2b74dfdf5ebfac83df9b3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a718607ec4fb72257807ec66ae24b503e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a718607ec4fb72257807ec66ae24b503e">upgrade_340</a> ()</td></tr>
<tr class="separator:a718607ec4fb72257807ec66ae24b503e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d099d53ff8846ac3d0e0ad7069b052b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a8d099d53ff8846ac3d0e0ad7069b052b">upgrade_350</a> ()</td></tr>
<tr class="separator:a8d099d53ff8846ac3d0e0ad7069b052b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab30e0db0ffe1bede090b8e6b8f116db9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#ab30e0db0ffe1bede090b8e6b8f116db9">upgrade_network</a> ()</td></tr>
<tr class="separator:ab30e0db0ffe1bede090b8e6b8f116db9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac900ebb6c033deed947b02120cea6f98"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#ac900ebb6c033deed947b02120cea6f98">maybe_create_table</a> ($table_name, $create_ddl)</td></tr>
<tr class="separator:ac900ebb6c033deed947b02120cea6f98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a803e9c6735f71e763ab18bd8bdc630ab"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a803e9c6735f71e763ab18bd8bdc630ab">drop_index</a> ($table, $index)</td></tr>
<tr class="separator:a803e9c6735f71e763ab18bd8bdc630ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef14f769511df2c27368d9f7df68eaa4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a> ($table, $index)</td></tr>
<tr class="separator:aef14f769511df2c27368d9f7df68eaa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4af9a7ccd99686b9d07aa3e0aa9e2444"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a4af9a7ccd99686b9d07aa3e0aa9e2444">maybe_add_column</a> ($table_name, $column_name, $create_ddl)</td></tr>
<tr class="separator:a4af9a7ccd99686b9d07aa3e0aa9e2444"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a23ab0934c3f2e5618f931a4ea4c483"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a0a23ab0934c3f2e5618f931a4ea4c483">get_alloptions_110</a> ()</td></tr>
<tr class="separator:a0a23ab0934c3f2e5618f931a4ea4c483"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a913d174175f69bd5da3dba3288acc2b1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a> ($setting)</td></tr>
<tr class="separator:a913d174175f69bd5da3dba3288acc2b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd6d5e27da310b6ded125a7ab130e336"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a> ($content)</td></tr>
<tr class="separator:afd6d5e27da310b6ded125a7ab130e336"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a036ba9e030cb4feddc2022ac115784f7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7">dbDelta</a> ($queries= '', $execute=<a class="el" href="wp-admin_2update_8php.html#acee70dddc295c43a0e60fb7e01e8c15e">true</a>)</td></tr>
<tr class="separator:a036ba9e030cb4feddc2022ac115784f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab68f6b47e715e99c6e5664a41e4a2333"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#ab68f6b47e715e99c6e5664a41e4a2333">make_db_current</a> ($tables= 'all')</td></tr>
<tr class="separator:ab68f6b47e715e99c6e5664a41e4a2333"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb3f1e7966cc172decd9b3f6d84d82b5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#adb3f1e7966cc172decd9b3f6d84d82b5">make_db_current_silent</a> ($tables= 'all')</td></tr>
<tr class="separator:adb3f1e7966cc172decd9b3f6d84d82b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a278f8eaf153a74f3348fe92d16e044d2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a278f8eaf153a74f3348fe92d16e044d2">make_site_theme_from_oldschool</a> ($theme_name, $template)</td></tr>
<tr class="separator:a278f8eaf153a74f3348fe92d16e044d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0771fe384061bbaf9ab5c6ff7bff1f93"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a0771fe384061bbaf9ab5c6ff7bff1f93">make_site_theme_from_default</a> ($theme_name, $template)</td></tr>
<tr class="separator:a0771fe384061bbaf9ab5c6ff7bff1f93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabe08bc33812c096cbe094c1fa7c95ef"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#aabe08bc33812c096cbe094c1fa7c95ef">make_site_theme</a> ()</td></tr>
<tr class="separator:aabe08bc33812c096cbe094c1fa7c95ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80fbc8c3883ba92927aebc7a131d2cc3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a80fbc8c3883ba92927aebc7a131d2cc3">translate_level_to_role</a> ($level)</td></tr>
<tr class="separator:a80fbc8c3883ba92927aebc7a131d2cc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2559abc904c6b5dacc954e4589d450a2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a2559abc904c6b5dacc954e4589d450a2">wp_check_mysql_version</a> ()</td></tr>
<tr class="separator:a2559abc904c6b5dacc954e4589d450a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fb4ce36d884c19a927a8f6d0c9128a3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a1fb4ce36d884c19a927a8f6d0c9128a3">maybe_disable_automattic_widgets</a> ()</td></tr>
<tr class="separator:a1fb4ce36d884c19a927a8f6d0c9128a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcaf2c635c689728811b6cadec1ba7c7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#abcaf2c635c689728811b6cadec1ba7c7">maybe_disable_link_manager</a> ()</td></tr>
<tr class="separator:abcaf2c635c689728811b6cadec1ba7c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4123a7eed5c3db1e2e471e636e7f4019"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#a4123a7eed5c3db1e2e471e636e7f4019">pre_schema_upgrade</a> ()</td></tr>
<tr class="separator:a4123a7eed5c3db1e2e471e636e7f4019"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aad8d91e6a86c1c561f1ed66bc19e5a63"><td class="memItemLeft" align="right" valign="top"><a class="el" href="xmlrpc_8php.html#a2167f8b1a4e7f342493af006894c9036">if</a>(!function_exists('wp_install'))($blog_title, <br class="typebreak" />
$user_name, $user_email, <br class="typebreak" />
$public, $deprecated= <br class="typebreak" />
'', $user_password= '')&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a></td></tr>
<tr class="separator:aad8d91e6a86c1c561f1ed66bc19e5a63"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a913d174175f69bd5da3dba3288acc2b1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__get_option </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$setting</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Version of get_option that is private to install/upgrade.</p>
<dl class="section since"><dt>Since</dt><dd>1.5.1  private</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$setting</td><td>Option name. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>mixed </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01413">1413</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="wp-admin_2index_8php_source.html#l00114">$option</a>, <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="wp-includes_2functions_8php_source.html#l00230">maybe_unserialize()</a>, and <a class="el" href="formatting_8php_source.html#l01407">untrailingslashit()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l01848">make_site_theme()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01784">make_site_theme_from_default()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01705">make_site_theme_from_oldschool()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01937">maybe_disable_automattic_widgets()</a>, <a class="el" href="schema_8php_source.html#l00329">populate_options()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00549">upgrade_130()</a>, and <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                                {</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="keywordflow">if</span> ( $setting == <span class="stringliteral">&#39;home&#39;</span> &amp;&amp; defined( <span class="stringliteral">&#39;WP_HOME&#39;</span> ) )</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72">untrailingslashit</a>( WP_HOME );</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="keywordflow">if</span> ( $setting == <span class="stringliteral">&#39;siteurl&#39;</span> &amp;&amp; defined( <span class="stringliteral">&#39;WP_SITEURL&#39;</span> ) )</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72">untrailingslashit</a>( WP_SITEURL );</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <a class="code" href="wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> = $wpdb-&gt;get_var( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT option_value FROM $wpdb-&gt;options WHERE option_name = %s&quot;</span>, $setting ) );</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;home&#39;</span> == $setting &amp;&amp; <span class="stringliteral">&#39;&#39;</span> == <a class="code" href="wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> )</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>( <span class="stringliteral">&#39;siteurl&#39;</span> );</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;siteurl&#39;</span> == $setting || <span class="stringliteral">&#39;home&#39;</span> == $setting || <span class="stringliteral">&#39;category_base&#39;</span> == $setting || <span class="stringliteral">&#39;tag_base&#39;</span> == $setting )</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        <a class="code" href="wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> = <a class="code" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72">untrailingslashit</a>( <a class="code" href="wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> );</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4">maybe_unserialize</a>( <a class="code" href="wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> );</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;}</div>
<div class="ttc" id="formatting_8php_html_ab99d2b875428a3172f6ea9d4d2e33e72"><div class="ttname"><a href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72">untrailingslashit</a></div><div class="ttdeci">untrailingslashit($string)</div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l01407">formatting.php:1407</a></div></div>
<div class="ttc" id="wp-includes_2functions_8php_html_a3c69a81464e61cfafd41fc129b6df2d4"><div class="ttname"><a href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4">maybe_unserialize</a></div><div class="ttdeci">maybe_unserialize($original)</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2functions_8php_source.html#l00230">functions.php:230</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a913d174175f69bd5da3dba3288acc2b1"><div class="ttname"><a href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a></div><div class="ttdeci">__get_option($setting)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01413">upgrade.php:1413</a></div></div>
<div class="ttc" id="wp-admin_2index_8php_html_a3691fb4ac25261a9b1efa1fd6d58923b"><div class="ttname"><a href="wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a></div><div class="ttdeci">if(has_action( 'welcome_panel')&amp;&amp;current_user_can( 'edit_theme_options')) $option</div><div class="ttdef"><b>Definition:</b> <a href="wp-admin_2index_8php_source.html#l00114">index.php:114</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a913d174175f69bd5da3dba3288acc2b1_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a913d174175f69bd5da3dba3288acc2b1_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a913d174175f69bd5da3dba3288acc2b1_cgraph" id="includes_2upgrade_8php_a913d174175f69bd5da3dba3288acc2b1_cgraph">
<area shape="rect" id="node2" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="149,5,280,32"/><area shape="rect" id="node4" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="159,56,271,83"/><area shape="rect" id="node3" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="328,5,423,32"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a913d174175f69bd5da3dba3288acc2b1_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a913d174175f69bd5da3dba3288acc2b1_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a913d174175f69bd5da3dba3288acc2b1_icgraph" id="includes_2upgrade_8php_a913d174175f69bd5da3dba3288acc2b1_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#aabe08bc33812c096cbe094c1fa7c95ef" title="make_site_theme" alt="" coords="381,77,506,104"/><area shape="rect" id="node3" href="includes_2upgrade_8php.html#aa1681e2b2e9fc1c0ebaa20a05c278067" title="upgrade_130" alt="" coords="598,168,694,194"/><area shape="rect" id="node4" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="792,246,880,273"/><area shape="rect" id="node5" href="includes_2upgrade_8php.html#a0771fe384061bbaf9ab5c6ff7bff1f93" title="make_site_theme_from\l_default" alt="" coords="149,36,307,78"/><area shape="rect" id="node6" href="includes_2upgrade_8php.html#a278f8eaf153a74f3348fe92d16e044d2" title="make_site_theme_from\l_oldschool" alt="" coords="149,102,307,143"/><area shape="rect" id="node7" href="includes_2upgrade_8php.html#a1fb4ce36d884c19a927a8f6d0c9128a3" title="maybe_disable_automattic\l_widgets" alt="" coords="355,270,532,311"/><area shape="rect" id="node8" href="schema_8php.html#abcd0383676547c96be6f8bf8208cc545" title="populate_options" alt="" coords="168,336,288,362"/><area shape="rect" id="node9" href="ms-functions_8php.html#a57320b11a05ba7c9bbc64ac1ddb44186" title="install_blog" alt="" coords="400,386,487,413"/><area shape="rect" id="node10" href="ms-functions_8php.html#a3dbc754495e11e28ca33a009a8e4061a" title="create_empty_blog" alt="" coords="580,386,712,413"/><area shape="rect" id="node11" href="ms-functions_8php.html#a94df666e8946aa4e4ed6a1e9bde7d7c0" title="wpmu_create_blog" alt="" coords="581,437,711,464"/><area shape="rect" id="node12" href="ms-functions_8php.html#a41820c535b4be9fce06c03595d6ca14a" title="wpmu_activate_signup" alt="" coords="760,437,912,464"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aef14f769511df2c27368d9f7df68eaa4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">add_clean_index </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>{ </p>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01353">1353</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, and <a class="el" href="includes_2upgrade_8php_source.html#l01330">drop_index()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00471">upgrade_101()</a>.</p>
<div class="fragment"><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                                         {</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#a803e9c6735f71e763ab18bd8bdc630ab">drop_index</a>($table, $index);</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE `$table` ADD INDEX ( `$index` )&quot;</span>);</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;}</div>
<div class="ttc" id="includes_2upgrade_8php_html_a803e9c6735f71e763ab18bd8bdc630ab"><div class="ttname"><a href="includes_2upgrade_8php.html#a803e9c6735f71e763ab18bd8bdc630ab">drop_index</a></div><div class="ttdeci">drop_index($table, $index)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01330">upgrade.php:1330</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_aef14f769511df2c27368d9f7df68eaa4_cgraph.png" border="0" usemap="#includes_2upgrade_8php_aef14f769511df2c27368d9f7df68eaa4_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_aef14f769511df2c27368d9f7df68eaa4_cgraph" id="includes_2upgrade_8php_aef14f769511df2c27368d9f7df68eaa4_cgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#a803e9c6735f71e763ab18bd8bdc630ab" title="drop_index" alt="" coords="172,5,257,32"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_aef14f769511df2c27368d9f7df68eaa4_icgraph.png" border="0" usemap="#includes_2upgrade_8php_aef14f769511df2c27368d9f7df68eaa4_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_aef14f769511df2c27368d9f7df68eaa4_icgraph" id="includes_2upgrade_8php_aef14f769511df2c27368d9f7df68eaa4_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#a6e6d4fb5df8f86dc0aafa740bf1dfe60" title="upgrade_101" alt="" coords="172,5,268,32"/><area shape="rect" id="node3" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="316,5,404,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a036ba9e030cb4feddc2022ac115784f7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">dbDelta </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$queries</em> = <code>''</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$execute</em> = <code><a class="el" href="wp-admin_2update_8php.html#acee70dddc295c43a0e60fb7e01e8c15e">true</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>{ </p>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01471">1471</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="load-scripts_8php_source.html#l00037">apply_filters()</a>, <a class="el" href="wp-includes_2functions_8php_source.html#l03293">is_main_site()</a>, and <a class="el" href="schema_8php_source.html#l00031">wp_get_db_schema()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l01676">make_db_current()</a>, and <a class="el" href="includes_2upgrade_8php_source.html#l01690">make_db_current_silent()</a>.</p>
<div class="fragment"><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                                                   {</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="keywordflow">if</span> ( in_array( $queries, array( <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;all&#39;</span>, <span class="stringliteral">&#39;blog&#39;</span>, <span class="stringliteral">&#39;global&#39;</span>, <span class="stringliteral">&#39;ms_global&#39;</span> ), <span class="keyword">true</span> ) )</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;        $queries = <a class="code" href="schema_8php.html#a69d44db5129b85c08fa02666649039b1">wp_get_db_schema</a>( $queries );</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="comment">// Separate individual queries into an array</span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    <span class="keywordflow">if</span> ( !is_array($queries) ) {</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        $queries = explode( <span class="charliteral">&#39;;&#39;</span>, $queries );</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        $queries = array_filter( $queries );</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    }</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    $queries = <a class="code" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;dbdelta_queries&#39;</span>, $queries );</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    $cqueries = array(); <span class="comment">// Creation Queries</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    $iqueries = array(); <span class="comment">// Insertion Queries</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    $for_update = array();</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="comment">// Create a tablename index for an array ($cqueries) of queries</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    <span class="keywordflow">foreach</span>($queries as $qry) {</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;|CREATE TABLE ([^ ]*)|&quot;</span>, $qry, $matches)) {</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;            $cqueries[ trim( $matches[1], <span class="charliteral">&#39;`&#39;</span> ) ] = $qry;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;            $for_update[$matches[1]] = <span class="stringliteral">&#39;Created table &#39;</span>.$matches[1];</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;|CREATE DATABASE ([^ ]*)|&quot;</span>, $qry, $matches)) {</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;            array_unshift($cqueries, $qry);</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;|INSERT INTO ([^ ]*)|&quot;</span>, $qry, $matches)) {</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            $iqueries[] = $qry;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;|UPDATE ([^ ]*)|&quot;</span>, $qry, $matches)) {</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;            $iqueries[] = $qry;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;            <span class="comment">// Unrecognized query type</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        }</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    }</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    $cqueries = <a class="code" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;dbdelta_create_queries&#39;</span>, $cqueries );</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    $iqueries = <a class="code" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;dbdelta_insert_queries&#39;</span>, $iqueries );</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    $global_tables = $wpdb-&gt;tables( <span class="stringliteral">&#39;global&#39;</span> );</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="keywordflow">foreach</span> ( $cqueries as $table =&gt; $qry ) {</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        <span class="comment">// Upgrade global tables only for the main site. Don&#39;t upgrade at all if DO_NOT_UPGRADE_GLOBAL_TABLES is defined.</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        <span class="keywordflow">if</span> ( in_array( $table, $global_tables ) &amp;&amp; ( !<a class="code" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a>() || defined( <span class="stringliteral">&#39;DO_NOT_UPGRADE_GLOBAL_TABLES&#39;</span> ) ) )</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        <span class="comment">// Fetch the table column structure from the database</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        $wpdb-&gt;suppress_errors();</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        $tablefields = $wpdb-&gt;get_results(<span class="stringliteral">&quot;DESCRIBE {$table};&quot;</span>);</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        $wpdb-&gt;suppress_errors( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        <span class="keywordflow">if</span> ( ! $tablefields )</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        <span class="comment">// Clear the field and index arrays</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        $cfields = $indices = array();</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        <span class="comment">// Get all of the field names in the query from between the parens</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        preg_match(<span class="stringliteral">&quot;|\((.*)\)|ms&quot;</span>, $qry, $match2);</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        $qryline = trim($match2[1]);</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        <span class="comment">// Separate field lines into an array</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        $flds = explode(<span class="stringliteral">&quot;\n&quot;</span>, $qryline);</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        <span class="comment">//echo &quot;&lt;hr/&gt;&lt;pre&gt;\n&quot;.print_r(strtolower($table), true).&quot;:\n&quot;.print_r($cqueries, true).&quot;&lt;/pre&gt;&lt;hr/&gt;&quot;;</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        <span class="comment">// For every field line specified in the query</span></div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        <span class="keywordflow">foreach</span> ($flds as $fld) {</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;            <span class="comment">// Extract the field name</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            preg_match(<span class="stringliteral">&quot;|^([^ ]*)|&quot;</span>, trim($fld), $fvals);</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;            $fieldname = trim( $fvals[1], <span class="charliteral">&#39;`&#39;</span> );</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;            <span class="comment">// Verify the found field name</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;            $validfield = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;            <span class="keywordflow">switch</span> (strtolower($fieldname)) {</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;&#39;</span>:</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;primary&#39;</span>:</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;index&#39;</span>:</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;fulltext&#39;</span>:</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;unique&#39;</span>:</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;key&#39;</span>:</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;                $validfield = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;                $indices[] = trim(trim($fld), <span class="stringliteral">&quot;, \n&quot;</span>);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;            }</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;            $fld = trim($fld);</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;            <span class="comment">// If it&#39;s a valid field, add it to the field array</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;            <span class="keywordflow">if</span> ($validfield) {</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;                $cfields[strtolower($fieldname)] = trim($fld, <span class="stringliteral">&quot;, \n&quot;</span>);</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;            }</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;        }</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        <span class="comment">// For every field in the table</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;        <span class="keywordflow">foreach</span> ($tablefields as $tablefield) {</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;            <span class="comment">// If the table field exists in the field array...</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;            <span class="keywordflow">if</span> (array_key_exists(strtolower($tablefield-&gt;Field), $cfields)) {</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;                <span class="comment">// Get the field type from the query</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                preg_match(<span class="stringliteral">&quot;|&quot;</span>.$tablefield-&gt;Field.<span class="stringliteral">&quot; ([^ ]*( unsigned)?)|i&quot;</span>, $cfields[strtolower($tablefield-&gt;Field)], $matches);</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                $fieldtype = $matches[1];</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                <span class="comment">// Is actual field type different from the field type in query?</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;                <span class="keywordflow">if</span> ($tablefield-&gt;Type != $fieldtype) {</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                    <span class="comment">// Add a query to change the column type</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                    $cqueries[] = <span class="stringliteral">&quot;ALTER TABLE {$table} CHANGE COLUMN {$tablefield-&gt;Field} &quot;</span> . $cfields[strtolower($tablefield-&gt;Field)];</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                    $for_update[$table.<span class="charliteral">&#39;.&#39;</span>.$tablefield-&gt;Field] = <span class="stringliteral">&quot;Changed type of {$table}.{$tablefield-&gt;Field} from {$tablefield-&gt;Type} to {$fieldtype}&quot;</span>;</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                }</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                <span class="comment">// Get the default value from the array</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                    <span class="comment">//echo &quot;{$cfields[strtolower($tablefield-&gt;Field)]}&lt;br&gt;&quot;;</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;| DEFAULT &#39;(.*?)&#39;|i&quot;</span>, $cfields[strtolower($tablefield-&gt;Field)], $matches)) {</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                    $default_value = $matches[1];</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                    <span class="keywordflow">if</span> ($tablefield-&gt;Default != $default_value) {</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                        <span class="comment">// Add a query to change the column&#39;s default value</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                        $cqueries[] = <span class="stringliteral">&quot;ALTER TABLE {$table} ALTER COLUMN {$tablefield-&gt;Field} SET DEFAULT &#39;{$default_value}&#39;&quot;</span>;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                        $for_update[$table.<span class="charliteral">&#39;.&#39;</span>.$tablefield-&gt;Field] = <span class="stringliteral">&quot;Changed default value of {$table}.{$tablefield-&gt;Field} from {$tablefield-&gt;Default} to {$default_value}&quot;</span>;</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                    }</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                }</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                <span class="comment">// Remove the field from the array (so it&#39;s not added)</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                unset($cfields[strtolower($tablefield-&gt;Field)]);</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                <span class="comment">// This field exists in the table, but not in the creation queries?</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;            }</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        }</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        <span class="comment">// For every remaining field specified for the table</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        <span class="keywordflow">foreach</span> ($cfields as $fieldname =&gt; $fielddef) {</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;            <span class="comment">// Push a query line into $cqueries that adds the field to that table</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;            $cqueries[] = <span class="stringliteral">&quot;ALTER TABLE {$table} ADD COLUMN $fielddef&quot;</span>;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;            $for_update[$table.<span class="charliteral">&#39;.&#39;</span>.$fieldname] = <span class="stringliteral">&#39;Added column &#39;</span>.$table.<span class="charliteral">&#39;.&#39;</span>.$fieldname;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;        }</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;        <span class="comment">// Index stuff goes here</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        <span class="comment">// Fetch the table index structure from the database</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        $tableindices = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SHOW INDEX FROM {$table};&quot;</span>);</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        <span class="keywordflow">if</span> ($tableindices) {</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;            <span class="comment">// Clear the index array</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;            unset($index_ary);</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;            <span class="comment">// For every index in the table</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;            <span class="keywordflow">foreach</span> ($tableindices as $tableindex) {</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                <span class="comment">// Add the index to the index data array</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;                $keyname = $tableindex-&gt;Key_name;</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                $index_ary[$keyname][<span class="stringliteral">&#39;columns&#39;</span>][] = array(<span class="stringliteral">&#39;fieldname&#39;</span> =&gt; $tableindex-&gt;Column_name, <span class="stringliteral">&#39;subpart&#39;</span> =&gt; $tableindex-&gt;Sub_part);</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;                $index_ary[$keyname][<span class="stringliteral">&#39;unique&#39;</span>] = ($tableindex-&gt;Non_unique == 0)?<span class="keyword">true</span>:<span class="keyword">false</span>;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            }</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;            <span class="comment">// For each actual index in the index array</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;            <span class="keywordflow">foreach</span> ($index_ary as $index_name =&gt; $index_data) {</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                <span class="comment">// Build a create string to compare to the query</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;                $index_string = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;                <span class="keywordflow">if</span> ($index_name == <span class="stringliteral">&#39;PRIMARY&#39;</span>) {</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;                    $index_string .= <span class="stringliteral">&#39;PRIMARY &#39;</span>;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>($index_data[<span class="stringliteral">&#39;unique&#39;</span>]) {</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                    $index_string .= <span class="stringliteral">&#39;UNIQUE &#39;</span>;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                }</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                $index_string .= <span class="stringliteral">&#39;KEY &#39;</span>;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                <span class="keywordflow">if</span> ($index_name != <span class="stringliteral">&#39;PRIMARY&#39;</span>) {</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                    $index_string .= $index_name;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                }</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                $index_columns = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                <span class="comment">// For each column in the index</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                <span class="keywordflow">foreach</span> ($index_data[<span class="stringliteral">&#39;columns&#39;</span>] as $column_data) {</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                    <span class="keywordflow">if</span> ($index_columns != <span class="stringliteral">&#39;&#39;</span>) $index_columns .= <span class="charliteral">&#39;,&#39;</span>;</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                    <span class="comment">// Add the field to the column list string</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                    $index_columns .= $column_data[<span class="stringliteral">&#39;fieldname&#39;</span>];</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                    <span class="keywordflow">if</span> ($column_data[<span class="stringliteral">&#39;subpart&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;                        $index_columns .= <span class="charliteral">&#39;(&#39;</span>.$column_data[<span class="stringliteral">&#39;subpart&#39;</span>].<span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                    }</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                }</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;                <span class="comment">// Add the column list to the index create string</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;                $index_string .= <span class="stringliteral">&#39; (&#39;</span>.$index_columns.<span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;                <span class="keywordflow">if</span> (!(($aindex = array_search($index_string, $indices)) === <span class="keyword">false</span>)) {</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;                    unset($indices[$aindex]);</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                    <span class="comment">//echo &quot;&lt;pre style=\&quot;border:1px solid #ccc;margin-top:5px;\&quot;&gt;{$table}:&lt;br /&gt;Found index:&quot;.$index_string.&quot;&lt;/pre&gt;\n&quot;;</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                }</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;                <span class="comment">//else echo &quot;&lt;pre style=\&quot;border:1px solid #ccc;margin-top:5px;\&quot;&gt;{$table}:&lt;br /&gt;&lt;b&gt;Did not find index:&lt;/b&gt;&quot;.$index_string.&quot;&lt;br /&gt;&quot;.print_r($indices, true).&quot;&lt;/pre&gt;\n&quot;;</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;            }</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        }</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        <span class="comment">// For every remaining index specified for the table</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;        <span class="keywordflow">foreach</span> ( (array) $indices as $index ) {</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            <span class="comment">// Push a query line into $cqueries that adds the index to that table</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;            $cqueries[] = <span class="stringliteral">&quot;ALTER TABLE {$table} ADD $index&quot;</span>;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            $for_update[] = <span class="stringliteral">&#39;Added index &#39;</span> . $table . <span class="charliteral">&#39; &#39;</span> . $index;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;        }</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;        <span class="comment">// Remove the original table creation query from processing</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        unset( $cqueries[ $table ], $for_update[ $table ] );</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    }</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    $allqueries = array_merge($cqueries, $iqueries);</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="keywordflow">if</span> ($execute) {</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        <span class="keywordflow">foreach</span> ($allqueries as $query) {</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;            <span class="comment">//echo &quot;&lt;pre style=\&quot;border:1px solid #ccc;margin-top:5px;\&quot;&gt;&quot;.print_r($query, true).&quot;&lt;/pre&gt;\n&quot;;</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;            $wpdb-&gt;query($query);</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        }</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    }</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    <span class="keywordflow">return</span> $for_update;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;}</div>
<div class="ttc" id="wp-includes_2functions_8php_html_af56ce4c5410aedf5dda37e798124b74a"><div class="ttname"><a href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a></div><div class="ttdeci">is_main_site($site_id=null)</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2functions_8php_source.html#l03293">functions.php:3293</a></div></div>
<div class="ttc" id="load-scripts_8php_html_a54639394aa645a2277ea41f3cbd23247"><div class="ttname"><a href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a></div><div class="ttdeci">apply_filters()</div><div class="ttdef"><b>Definition:</b> <a href="load-scripts_8php_source.html#l00037">load-scripts.php:37</a></div></div>
<div class="ttc" id="schema_8php_html_a69d44db5129b85c08fa02666649039b1"><div class="ttname"><a href="schema_8php.html#a69d44db5129b85c08fa02666649039b1">wp_get_db_schema</a></div><div class="ttdeci">wp_get_db_schema($scope= 'all', $blog_id=null)</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00031">schema.php:31</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a036ba9e030cb4feddc2022ac115784f7_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a036ba9e030cb4feddc2022ac115784f7_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a036ba9e030cb4feddc2022ac115784f7_cgraph" id="includes_2upgrade_8php_a036ba9e030cb4feddc2022ac115784f7_cgraph">
<area shape="rect" id="node2" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="143,5,234,32"/><area shape="rect" id="node3" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a" title="is_main_site" alt="" coords="141,107,236,133"/><area shape="rect" id="node6" href="schema_8php.html#a69d44db5129b85c08fa02666649039b1" title="wp_get_db_schema" alt="" coords="120,56,257,83"/><area shape="rect" id="node4" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="329,56,417,83"/><area shape="rect" id="node5" href="load_8php.html#a49b99067b44a28b2df04dcbd50569624" title="get_current_blog_id" alt="" coords="305,107,440,133"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a036ba9e030cb4feddc2022ac115784f7_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a036ba9e030cb4feddc2022ac115784f7_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a036ba9e030cb4feddc2022ac115784f7_icgraph" id="includes_2upgrade_8php_a036ba9e030cb4feddc2022ac115784f7_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ab68f6b47e715e99c6e5664a41e4a2333" title="make_db_current" alt="" coords="139,5,261,32"/><area shape="rect" id="node3" href="includes_2upgrade_8php.html#adb3f1e7966cc172decd9b3f6d84d82b5" title="make_db_current_silent" alt="" coords="120,56,280,83"/><area shape="rect" id="node4" href="ms-functions_8php.html#a57320b11a05ba7c9bbc64ac1ddb44186" title="install_blog" alt="" coords="328,56,415,83"/><area shape="rect" id="node5" href="ms-functions_8php.html#a3dbc754495e11e28ca33a009a8e4061a" title="create_empty_blog" alt="" coords="463,31,595,57"/><area shape="rect" id="node6" href="ms-functions_8php.html#a94df666e8946aa4e4ed6a1e9bde7d7c0" title="wpmu_create_blog" alt="" coords="463,81,594,108"/><area shape="rect" id="node7" href="ms-functions_8php.html#a41820c535b4be9fce06c03595d6ca14a" title="wpmu_activate_signup" alt="" coords="643,81,795,108"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afd6d5e27da310b6ded125a7ab130e336"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">deslash </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$content</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>{ </p>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01443">1443</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="press-this_8php_source.html#l00355">$content</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00549">upgrade_130()</a>.</p>
<div class="fragment"><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;                           {</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="comment">// Note: \\\ inside a regex denotes a single backslash.</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="comment">// Replace one or more backslashes followed by a single quote with</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="comment">// a single quote.</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    <a class="code" href="press-this_8php.html#a57b284fe00866494b33afa80ba729bed">$content</a> = preg_replace(<span class="stringliteral">&quot;/\\\+&#39;/&quot;</span>, <span class="stringliteral">&quot;&#39;&quot;</span>, <a class="code" href="press-this_8php.html#a57b284fe00866494b33afa80ba729bed">$content</a>);</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="comment">// Replace one or more backslashes followed by a double quote with</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="comment">// a double quote.</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <a class="code" href="press-this_8php.html#a57b284fe00866494b33afa80ba729bed">$content</a> = preg_replace(<span class="stringliteral">&#39;/\\\+&quot;/&#39;</span>, <span class="charliteral">&#39;&quot;&#39;</span>, <a class="code" href="press-this_8php.html#a57b284fe00866494b33afa80ba729bed">$content</a>);</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="comment">// Replace one or more backslashes with one backslash.</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <a class="code" href="press-this_8php.html#a57b284fe00866494b33afa80ba729bed">$content</a> = preg_replace(<span class="stringliteral">&quot;/\\\+/&quot;</span>, <span class="stringliteral">&quot;\\&quot;</span>, <a class="code" href="press-this_8php.html#a57b284fe00866494b33afa80ba729bed">$content</a>);</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="press-this_8php.html#a57b284fe00866494b33afa80ba729bed">$content</a>;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;}</div>
<div class="ttc" id="press-this_8php_html_a57b284fe00866494b33afa80ba729bed"><div class="ttname"><a href="press-this_8php.html#a57b284fe00866494b33afa80ba729bed">$content</a></div><div class="ttdeci">$content</div><div class="ttdef"><b>Definition:</b> <a href="press-this_8php_source.html#l00355">press-this.php:355</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_afd6d5e27da310b6ded125a7ab130e336_icgraph.png" border="0" usemap="#includes_2upgrade_8php_afd6d5e27da310b6ded125a7ab130e336_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_afd6d5e27da310b6ded125a7ab130e336_icgraph" id="includes_2upgrade_8php_afd6d5e27da310b6ded125a7ab130e336_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#aa1681e2b2e9fc1c0ebaa20a05c278067" title="upgrade_130" alt="" coords="120,5,216,32"/><area shape="rect" id="node3" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="264,5,352,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a803e9c6735f71e763ab18bd8bdc630ab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">drop_index </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>{ </p>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01330">1330</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="menu_8php_source.html#l00054">$i</a>, and <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l01353">add_clean_index()</a>.</p>
<div class="fragment"><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;                                    {</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    $wpdb-&gt;hide_errors();</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE `$table` DROP INDEX `$index`&quot;</span>);</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <span class="comment">// Now we need to take out all the extra ones we may have created</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> = 0; <a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> &lt; 25; <a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>++) {</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE `$table` DROP INDEX `{$index}_$i`&quot;</span>);</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    }</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    $wpdb-&gt;show_errors();</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;}</div>
<div class="ttc" id="menu_8php_html_a83018d9153d17d91fbcf3bc10158d34f"><div class="ttname"><a href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a></div><div class="ttdeci">$i</div><div class="ttdef"><b>Definition:</b> <a href="menu_8php_source.html#l00054">menu.php:54</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a803e9c6735f71e763ab18bd8bdc630ab_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a803e9c6735f71e763ab18bd8bdc630ab_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a803e9c6735f71e763ab18bd8bdc630ab_icgraph" id="includes_2upgrade_8php_a803e9c6735f71e763ab18bd8bdc630ab_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4" title="add_clean_index" alt="" coords="139,5,257,32"/><area shape="rect" id="node3" href="includes_2upgrade_8php.html#a6e6d4fb5df8f86dc0aafa740bf1dfe60" title="upgrade_101" alt="" coords="305,5,401,32"/><area shape="rect" id="node4" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="449,5,537,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0a23ab0934c3f2e5618f931a4ea4c483"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">get_alloptions_110 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Retrieve all options as it was for 1.2.</p>
<dl class="section since"><dt>Since</dt><dd>1.2.0</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>array List of options. </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01391">1391</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="wp-admin_2index_8php_source.html#l00114">$option</a>, <a class="el" href="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php_source.html#l00015">$options</a>, <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, and <a class="el" href="formatting_8php_source.html#l01407">untrailingslashit()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00489">upgrade_110()</a>.</p>
<div class="fragment"><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;                              {</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    $all_options = <span class="keyword">new</span> stdClass;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php.html#ad485bdc644c889fcb77db6edc8323836">$options</a> = $wpdb-&gt;get_results( <span class="stringliteral">&quot;SELECT option_name, option_value FROM $wpdb-&gt;options&quot;</span> ) ) {</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        <span class="keywordflow">foreach</span> ( <a class="code" href="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php.html#ad485bdc644c889fcb77db6edc8323836">$options</a> as <a class="code" href="wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> ) {</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;            <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;siteurl&#39;</span> == $option-&gt;option_name || <span class="stringliteral">&#39;home&#39;</span> == $option-&gt;option_name || <span class="stringliteral">&#39;category_base&#39;</span> == $option-&gt;option_name )</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                $option-&gt;option_value = <a class="code" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72">untrailingslashit</a>( $option-&gt;option_value );</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;            $all_options-&gt;{$option-&gt;option_name} = stripslashes( $option-&gt;option_value );</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        }</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    }</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="keywordflow">return</span> $all_options;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;}</div>
<div class="ttc" id="formatting_8php_html_ab99d2b875428a3172f6ea9d4d2e33e72"><div class="ttname"><a href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72">untrailingslashit</a></div><div class="ttdeci">untrailingslashit($string)</div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l01407">formatting.php:1407</a></div></div>
<div class="ttc" id="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php_html_ad485bdc644c889fcb77db6edc8323836"><div class="ttname"><a href="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php.html#ad485bdc644c889fcb77db6edc8323836">$options</a></div><div class="ttdeci">if(!file_exists($kmyacc)) $options</div><div class="ttdef"><b>Definition:</b> <a href="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php_source.html#l00015">rebuildParser.php:15</a></div></div>
<div class="ttc" id="wp-admin_2index_8php_html_a3691fb4ac25261a9b1efa1fd6d58923b"><div class="ttname"><a href="wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a></div><div class="ttdeci">if(has_action( 'welcome_panel')&amp;&amp;current_user_can( 'edit_theme_options')) $option</div><div class="ttdef"><b>Definition:</b> <a href="wp-admin_2index_8php_source.html#l00114">index.php:114</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a0a23ab0934c3f2e5618f931a4ea4c483_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a0a23ab0934c3f2e5618f931a4ea4c483_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a0a23ab0934c3f2e5618f931a4ea4c483_cgraph" id="includes_2upgrade_8php_a0a23ab0934c3f2e5618f931a4ea4c483_cgraph">
<area shape="rect" id="node2" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="184,5,296,32"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a0a23ab0934c3f2e5618f931a4ea4c483_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a0a23ab0934c3f2e5618f931a4ea4c483_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a0a23ab0934c3f2e5618f931a4ea4c483_icgraph" id="includes_2upgrade_8php_a0a23ab0934c3f2e5618f931a4ea4c483_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#afe18c72dcd93806bfefc8bde68fccd8a" title="upgrade_110" alt="" coords="184,5,280,32"/><area shape="rect" id="node3" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="328,5,416,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab68f6b47e715e99c6e5664a41e4a2333"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">make_db_current </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$tables</em> = <code>'all'</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>{ </p>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01676">1676</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="includes_2upgrade_8php_source.html#l01471">dbDelta()</a>.</p>
<div class="fragment"><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                                            {</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    $alterations = <a class="code" href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7">dbDelta</a>( $tables );</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    echo <span class="stringliteral">&quot;&lt;ol&gt;\n&quot;</span>;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    <span class="keywordflow">foreach</span>($alterations as $alteration) echo <span class="stringliteral">&quot;&lt;li&gt;$alteration&lt;/li&gt;\n&quot;</span>;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    echo <span class="stringliteral">&quot;&lt;/ol&gt;\n&quot;</span>;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;}</div>
<div class="ttc" id="includes_2upgrade_8php_html_a036ba9e030cb4feddc2022ac115784f7"><div class="ttname"><a href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7">dbDelta</a></div><div class="ttdeci">dbDelta($queries= '', $execute=true)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01471">upgrade.php:1471</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_ab68f6b47e715e99c6e5664a41e4a2333_cgraph.png" border="0" usemap="#includes_2upgrade_8php_ab68f6b47e715e99c6e5664a41e4a2333_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_ab68f6b47e715e99c6e5664a41e4a2333_cgraph" id="includes_2upgrade_8php_ab68f6b47e715e99c6e5664a41e4a2333_cgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7" title="dbDelta" alt="" coords="176,56,243,83"/><area shape="rect" id="node3" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="314,5,405,32"/><area shape="rect" id="node4" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a" title="is_main_site" alt="" coords="312,107,407,133"/><area shape="rect" id="node7" href="schema_8php.html#a69d44db5129b85c08fa02666649039b1" title="wp_get_db_schema" alt="" coords="291,56,428,83"/><area shape="rect" id="node5" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="499,56,587,83"/><area shape="rect" id="node6" href="load_8php.html#a49b99067b44a28b2df04dcbd50569624" title="get_current_blog_id" alt="" coords="476,107,611,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="adb3f1e7966cc172decd9b3f6d84d82b5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">make_db_current_silent </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$tables</em> = <code>'all'</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>{ </p>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01690">1690</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="includes_2upgrade_8php_source.html#l01471">dbDelta()</a>.</p>

<p>Referenced by <a class="el" href="ms-functions_8php_source.html#l01122">install_blog()</a>.</p>
<div class="fragment"><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                                                   {</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    $alterations = <a class="code" href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7">dbDelta</a>( $tables );</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;}</div>
<div class="ttc" id="includes_2upgrade_8php_html_a036ba9e030cb4feddc2022ac115784f7"><div class="ttname"><a href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7">dbDelta</a></div><div class="ttdeci">dbDelta($queries= '', $execute=true)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01471">upgrade.php:1471</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_adb3f1e7966cc172decd9b3f6d84d82b5_cgraph.png" border="0" usemap="#includes_2upgrade_8php_adb3f1e7966cc172decd9b3f6d84d82b5_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_adb3f1e7966cc172decd9b3f6d84d82b5_cgraph" id="includes_2upgrade_8php_adb3f1e7966cc172decd9b3f6d84d82b5_cgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7" title="dbDelta" alt="" coords="213,56,280,83"/><area shape="rect" id="node3" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="351,5,442,32"/><area shape="rect" id="node4" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a" title="is_main_site" alt="" coords="349,107,444,133"/><area shape="rect" id="node7" href="schema_8php.html#a69d44db5129b85c08fa02666649039b1" title="wp_get_db_schema" alt="" coords="328,56,465,83"/><area shape="rect" id="node5" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="537,56,625,83"/><area shape="rect" id="node6" href="load_8php.html#a49b99067b44a28b2df04dcbd50569624" title="get_current_blog_id" alt="" coords="513,107,648,133"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_adb3f1e7966cc172decd9b3f6d84d82b5_icgraph.png" border="0" usemap="#includes_2upgrade_8php_adb3f1e7966cc172decd9b3f6d84d82b5_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_adb3f1e7966cc172decd9b3f6d84d82b5_icgraph" id="includes_2upgrade_8php_adb3f1e7966cc172decd9b3f6d84d82b5_icgraph">
<area shape="rect" id="node2" href="ms-functions_8php.html#a57320b11a05ba7c9bbc64ac1ddb44186" title="install_blog" alt="" coords="213,31,300,57"/><area shape="rect" id="node3" href="ms-functions_8php.html#a3dbc754495e11e28ca33a009a8e4061a" title="create_empty_blog" alt="" coords="348,5,480,32"/><area shape="rect" id="node4" href="ms-functions_8php.html#a94df666e8946aa4e4ed6a1e9bde7d7c0" title="wpmu_create_blog" alt="" coords="349,56,479,83"/><area shape="rect" id="node5" href="ms-functions_8php.html#a41820c535b4be9fce06c03595d6ca14a" title="wpmu_activate_signup" alt="" coords="528,56,680,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aabe08bc33812c096cbe094c1fa7c95ef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">make_site_theme </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>{ </p>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01848">1848</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="includes_2upgrade_8php_source.html#l01413">__get_option()</a>, <a class="el" href="load-scripts_8php_source.html#l00011">ABSPATH</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01784">make_site_theme_from_default()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01705">make_site_theme_from_oldschool()</a>, <a class="el" href="formatting_8php_source.html#l00951">sanitize_title()</a>, <a class="el" href="option_8php_source.html#l00214">update_option()</a>, and <a class="el" href="setup-config_8php_source.html#l00040">WP_CONTENT_DIR</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00549">upgrade_130()</a>.</p>
<div class="fragment"><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                           {</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    <span class="comment">// Name the theme after the blog.</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    $theme_name = <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;blogname&#39;</span>);</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    $template = <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>($theme_name);</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    $site_dir = <a class="code" href="setup-config_8php.html#aa03cafb2b326885f63ee3e018f14f168">WP_CONTENT_DIR</a> . <span class="stringliteral">&quot;/themes/$template&quot;</span>;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    <span class="comment">// If the theme already exists, nothing to do.</span></div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    <span class="keywordflow">if</span> ( is_dir($site_dir)) {</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    }</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    <span class="comment">// We must be able to write to the themes dir.</span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    <span class="keywordflow">if</span> (! is_writable(<a class="code" href="setup-config_8php.html#aa03cafb2b326885f63ee3e018f14f168">WP_CONTENT_DIR</a> . <span class="stringliteral">&quot;/themes&quot;</span>)) {</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    }</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    umask(0);</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="keywordflow">if</span> (! mkdir($site_dir, 0777)) {</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    }</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    <span class="keywordflow">if</span> (file_exists(<a class="code" href="load-scripts_8php.html#a495f94983b95273ad267511b2411351f">ABSPATH</a> . <span class="stringliteral">&#39;wp-layout.css&#39;</span>)) {</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        <span class="keywordflow">if</span> (! <a class="code" href="includes_2upgrade_8php.html#a278f8eaf153a74f3348fe92d16e044d2">make_site_theme_from_oldschool</a>($theme_name, $template)) {</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;            <span class="comment">// TODO: rm -rf the site theme directory.</span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;        }</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        <span class="keywordflow">if</span> (! <a class="code" href="includes_2upgrade_8php.html#a0771fe384061bbaf9ab5c6ff7bff1f93">make_site_theme_from_default</a>($theme_name, $template))</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;            <span class="comment">// TODO: rm -rf the site theme directory.</span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    }</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <span class="comment">// Make the new site theme active.</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    $current_template = <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;template&#39;</span>);</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    <span class="keywordflow">if</span> ($current_template == WP_DEFAULT_THEME) {</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;        <a class="code" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a>(<span class="stringliteral">&#39;template&#39;</span>, $template);</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        <a class="code" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a>(<span class="stringliteral">&#39;stylesheet&#39;</span>, $template);</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    }</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    <span class="keywordflow">return</span> $template;</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;}</div>
<div class="ttc" id="option_8php_html_a7c47bc5d444687bebd583e6b5dfc04bc"><div class="ttname"><a href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a></div><div class="ttdeci">update_option($option, $newvalue)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00214">option.php:214</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a278f8eaf153a74f3348fe92d16e044d2"><div class="ttname"><a href="includes_2upgrade_8php.html#a278f8eaf153a74f3348fe92d16e044d2">make_site_theme_from_oldschool</a></div><div class="ttdeci">make_site_theme_from_oldschool($theme_name, $template)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01705">upgrade.php:1705</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a913d174175f69bd5da3dba3288acc2b1"><div class="ttname"><a href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a></div><div class="ttdeci">__get_option($setting)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01413">upgrade.php:1413</a></div></div>
<div class="ttc" id="load-scripts_8php_html_a495f94983b95273ad267511b2411351f"><div class="ttname"><a href="load-scripts_8php.html#a495f94983b95273ad267511b2411351f">ABSPATH</a></div><div class="ttdeci">const ABSPATH</div><div class="ttdef"><b>Definition:</b> <a href="load-scripts_8php_source.html#l00011">load-scripts.php:11</a></div></div>
<div class="ttc" id="setup-config_8php_html_aa03cafb2b326885f63ee3e018f14f168"><div class="ttname"><a href="setup-config_8php.html#aa03cafb2b326885f63ee3e018f14f168">WP_CONTENT_DIR</a></div><div class="ttdeci">const WP_CONTENT_DIR</div><div class="ttdef"><b>Definition:</b> <a href="setup-config_8php_source.html#l00040">setup-config.php:40</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a0771fe384061bbaf9ab5c6ff7bff1f93"><div class="ttname"><a href="includes_2upgrade_8php.html#a0771fe384061bbaf9ab5c6ff7bff1f93">make_site_theme_from_default</a></div><div class="ttdeci">make_site_theme_from_default($theme_name, $template)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01784">upgrade.php:1784</a></div></div>
<div class="ttc" id="formatting_8php_html_ac6495c47468fb816d78bb2d2b326d808"><div class="ttname"><a href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a></div><div class="ttdeci">sanitize_title($title, $fallback_title= '', $context= 'save')</div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l00951">formatting.php:951</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_aabe08bc33812c096cbe094c1fa7c95ef_cgraph.png" border="0" usemap="#includes_2upgrade_8php_aabe08bc33812c096cbe094c1fa7c95ef_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_aabe08bc33812c096cbe094c1fa7c95ef_cgraph" id="includes_2upgrade_8php_aabe08bc33812c096cbe094c1fa7c95ef_cgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1" title="__get_option" alt="" coords="787,434,883,461"/><area shape="rect" id="node6" href="includes_2upgrade_8php.html#a0771fe384061bbaf9ab5c6ff7bff1f93" title="make_site_theme_from\l_default" alt="" coords="179,393,336,435"/><area shape="rect" id="node7" href="includes_2upgrade_8php.html#a278f8eaf153a74f3348fe92d16e044d2" title="make_site_theme_from\l_oldschool" alt="" coords="548,343,705,384"/><area shape="rect" id="node11" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808" title="sanitize_title" alt="" coords="210,190,305,217"/><area shape="rect" id="node23" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc" title="update_option" alt="" coords="206,1410,309,1437"/><area shape="rect" id="node3" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="1194,1258,1325,1285"/><area shape="rect" id="node5" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="1203,498,1315,525"/><area shape="rect" id="node4" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="1416,1283,1511,1310"/><area shape="rect" id="node8" href="wp-admin_2includes_2_file_8php.html#aefba71100e8eaa464359f61a4081a210" title="get_home_path" alt="" coords="779,346,890,373"/><area shape="rect" id="node9" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="1218,346,1301,373"/><area shape="rect" id="node10" href="formatting_8php.html#a996c0584f3d97040938ef0073352c114" title="trailingslashit" alt="" coords="992,346,1091,373"/><area shape="rect" id="node12" href="formatting_8php.html#a05e464b55ec2c8b334abed9864d014e9" title="remove_accents" alt="" coords="384,190,500,217"/><area shape="rect" id="node15" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="1418,777,1509,803"/><area shape="rect" id="node13" href="formatting_8php.html#a618ba7bdc2cf2790af2e9fa968f03615" title="seems_utf8" alt="" coords="582,215,671,242"/><area shape="rect" id="node14" href="l10n_8php.html#a6ec9fd4baced85768ba16386e9e1b339" title="get_locale" alt="" coords="586,165,667,191"/><area shape="rect" id="node16" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="1419,650,1507,677"/><area shape="rect" id="node17" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa" title="get_site_option" alt="" coords="779,1207,890,1234"/><area shape="rect" id="node18" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1411,1613,1516,1639"/><area shape="rect" id="node19" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="1000,1359,1083,1386"/><area shape="rect" id="node22" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="1207,1663,1312,1690"/><area shape="rect" id="node20" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="1194,1511,1325,1538"/><area shape="rect" id="node21" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1409,1486,1517,1513"/><area shape="rect" id="node24" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="560,943,693,984"/><area shape="rect" id="node31" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="572,1081,681,1107"/><area shape="rect" id="node35" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="1220,1815,1299,1842"/><area shape="rect" id="node49" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="399,1486,485,1513"/><area shape="rect" id="node50" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="569,1359,685,1386"/><area shape="rect" id="node25" href="wp-includes_2functions_8php.html#a06d38a93c806c187fd21200c1baa9f53" title="wp_die" alt="" coords="1010,549,1073,575"/><area shape="rect" id="node26" href="formatting_8php.html#a77a1b666b7ca0e393239a9e1d1af72d3" title="esc_html" alt="" coords="797,853,872,879"/><area shape="rect" id="node27" href="formatting_8php.html#a745879b47424ac7b0d3b95a1edec8361" title="wp_check_invalid_utf8" alt="" coords="966,447,1117,474"/><area shape="rect" id="node28" href="formatting_8php.html#ab9121c7a11ad101936875a65b233e126" title="_wp_specialchars" alt="" coords="979,1055,1104,1082"/><area shape="rect" id="node29" href="formatting_8php.html#a4389f130de336d59e890c79b10a60beb" title="wp_specialchars_decode" alt="" coords="1176,1106,1343,1133"/><area shape="rect" id="node30" href="kses_8php.html#abc0e5ed7e9bad89cc998a35b48653fdb" title="wp_kses_normalize_entities" alt="" coords="1167,1005,1352,1031"/><area shape="rect" id="node32" href="formatting_8php.html#a1a391a56d1c6c0e52239a553a0dbfb73" title="sanitize_email" alt="" coords="989,1207,1094,1234"/><area shape="rect" id="node33" href="formatting_8php.html#aa394269ea323c88435820bb0a0f5912f" title="is_email" alt="" coords="799,1258,870,1285"/><area shape="rect" id="node37" href="wp-admin_2includes_2template_8php.html#ac54155d98db655b34d0c2c87d1e53c64" title="add_settings_error" alt="" coords="770,1309,899,1335"/><area shape="rect" id="node38" href="kses_8php.html#aa0817828c22f5e89ff755ae1ad1de60c" title="wp_kses_post" alt="" coords="782,903,887,930"/><area shape="rect" id="node44" href="kses_8php.html#a050aa6ac503f4f1a2eb655efe9b42dc6" title="wp_kses_data" alt="" coords="782,1055,887,1082"/><area shape="rect" id="node46" href="formatting_8php.html#ad9e809b6901d247527672e11ce5d7368" title="esc_url_raw" alt="" coords="789,954,880,981"/><area shape="rect" id="node48" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332" title="get_available_languages" alt="" coords="753,1005,916,1031"/><area shape="rect" id="node34" href="wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532" title="_deprecated_argument" alt="" coords="964,1511,1119,1538"/><area shape="rect" id="node36" href="wp-includes_2plugin_8php.html#af891e88ab346a2da31111facfcf6b2cf" title="_wp_call_all_hook" alt="" coords="1400,1815,1527,1842"/><area shape="rect" id="node39" href="kses_8php.html#a16c90f8f4b5152db3c88044526e28f59" title="wp_kses" alt="" coords="1005,903,1078,930"/><area shape="rect" id="node40" href="wp-includes_2functions_8php.html#a410d6d8e60b99a2fbc62fe8116978711" title="wp_allowed_protocols" alt="" coords="1185,954,1333,981"/><area shape="rect" id="node41" href="kses_8php.html#a6a32ba00333b67cff42a76ec3762e5c3" title="wp_kses_no_null" alt="" coords="1199,853,1320,879"/><area shape="rect" id="node42" href="kses_8php.html#a3dec56a527f620ff81fa9dc188238b4f" title="wp_kses_js_entities" alt="" coords="1190,903,1329,930"/><area shape="rect" id="node43" href="kses_8php.html#a387ea2ab906936be7f094a0152f7886a" title="wp_kses_hook" alt="" coords="1205,802,1313,829"/><area shape="rect" id="node45" href="wp-includes_2plugin_8php.html#ae088c31761ae2cdcff6491755b1bdab6" title="current_filter" alt="" coords="995,1106,1088,1133"/><area shape="rect" id="node47" href="formatting_8php.html#a42f495a436026ff2811d0d80caca937d" title="esc_url" alt="" coords="1009,954,1073,981"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_aabe08bc33812c096cbe094c1fa7c95ef_icgraph.png" border="0" usemap="#includes_2upgrade_8php_aabe08bc33812c096cbe094c1fa7c95ef_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_aabe08bc33812c096cbe094c1fa7c95ef_icgraph" id="includes_2upgrade_8php_aabe08bc33812c096cbe094c1fa7c95ef_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#aa1681e2b2e9fc1c0ebaa20a05c278067" title="upgrade_130" alt="" coords="179,5,275,32"/><area shape="rect" id="node3" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="323,5,411,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0771fe384061bbaf9ab5c6ff7bff1f93"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">make_site_theme_from_default </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$theme_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$template</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>{ </p>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01784">1784</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="press-this_8php_source.html#l00108">$image</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01413">__get_option()</a>, <a class="el" href="admin_8php_source.html#l00044">elseif</a>, and <a class="el" href="setup-config_8php_source.html#l00040">WP_CONTENT_DIR</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l01848">make_site_theme()</a>.</p>
<div class="fragment"><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;                                                              {</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    $site_dir = <a class="code" href="setup-config_8php.html#aa03cafb2b326885f63ee3e018f14f168">WP_CONTENT_DIR</a> . <span class="stringliteral">&quot;/themes/$template&quot;</span>;</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    $default_dir = <a class="code" href="setup-config_8php.html#aa03cafb2b326885f63ee3e018f14f168">WP_CONTENT_DIR</a> . <span class="stringliteral">&#39;/themes/&#39;</span> . WP_DEFAULT_THEME;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <span class="comment">// Copy files from the default theme to the site theme.</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    <span class="comment">//$files = array(&#39;index.php&#39;, &#39;comments.php&#39;, &#39;comments-popup.php&#39;, &#39;footer.php&#39;, &#39;header.php&#39;, &#39;sidebar.php&#39;, &#39;style.css&#39;);</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    $theme_dir = @ opendir($default_dir);</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <span class="keywordflow">if</span> ($theme_dir) {</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        <span class="keywordflow">while</span>(($theme_file = readdir( $theme_dir )) !== <span class="keyword">false</span>) {</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;            <span class="keywordflow">if</span> (is_dir(<span class="stringliteral">&quot;$default_dir/$theme_file&quot;</span>))</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;            <span class="keywordflow">if</span> (! @copy(<span class="stringliteral">&quot;$default_dir/$theme_file&quot;</span>, <span class="stringliteral">&quot;$site_dir/$theme_file&quot;</span>))</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;            chmod(<span class="stringliteral">&quot;$site_dir/$theme_file&quot;</span>, 0777);</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;        }</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    }</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    @closedir($theme_dir);</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="comment">// Rewrite the theme header.</span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    $stylelines = explode(<span class="stringliteral">&quot;\n&quot;</span>, implode(<span class="stringliteral">&#39;&#39;</span>, <a class="code" href="namespacefile.html">file</a>(<span class="stringliteral">&quot;$site_dir/style.css&quot;</span>)));</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    <span class="keywordflow">if</span> ($stylelines) {</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        $f = fopen(<span class="stringliteral">&quot;$site_dir/style.css&quot;</span>, <span class="charliteral">&#39;w&#39;</span>);</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;        <span class="keywordflow">foreach</span> ($stylelines as $line) {</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;            <span class="keywordflow">if</span> (strpos($line, <span class="stringliteral">&#39;Theme Name:&#39;</span>) !== <span class="keyword">false</span>) $line = <span class="stringliteral">&#39;Theme Name: &#39;</span> . $theme_name;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;            <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> (strpos($line, <span class="stringliteral">&#39;Theme URI:&#39;</span>) !== <span class="keyword">false</span>) $line = &#39;Theme URI: &#39; . <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(&#39;url&#39;);</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;            <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> (strpos($line, &#39;Description:&#39;) !== <a class="code" href="admin_8php.html#ace3f30d2579e123cda1ed501e621a029">false</a>) $line = &#39;Description: Your <a class="code" href="namespacetheme.html">theme</a>.&#39;;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;            <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> (strpos($line, &#39;Version:&#39;) !== <a class="code" href="admin_8php.html#ace3f30d2579e123cda1ed501e621a029">false</a>) $line = &#39;Version: 1&#39;;</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;            <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> (strpos($line, &#39;<a class="code" href="plugin-install_8php.html#a58ceb9b1bcb9598f278401c87fb3d17d">Author</a>:&#39;) !== <a class="code" href="admin_8php.html#ace3f30d2579e123cda1ed501e621a029">false</a>) $line = &#39;<a class="code" href="plugin-install_8php.html#a58ceb9b1bcb9598f278401c87fb3d17d">Author</a>: <a class="code" href="namespace_you.html">You</a>&#39;;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;            fwrite($f, $line . &quot;\<a class="code" href="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a>&quot;);</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;        }</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;        fclose($f);</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    }</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="comment">// Copy the images.</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    umask(0);</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    <a class="code" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a174bd863e19b821e37abc700f6c84ba4">if</a> (! mkdir(&quot;$site_dir/<a class="code" href="namespaceimages.html">images</a>&quot;, 0777)) {</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    }</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    $images_dir = @ opendir(<span class="stringliteral">&quot;$default_dir/images&quot;</span>);</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="keywordflow">if</span> ($images_dir) {</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        <span class="keywordflow">while</span>((<a class="code" href="press-this_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> = readdir($images_dir)) !== <span class="keyword">false</span>) {</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;            <span class="keywordflow">if</span> (is_dir(<span class="stringliteral">&quot;$default_dir/images/$image&quot;</span>))</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;            <span class="keywordflow">if</span> (! @copy(<span class="stringliteral">&quot;$default_dir/images/$image&quot;</span>, <span class="stringliteral">&quot;$site_dir/images/$image&quot;</span>))</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;            chmod(<span class="stringliteral">&quot;$site_dir/images/$image&quot;</span>, 0777);</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;        }</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    }</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    @closedir($images_dir);</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;}</div>
<div class="ttc" id="includes_2upgrade_8php_html_a913d174175f69bd5da3dba3288acc2b1"><div class="ttname"><a href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a></div><div class="ttdeci">__get_option($setting)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01413">upgrade.php:1413</a></div></div>
<div class="ttc" id="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php_html_aeab71244afb687f16d8c4f5ee9d6ef0e"><div class="ttname"><a href="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php.html#aeab71244afb687f16d8c4f5ee9d6ef0e">n</a></div><div class="ttdeci">n</div><div class="ttdef"><b>Definition:</b> <a href="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php_source.html#l00038">rebuildParser.php:38</a></div></div>
<div class="ttc" id="admin_8php_html_af1c9ecf26c0cfd247c0760dd4b594a6d"><div class="ttname"><a href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a></div><div class="ttdeci">if(get_option('db_upgraded')) elseif(get_option('db_version')!=$wp_db_version &amp;&amp;empty($_POST))</div><div class="ttdef"><b>Definition:</b> <a href="admin_8php_source.html#l00044">admin.php:44</a></div></div>
<div class="ttc" id="namespaceimages_html"><div class="ttname"><a href="namespaceimages.html">images</a></div></div>
<div class="ttc" id="setup-config_8php_html_aa03cafb2b326885f63ee3e018f14f168"><div class="ttname"><a href="setup-config_8php.html#aa03cafb2b326885f63ee3e018f14f168">WP_CONTENT_DIR</a></div><div class="ttdeci">const WP_CONTENT_DIR</div><div class="ttdef"><b>Definition:</b> <a href="setup-config_8php_source.html#l00040">setup-config.php:40</a></div></div>
<div class="ttc" id="_p_h_p-_parser-1_80_81_2test__old_2run_8php_html_a174bd863e19b821e37abc700f6c84ba4"><div class="ttname"><a href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a174bd863e19b821e37abc700f6c84ba4">if</a></div><div class="ttdeci">if(0!==$parseFail) if(0!==$ppFail) if(0!==$compareFail)</div><div class="ttdef"><b>Definition:</b> <a href="_p_h_p-_parser-1_80_81_2test__old_2run_8php_source.html#l00174">run.php:174</a></div></div>
<div class="ttc" id="admin_8php_html_ace3f30d2579e123cda1ed501e621a029"><div class="ttname"><a href="admin_8php.html#ace3f30d2579e123cda1ed501e621a029">false</a></div><div class="ttdeci">if(!defined('WP_NETWORK_ADMIN')) define('WP_NETWORK_ADMIN' false</div><div class="ttdef"><b>Definition:</b> <a href="admin_8php_source.html#l00017">admin.php:17</a></div></div>
<div class="ttc" id="press-this_8php_html_aac6146b4cdec66c94263ddb55afd5946"><div class="ttname"><a href="press-this_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a></div><div class="ttdeci">$image</div><div class="ttdef"><b>Definition:</b> <a href="press-this_8php_source.html#l00108">press-this.php:108</a></div></div>
<div class="ttc" id="namespacefile_html"><div class="ttname"><a href="namespacefile.html">file</a></div></div>
<div class="ttc" id="plugin-install_8php_html_a58ceb9b1bcb9598f278401c87fb3d17d"><div class="ttname"><a href="plugin-install_8php.html#a58ceb9b1bcb9598f278401c87fb3d17d">Author</a></div><div class="ttdeci">re looking Search is your best bet The Search screen has options to search the WordPress org Plugin Directory for a particular Author</div><div class="ttdef"><b>Definition:</b> <a href="plugin-install_8php_source.html#l00048">plugin-install.php:48</a></div></div>
<div class="ttc" id="namespace_you_html"><div class="ttname"><a href="namespace_you.html">You</a></div></div>
<div class="ttc" id="namespacetheme_html"><div class="ttname"><a href="namespacetheme.html">theme</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a0771fe384061bbaf9ab5c6ff7bff1f93_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a0771fe384061bbaf9ab5c6ff7bff1f93_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a0771fe384061bbaf9ab5c6ff7bff1f93_cgraph" id="includes_2upgrade_8php_a0771fe384061bbaf9ab5c6ff7bff1f93_cgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1" title="__get_option" alt="" coords="211,31,307,57"/><area shape="rect" id="node3" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="355,5,485,32"/><area shape="rect" id="node5" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="364,56,476,83"/><area shape="rect" id="node4" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="533,5,628,32"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a0771fe384061bbaf9ab5c6ff7bff1f93_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a0771fe384061bbaf9ab5c6ff7bff1f93_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a0771fe384061bbaf9ab5c6ff7bff1f93_icgraph" id="includes_2upgrade_8php_a0771fe384061bbaf9ab5c6ff7bff1f93_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#aabe08bc33812c096cbe094c1fa7c95ef" title="make_site_theme" alt="" coords="211,13,336,39"/><area shape="rect" id="node3" href="includes_2upgrade_8php.html#aa1681e2b2e9fc1c0ebaa20a05c278067" title="upgrade_130" alt="" coords="384,13,480,39"/><area shape="rect" id="node4" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="528,13,616,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a278f8eaf153a74f3348fe92d16e044d2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">make_site_theme_from_oldschool </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$theme_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$template</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>{ </p>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01705">1705</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="options-permalink_8php_source.html#l00074">$home_path</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01413">__get_option()</a>, <a class="el" href="load-scripts_8php_source.html#l00011">ABSPATH</a>, <a class="el" href="wp-admin_2includes_2_file_8php_source.html#l00081">get_home_path()</a>, <a class="el" href="admin-ajax_8php_source.html#l00064">str_replace</a>, and <a class="el" href="setup-config_8php_source.html#l00040">WP_CONTENT_DIR</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l01848">make_site_theme()</a>.</p>
<div class="fragment"><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                                                                {</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <a class="code" href="options-permalink_8php.html#ae6a00c5418f0bef00d8fc6e3eab08037">$home_path</a> = <a class="code" href="wp-admin_2includes_2_file_8php.html#aefba71100e8eaa464359f61a4081a210">get_home_path</a>();</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    $site_dir = <a class="code" href="setup-config_8php.html#aa03cafb2b326885f63ee3e018f14f168">WP_CONTENT_DIR</a> . <span class="stringliteral">&quot;/themes/$template&quot;</span>;</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="keywordflow">if</span> (! file_exists(<span class="stringliteral">&quot;$home_path/index.php&quot;</span>))</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="comment">// Copy files from the old locations to the site theme.</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="comment">// TODO: This does not copy arbitrary include dependencies. Only the</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <span class="comment">// standard WP files are copied.</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    $files = array(<span class="stringliteral">&#39;index.php&#39;</span> =&gt; <span class="stringliteral">&#39;index.php&#39;</span>, <span class="stringliteral">&#39;wp-layout.css&#39;</span> =&gt; <span class="stringliteral">&#39;style.css&#39;</span>, <span class="stringliteral">&#39;wp-comments.php&#39;</span> =&gt; <span class="stringliteral">&#39;comments.php&#39;</span>, <span class="stringliteral">&#39;wp-comments-popup.php&#39;</span> =&gt; <span class="stringliteral">&#39;comments-popup.php&#39;</span>);</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    <span class="keywordflow">foreach</span> ($files as $oldfile =&gt; $newfile) {</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <span class="keywordflow">if</span> ($oldfile == <span class="stringliteral">&#39;index.php&#39;</span>)</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;            $oldpath = <a class="code" href="options-permalink_8php.html#ae6a00c5418f0bef00d8fc6e3eab08037">$home_path</a>;</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;            $oldpath = <a class="code" href="load-scripts_8php.html#a495f94983b95273ad267511b2411351f">ABSPATH</a>;</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        <span class="keywordflow">if</span> ($oldfile == <span class="stringliteral">&#39;index.php&#39;</span>) { <span class="comment">// Check to make sure it&#39;s not a new index</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;            $index = implode(<span class="stringliteral">&#39;&#39;</span>, <a class="code" href="namespacefile.html">file</a>(<span class="stringliteral">&quot;$oldpath/$oldfile&quot;</span>));</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;            <span class="keywordflow">if</span> (strpos($index, <span class="stringliteral">&#39;WP_USE_THEMES&#39;</span>) !== <span class="keyword">false</span>) {</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                <span class="keywordflow">if</span> (! @copy(<a class="code" href="setup-config_8php.html#aa03cafb2b326885f63ee3e018f14f168">WP_CONTENT_DIR</a> . <span class="stringliteral">&#39;/themes/&#39;</span> . WP_DEFAULT_THEME . <span class="stringliteral">&#39;/index.php&#39;</span>, <span class="stringliteral">&quot;$site_dir/$newfile&quot;</span>))</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                <span class="keywordflow">continue</span>; <span class="comment">// Don&#39;t copy anything</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;                }</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        }</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        <span class="keywordflow">if</span> (! @copy(<span class="stringliteral">&quot;$oldpath/$oldfile&quot;</span>, <span class="stringliteral">&quot;$site_dir/$newfile&quot;</span>))</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        chmod(<span class="stringliteral">&quot;$site_dir/$newfile&quot;</span>, 0777);</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        <span class="comment">// Update the blog header include in each file.</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        $lines = explode(<span class="stringliteral">&quot;\n&quot;</span>, implode(<span class="stringliteral">&#39;&#39;</span>, <a class="code" href="namespacefile.html">file</a>(<span class="stringliteral">&quot;$site_dir/$newfile&quot;</span>)));</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        <span class="keywordflow">if</span> ($lines) {</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;            $f = fopen(<span class="stringliteral">&quot;$site_dir/$newfile&quot;</span>, <span class="charliteral">&#39;w&#39;</span>);</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;            <span class="keywordflow">foreach</span> ($lines as $line) {</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/require.*wp-blog-header/&#39;</span>, $line))</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                    $line = <span class="stringliteral">&#39;//&#39;</span> . $line;</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;                <span class="comment">// Update stylesheet references.</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;                $line = <a class="code" href="admin-ajax_8php.html#a7e2b5c5f59b53e18d1dc6bf6ff251ed2">str_replace</a>(<span class="stringliteral">&quot;&lt;?php echo __get_option(&#39;siteurl&#39;); ?&gt;/wp-layout.css&quot;</span>, <span class="stringliteral">&quot;&lt;?php bloginfo(&#39;stylesheet_url&#39;); ?&gt;&quot;</span>, $line);</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;                <span class="comment">// Update comments template inclusion.</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;                $line = <a class="code" href="admin-ajax_8php.html#a7e2b5c5f59b53e18d1dc6bf6ff251ed2">str_replace</a>(<span class="stringliteral">&quot;&lt;?php include(ABSPATH . &#39;wp-comments.php&#39;); ?&gt;&quot;</span>, <span class="stringliteral">&quot;&lt;?php comments_template(); ?&gt;&quot;</span>, $line);</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;                fwrite($f, <span class="stringliteral">&quot;{$line}\n&quot;</span>);</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;            }</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            fclose($f);</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        }</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    }</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="comment">// Add a theme header.</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    $header = <span class="stringliteral">&quot;/*\nTheme Name: $theme_name\nTheme URI: &quot;</span> . <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;siteurl&#39;</span>) . <span class="stringliteral">&quot;\nDescription: A theme automatically created by the update.\nVersion: 1.0\nAuthor: Moi\n*/\n&quot;</span>;</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    $stylelines = file_get_contents(<span class="stringliteral">&quot;$site_dir/style.css&quot;</span>);</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="keywordflow">if</span> ($stylelines) {</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        $f = fopen(<span class="stringliteral">&quot;$site_dir/style.css&quot;</span>, <span class="charliteral">&#39;w&#39;</span>);</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        fwrite($f, $header);</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        fwrite($f, $stylelines);</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;        fclose($f);</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    }</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;}</div>
<div class="ttc" id="includes_2upgrade_8php_html_a913d174175f69bd5da3dba3288acc2b1"><div class="ttname"><a href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a></div><div class="ttdeci">__get_option($setting)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01413">upgrade.php:1413</a></div></div>
<div class="ttc" id="load-scripts_8php_html_a495f94983b95273ad267511b2411351f"><div class="ttname"><a href="load-scripts_8php.html#a495f94983b95273ad267511b2411351f">ABSPATH</a></div><div class="ttdeci">const ABSPATH</div><div class="ttdef"><b>Definition:</b> <a href="load-scripts_8php_source.html#l00011">load-scripts.php:11</a></div></div>
<div class="ttc" id="setup-config_8php_html_aa03cafb2b326885f63ee3e018f14f168"><div class="ttname"><a href="setup-config_8php.html#aa03cafb2b326885f63ee3e018f14f168">WP_CONTENT_DIR</a></div><div class="ttdeci">const WP_CONTENT_DIR</div><div class="ttdef"><b>Definition:</b> <a href="setup-config_8php_source.html#l00040">setup-config.php:40</a></div></div>
<div class="ttc" id="wp-admin_2includes_2_file_8php_html_aefba71100e8eaa464359f61a4081a210"><div class="ttname"><a href="wp-admin_2includes_2_file_8php.html#aefba71100e8eaa464359f61a4081a210">get_home_path</a></div><div class="ttdeci">get_home_path()</div><div class="ttdef"><b>Definition:</b> <a href="wp-admin_2includes_2_file_8php_source.html#l00081">file.php:81</a></div></div>
<div class="ttc" id="admin-ajax_8php_html_a7e2b5c5f59b53e18d1dc6bf6ff251ed2"><div class="ttname"><a href="admin-ajax_8php.html#a7e2b5c5f59b53e18d1dc6bf6ff251ed2">str_replace</a></div><div class="ttdeci">if(!empty($_GET['action'])&amp;&amp;in_array($_GET['action'], $core_actions_get)) add_action( 'wp_ajax_'.$_GET['action'] str_replace( '-', '_', $_GET['action'])</div><div class="ttdef"><b>Definition:</b> <a href="admin-ajax_8php_source.html#l00064">admin-ajax.php:64</a></div></div>
<div class="ttc" id="options-permalink_8php_html_ae6a00c5418f0bef00d8fc6e3eab08037"><div class="ttname"><a href="options-permalink_8php.html#ae6a00c5418f0bef00d8fc6e3eab08037">$home_path</a></div><div class="ttdeci">$home_path</div><div class="ttdef"><b>Definition:</b> <a href="options-permalink_8php_source.html#l00074">options-permalink.php:74</a></div></div>
<div class="ttc" id="namespacefile_html"><div class="ttname"><a href="namespacefile.html">file</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a278f8eaf153a74f3348fe92d16e044d2_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a278f8eaf153a74f3348fe92d16e044d2_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a278f8eaf153a74f3348fe92d16e044d2_cgraph" id="includes_2upgrade_8php_a278f8eaf153a74f3348fe92d16e044d2_cgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1" title="__get_option" alt="" coords="218,56,314,83"/><area shape="rect" id="node6" href="wp-admin_2includes_2_file_8php.html#aefba71100e8eaa464359f61a4081a210" title="get_home_path" alt="" coords="211,107,321,133"/><area shape="rect" id="node3" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="369,5,500,32"/><area shape="rect" id="node5" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="548,107,660,133"/><area shape="rect" id="node4" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="557,5,651,32"/><area shape="rect" id="node7" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="393,107,476,133"/><area shape="rect" id="node8" href="formatting_8php.html#a996c0584f3d97040938ef0073352c114" title="trailingslashit" alt="" coords="385,157,484,184"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a278f8eaf153a74f3348fe92d16e044d2_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a278f8eaf153a74f3348fe92d16e044d2_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a278f8eaf153a74f3348fe92d16e044d2_icgraph" id="includes_2upgrade_8php_a278f8eaf153a74f3348fe92d16e044d2_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#aabe08bc33812c096cbe094c1fa7c95ef" title="make_site_theme" alt="" coords="211,13,336,39"/><area shape="rect" id="node3" href="includes_2upgrade_8php.html#aa1681e2b2e9fc1c0ebaa20a05c278067" title="upgrade_130" alt="" coords="384,13,480,39"/><area shape="rect" id="node4" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="528,13,616,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4af9a7ccd99686b9d07aa3e0aa9e2444"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">maybe_add_column </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$table_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$column_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$create_ddl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="includes_2upgrade_8php.html#a4af9a7ccd99686b9d07aa3e0aa9e2444">maybe_add_column()</a> Add column to db table if it doesn't exist. Returns: true if already exists or on successful completion false on error </p>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01366">1366</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>.</p>
<div class="fragment"><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                                                                  {</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="keywordflow">foreach</span> ($wpdb-&gt;get_col(<span class="stringliteral">&quot;DESC $table_name&quot;</span>, 0) as $column ) {</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <span class="keywordflow">if</span> ($column == $column_name) {</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        }</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    }</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="comment">//didn&#39;t find it try to create it.</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    $q = $wpdb-&gt;query($create_ddl);</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <span class="comment">// we cannot directly tell that whether this succeeded!</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <span class="keywordflow">foreach</span> ($wpdb-&gt;get_col(<span class="stringliteral">&quot;DESC $table_name&quot;</span>, 0) as $column ) {</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        <span class="keywordflow">if</span> ($column == $column_name) {</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        }</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    }</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;}</div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac900ebb6c033deed947b02120cea6f98"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">maybe_create_table </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$table_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$create_ddl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>{ </p>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01307">1307</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>.</p>
<div class="fragment"><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                                                      {</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="keywordflow">if</span> ( $wpdb-&gt;get_var(<span class="stringliteral">&quot;SHOW TABLES LIKE &#39;$table_name&#39;&quot;</span>) == $table_name )</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="comment">//didn&#39;t find it try to create it.</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    $q = $wpdb-&gt;query($create_ddl);</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="comment">// we cannot directly tell that whether this succeeded!</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="keywordflow">if</span> ( $wpdb-&gt;get_var(<span class="stringliteral">&quot;SHOW TABLES LIKE &#39;$table_name&#39;&quot;</span>) == $table_name )</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;}</div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1fb4ce36d884c19a927a8f6d0c9128a3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">maybe_disable_automattic_widgets </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Disables the Automattic widgets plugin, which was merged into core.</p>
<dl class="section since"><dt>Since</dt><dd>2.2.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01937">1937</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="plugins_8php_source.html#l00020">$plugin</a>, <a class="el" href="plugin-editor_8php_source.html#l00025">$plugins</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01413">__get_option()</a>, and <a class="el" href="option_8php_source.html#l00214">update_option()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                                            {</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <a class="code" href="plugin-editor_8php.html#a4ab51386acb82cd0a0066eac2567b2bd">$plugins</a> = <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>( <span class="stringliteral">&#39;active_plugins&#39;</span> );</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    <span class="keywordflow">foreach</span> ( (array) <a class="code" href="plugin-editor_8php.html#a4ab51386acb82cd0a0066eac2567b2bd">$plugins</a> as <a class="code" href="plugins_8php.html#ada8a7130088351710bb02ed622d6bf65">$plugin</a> ) {</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        <span class="keywordflow">if</span> ( basename( $plugin ) == <span class="stringliteral">&#39;widgets.php&#39;</span> ) {</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;            array_splice( <a class="code" href="plugin-editor_8php.html#a4ab51386acb82cd0a0066eac2567b2bd">$plugins</a>, array_search( $plugin, <a class="code" href="plugin-editor_8php.html#a4ab51386acb82cd0a0066eac2567b2bd">$plugins</a> ), 1 );</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;            <a class="code" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a>( <span class="stringliteral">&#39;active_plugins&#39;</span>, <a class="code" href="plugin-editor_8php.html#a4ab51386acb82cd0a0066eac2567b2bd">$plugins</a> );</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;        }</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    }</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;}</div>
<div class="ttc" id="option_8php_html_a7c47bc5d444687bebd583e6b5dfc04bc"><div class="ttname"><a href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a></div><div class="ttdeci">update_option($option, $newvalue)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00214">option.php:214</a></div></div>
<div class="ttc" id="plugin-editor_8php_html_a4ab51386acb82cd0a0066eac2567b2bd"><div class="ttname"><a href="plugin-editor_8php.html#a4ab51386acb82cd0a0066eac2567b2bd">$plugins</a></div><div class="ttdeci">$plugins</div><div class="ttdef"><b>Definition:</b> <a href="plugin-editor_8php_source.html#l00025">plugin-editor.php:25</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a913d174175f69bd5da3dba3288acc2b1"><div class="ttname"><a href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a></div><div class="ttdeci">__get_option($setting)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01413">upgrade.php:1413</a></div></div>
<div class="ttc" id="plugins_8php_html_ada8a7130088351710bb02ed622d6bf65"><div class="ttname"><a href="plugins_8php.html#ada8a7130088351710bb02ed622d6bf65">$plugin</a></div><div class="ttdeci">$plugin</div><div class="ttdef"><b>Definition:</b> <a href="plugins_8php_source.html#l00020">plugins.php:20</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a1fb4ce36d884c19a927a8f6d0c9128a3_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a1fb4ce36d884c19a927a8f6d0c9128a3_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a1fb4ce36d884c19a927a8f6d0c9128a3_cgraph" id="includes_2upgrade_8php_a1fb4ce36d884c19a927a8f6d0c9128a3_cgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1" title="__get_option" alt="" coords="533,892,629,919"/><area shape="rect" id="node6" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc" title="update_option" alt="" coords="231,943,333,970"/><area shape="rect" id="node3" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="712,867,843,894"/><area shape="rect" id="node5" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="721,918,833,944"/><area shape="rect" id="node4" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="937,867,1031,894"/><area shape="rect" id="node7" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="515,213,648,254"/><area shape="rect" id="node9" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="1392,462,1483,488"/><area shape="rect" id="node14" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="1137,1070,1267,1096"/><area shape="rect" id="node16" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1385,1222,1490,1248"/><area shape="rect" id="node20" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="527,436,636,463"/><area shape="rect" id="node24" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="1163,968,1241,995"/><area shape="rect" id="node44" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="540,1070,623,1096"/><area shape="rect" id="node45" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="725,1222,830,1248"/><area shape="rect" id="node46" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="381,791,467,818"/><area shape="rect" id="node47" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="523,715,639,742"/><area shape="rect" id="node8" href="wp-includes_2functions_8php.html#a06d38a93c806c187fd21200c1baa9f53" title="wp_die" alt="" coords="953,56,1015,83"/><area shape="rect" id="node10" href="formatting_8php.html#a77a1b666b7ca0e393239a9e1d1af72d3" title="esc_html" alt="" coords="740,158,815,184"/><area shape="rect" id="node11" href="formatting_8php.html#a745879b47424ac7b0d3b95a1edec8361" title="wp_check_invalid_utf8" alt="" coords="909,158,1059,184"/><area shape="rect" id="node13" href="formatting_8php.html#ab9121c7a11ad101936875a65b233e126" title="_wp_specialchars" alt="" coords="921,512,1047,539"/><area shape="rect" id="node12" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="1161,158,1243,184"/><area shape="rect" id="node18" href="formatting_8php.html#a4389f130de336d59e890c79b10a60beb" title="wp_specialchars_decode" alt="" coords="1119,563,1285,590"/><area shape="rect" id="node19" href="kses_8php.html#abc0e5ed7e9bad89cc998a35b48653fdb" title="wp_kses_normalize_entities" alt="" coords="1109,512,1295,539"/><area shape="rect" id="node15" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="1393,1070,1481,1096"/><area shape="rect" id="node17" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1383,1120,1491,1147"/><area shape="rect" id="node21" href="formatting_8php.html#a1a391a56d1c6c0e52239a553a0dbfb73" title="sanitize_email" alt="" coords="931,614,1037,640"/><area shape="rect" id="node22" href="formatting_8php.html#aa394269ea323c88435820bb0a0f5912f" title="is_email" alt="" coords="742,614,813,640"/><area shape="rect" id="node26" href="wp-admin_2includes_2template_8php.html#ac54155d98db655b34d0c2c87d1e53c64" title="add_settings_error" alt="" coords="713,310,842,336"/><area shape="rect" id="node27" href="kses_8php.html#aa0817828c22f5e89ff755ae1ad1de60c" title="wp_kses_post" alt="" coords="725,411,830,438"/><area shape="rect" id="node34" href="kses_8php.html#a050aa6ac503f4f1a2eb655efe9b42dc6" title="wp_kses_data" alt="" coords="725,462,830,488"/><area shape="rect" id="node36" href="formatting_8php.html#ad9e809b6901d247527672e11ce5d7368" title="esc_url_raw" alt="" coords="732,563,823,590"/><area shape="rect" id="node43" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332" title="get_available_languages" alt="" coords="696,360,859,387"/><area shape="rect" id="node23" href="wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532" title="_deprecated_argument" alt="" coords="907,766,1061,792"/><area shape="rect" id="node25" href="wp-includes_2plugin_8php.html#af891e88ab346a2da31111facfcf6b2cf" title="_wp_call_all_hook" alt="" coords="1374,968,1501,995"/><area shape="rect" id="node28" href="kses_8php.html#a16c90f8f4b5152db3c88044526e28f59" title="wp_kses" alt="" coords="947,411,1021,438"/><area shape="rect" id="node29" href="wp-includes_2functions_8php.html#a410d6d8e60b99a2fbc62fe8116978711" title="wp_allowed_protocols" alt="" coords="1128,462,1276,488"/><area shape="rect" id="node30" href="kses_8php.html#a6a32ba00333b67cff42a76ec3762e5c3" title="wp_kses_no_null" alt="" coords="1807,859,1929,886"/><area shape="rect" id="node31" href="kses_8php.html#a3dec56a527f620ff81fa9dc188238b4f" title="wp_kses_js_entities" alt="" coords="1133,310,1271,336"/><area shape="rect" id="node32" href="kses_8php.html#a387ea2ab906936be7f094a0152f7886a" title="wp_kses_hook" alt="" coords="1148,411,1256,438"/><area shape="rect" id="node33" href="kses_8php.html#a1157570413297149e62e627d8e10c6b9" title="wp_kses_split" alt="" coords="1150,360,1254,387"/><area shape="rect" id="node35" href="wp-includes_2plugin_8php.html#ae088c31761ae2cdcff6491755b1bdab6" title="current_filter" alt="" coords="937,563,1031,590"/><area shape="rect" id="node37" href="formatting_8php.html#a42f495a436026ff2811d0d80caca937d" title="esc_url" alt="" coords="952,664,1016,691"/><area shape="rect" id="node38" href="formatting_8php.html#a07cee162d2dea8a7e788f6542534490a" title="_deep_replace" alt="" coords="1149,715,1255,742"/><area shape="rect" id="node39" href="kses_8php.html#a6164e160cf41fb1682f086b13ce434a0" title="wp_kses_bad_protocol" alt="" coords="1125,918,1279,944"/><area shape="rect" id="node40" href="kses_8php.html#ac1591c243a4c8272a934db51a9b53259" title="wp_kses_bad_protocol_once" alt="" coords="1343,918,1532,944"/><area shape="rect" id="node41" href="kses_8php.html#a6a97826fbe8f92352f4acc5143cdb0f7" title="wp_kses_bad_protocol\l_once2" alt="" coords="1580,910,1735,952"/><area shape="rect" id="node42" href="kses_8php.html#a6b7c56d4169bffd3e6943c570f4c4b94" title="wp_kses_decode_entities" alt="" coords="1783,918,1953,944"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a1fb4ce36d884c19a927a8f6d0c9128a3_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a1fb4ce36d884c19a927a8f6d0c9128a3_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a1fb4ce36d884c19a927a8f6d0c9128a3_icgraph" id="includes_2upgrade_8php_a1fb4ce36d884c19a927a8f6d0c9128a3_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="231,13,319,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abcaf2c635c689728811b6cadec1ba7c7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">maybe_disable_link_manager </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Disables the Link Manager on upgrade, if at the time of upgrade, no links exist in the DB.</p>
<dl class="section since"><dt>Since</dt><dd>3.5.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01954">1954</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="load-scripts_8php_source.html#l00042">get_option()</a>, and <a class="el" href="option_8php_source.html#l00214">update_option()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                                      {</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &gt;= 22006 &amp;&amp; <a class="code" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&#39;link_manager_enabled&#39;</span> ) &amp;&amp; ! $wpdb-&gt;get_var( <span class="stringliteral">&quot;SELECT link_id FROM $wpdb-&gt;links LIMIT 1&quot;</span> ) )</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        <a class="code" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a>( <span class="stringliteral">&#39;link_manager_enabled&#39;</span>, 0 );</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;}</div>
<div class="ttc" id="option_8php_html_a7c47bc5d444687bebd583e6b5dfc04bc"><div class="ttname"><a href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a></div><div class="ttdeci">update_option($option, $newvalue)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00214">option.php:214</a></div></div>
<div class="ttc" id="load-scripts_8php_html_aaf1220eff85fdd291725eabf743b2ed3"><div class="ttname"><a href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a></div><div class="ttdeci">get_option()</div><div class="ttdef"><b>Definition:</b> <a href="load-scripts_8php_source.html#l00042">load-scripts.php:42</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_abcaf2c635c689728811b6cadec1ba7c7_cgraph.png" border="0" usemap="#includes_2upgrade_8php_abcaf2c635c689728811b6cadec1ba7c7_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_abcaf2c635c689728811b6cadec1ba7c7_cgraph" id="includes_2upgrade_8php_abcaf2c635c689728811b6cadec1ba7c7_cgraph">
<area shape="rect" id="node2" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="1119,112,1202,138"/><area shape="rect" id="node3" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc" title="update_option" alt="" coords="189,1024,292,1050"/><area shape="rect" id="node4" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="473,480,607,522"/><area shape="rect" id="node6" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="1351,618,1441,645"/><area shape="rect" id="node10" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="1095,1417,1226,1444"/><area shape="rect" id="node12" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1343,1353,1449,1380"/><area shape="rect" id="node16" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="485,644,595,670"/><area shape="rect" id="node20" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="1121,922,1200,949"/><area shape="rect" id="node40" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="499,1277,581,1304"/><area shape="rect" id="node41" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="683,1176,789,1202"/><area shape="rect" id="node45" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="340,1024,425,1050"/><area shape="rect" id="node46" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="482,1176,598,1202"/><area shape="rect" id="node5" href="wp-includes_2functions_8php.html#a06d38a93c806c187fd21200c1baa9f53" title="wp_die" alt="" coords="911,61,974,88"/><area shape="rect" id="node7" href="formatting_8php.html#a77a1b666b7ca0e393239a9e1d1af72d3" title="esc_html" alt="" coords="699,416,773,442"/><area shape="rect" id="node8" href="formatting_8php.html#a745879b47424ac7b0d3b95a1edec8361" title="wp_check_invalid_utf8" alt="" coords="867,213,1018,240"/><area shape="rect" id="node9" href="formatting_8php.html#ab9121c7a11ad101936875a65b233e126" title="_wp_specialchars" alt="" coords="880,453,1005,480"/><area shape="rect" id="node14" href="formatting_8php.html#a4389f130de336d59e890c79b10a60beb" title="wp_specialchars_decode" alt="" coords="1077,416,1244,442"/><area shape="rect" id="node15" href="kses_8php.html#abc0e5ed7e9bad89cc998a35b48653fdb" title="wp_kses_normalize_entities" alt="" coords="1068,466,1253,493"/><area shape="rect" id="node11" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="1352,1417,1440,1444"/><area shape="rect" id="node13" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1342,1480,1450,1506"/><area shape="rect" id="node17" href="formatting_8php.html#a1a391a56d1c6c0e52239a553a0dbfb73" title="sanitize_email" alt="" coords="890,770,995,797"/><area shape="rect" id="node18" href="formatting_8php.html#aa394269ea323c88435820bb0a0f5912f" title="is_email" alt="" coords="701,821,771,848"/><area shape="rect" id="node22" href="wp-admin_2includes_2template_8php.html#ac54155d98db655b34d0c2c87d1e53c64" title="add_settings_error" alt="" coords="671,669,801,696"/><area shape="rect" id="node23" href="kses_8php.html#aa0817828c22f5e89ff755ae1ad1de60c" title="wp_kses_post" alt="" coords="683,517,789,544"/><area shape="rect" id="node30" href="kses_8php.html#a050aa6ac503f4f1a2eb655efe9b42dc6" title="wp_kses_data" alt="" coords="683,618,789,645"/><area shape="rect" id="node32" href="formatting_8php.html#ad9e809b6901d247527672e11ce5d7368" title="esc_url_raw" alt="" coords="691,466,781,493"/><area shape="rect" id="node39" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332" title="get_available_languages" alt="" coords="655,568,817,594"/><area shape="rect" id="node19" href="wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532" title="_deprecated_argument" alt="" coords="865,872,1020,898"/><area shape="rect" id="node21" href="wp-includes_2plugin_8php.html#af891e88ab346a2da31111facfcf6b2cf" title="_wp_call_all_hook" alt="" coords="1333,922,1459,949"/><area shape="rect" id="node24" href="kses_8php.html#a16c90f8f4b5152db3c88044526e28f59" title="wp_kses" alt="" coords="906,529,979,556"/><area shape="rect" id="node25" href="wp-includes_2functions_8php.html#a410d6d8e60b99a2fbc62fe8116978711" title="wp_allowed_protocols" alt="" coords="1087,365,1235,392"/><area shape="rect" id="node26" href="kses_8php.html#a6a32ba00333b67cff42a76ec3762e5c3" title="wp_kses_no_null" alt="" coords="1766,221,1887,248"/><area shape="rect" id="node27" href="kses_8php.html#a3dec56a527f620ff81fa9dc188238b4f" title="wp_kses_js_entities" alt="" coords="1091,568,1230,594"/><area shape="rect" id="node28" href="kses_8php.html#a387ea2ab906936be7f094a0152f7886a" title="wp_kses_hook" alt="" coords="1107,618,1215,645"/><area shape="rect" id="node29" href="kses_8php.html#a1157570413297149e62e627d8e10c6b9" title="wp_kses_split" alt="" coords="1109,669,1213,696"/><area shape="rect" id="node31" href="wp-includes_2plugin_8php.html#ae088c31761ae2cdcff6491755b1bdab6" title="current_filter" alt="" coords="896,618,989,645"/><area shape="rect" id="node33" href="formatting_8php.html#a42f495a436026ff2811d0d80caca937d" title="esc_url" alt="" coords="911,340,975,366"/><area shape="rect" id="node34" href="formatting_8php.html#a07cee162d2dea8a7e788f6542534490a" title="_deep_replace" alt="" coords="1107,264,1214,290"/><area shape="rect" id="node35" href="kses_8php.html#a6164e160cf41fb1682f086b13ce434a0" title="wp_kses_bad_protocol" alt="" coords="1083,162,1238,189"/><area shape="rect" id="node36" href="kses_8php.html#ac1591c243a4c8272a934db51a9b53259" title="wp_kses_bad_protocol_once" alt="" coords="1301,162,1491,189"/><area shape="rect" id="node37" href="kses_8php.html#a6a97826fbe8f92352f4acc5143cdb0f7" title="wp_kses_bad_protocol\l_once2" alt="" coords="1539,155,1693,196"/><area shape="rect" id="node38" href="kses_8php.html#a6b7c56d4169bffd3e6943c570f4c4b94" title="wp_kses_decode_entities" alt="" coords="1741,162,1912,189"/><area shape="rect" id="node42" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="680,1378,792,1405"/><area shape="rect" id="node43" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="671,1226,801,1253"/><area shape="rect" id="node44" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="895,1176,990,1202"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_abcaf2c635c689728811b6cadec1ba7c7_icgraph.png" border="0" usemap="#includes_2upgrade_8php_abcaf2c635c689728811b6cadec1ba7c7_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_abcaf2c635c689728811b6cadec1ba7c7_icgraph" id="includes_2upgrade_8php_abcaf2c635c689728811b6cadec1ba7c7_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="189,13,277,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4123a7eed5c3db1e2e471e636e7f4019"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pre_schema_upgrade </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Runs before the schema is upgraded.</p>
<dl class="section since"><dt>Since</dt><dd>2.9.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01966">1966</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="version_8php_source.html#l00014">$wp_db_version</a>, <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="wp-includes_2functions_8php_source.html#l03314">is_main_network()</a>, and <a class="el" href="load_8php_source.html#l00677">is_multisite()</a>.</p>
<div class="fragment"><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;                              {</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    global $wp_current_db_version, <a class="code" href="version_8php.html#a54d5b26d7b1ffa70fc22506a2cfedfea">$wp_db_version</a>, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    <span class="comment">// Upgrade versions prior to 2.9</span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 11557 ) {</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        <span class="comment">// Delete duplicate options. Keep the option with the highest option_id.</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;DELETE o1 FROM $wpdb-&gt;options AS o1 JOIN $wpdb-&gt;options AS o2 USING (`option_name`) WHERE o2.option_id &gt; o1.option_id&quot;</span>);</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;        <span class="comment">// Drop the old primary key and add the new.</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;options DROP PRIMARY KEY, ADD PRIMARY KEY(option_id)&quot;</span>);</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;        <span class="comment">// Drop the old option_name index. dbDelta() doesn&#39;t do the drop.</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;options DROP INDEX option_name&quot;</span>);</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    }</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <span class="comment">// Upgrade verions prior to 3.7</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 25179 &amp;&amp; <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() &amp;&amp; <a class="code" href="wp-includes_2functions_8php.html#a494c188ad4536ef708f4d684cc1a8178">is_main_network</a>() &amp;&amp; ! defined( <span class="stringliteral">&#39;DO_NOT_UPGRADE_GLOBAL_TABLES&#39;</span> ) ) {</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;signups ADD signup_id BIGINT(20) NOT NULL AUTO_INCREMENT PRIMARY KEY FIRST&quot;</span> );</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;signups DROP INDEX domain&quot;</span> );</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;    }</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;}</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;<span class="keywordflow">if</span> ( !function_exists( <span class="stringliteral">&#39;install_global_terms&#39;</span> ) ) :</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="keyword">function</span> install_global_terms() {</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>, <a class="code" href="schema_8php.html#a4c63261ce2e93e0e25a13073aa748b53">$charset_collate</a>;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    $ms_queries = <span class="stringliteral">&quot;</span></div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="stringliteral">CREATE TABLE $wpdb-&gt;sitecategories (</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="stringliteral">  cat_ID bigint(20) NOT NULL auto_increment,</span></div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="stringliteral">  cat_name varchar(55) NOT NULL default &#39;&#39;,</span></div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;<span class="stringliteral">  category_nicename varchar(200) NOT NULL default &#39;&#39;,</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="stringliteral">  last_updated timestamp NOT NULL,</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="stringliteral">  PRIMARY KEY  (cat_ID),</span></div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="stringliteral">  KEY category_nicename (category_nicename),</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="stringliteral">  KEY last_updated (last_updated)</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;<span class="stringliteral">) $charset_collate;</span></div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;<span class="stringliteral">&quot;</span>;</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="comment">// now create tables</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7">dbDelta</a>( $ms_queries );</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;}</div>
<div class="ttc" id="schema_8php_html_a4c63261ce2e93e0e25a13073aa748b53"><div class="ttname"><a href="schema_8php.html#a4c63261ce2e93e0e25a13073aa748b53">$charset_collate</a></div><div class="ttdeci">global $charset_collate</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a036ba9e030cb4feddc2022ac115784f7"><div class="ttname"><a href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7">dbDelta</a></div><div class="ttdeci">dbDelta($queries= '', $execute=true)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01471">upgrade.php:1471</a></div></div>
<div class="ttc" id="wp-includes_2functions_8php_html_a494c188ad4536ef708f4d684cc1a8178"><div class="ttname"><a href="wp-includes_2functions_8php.html#a494c188ad4536ef708f4d684cc1a8178">is_main_network</a></div><div class="ttdeci">is_main_network($network_id=null)</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2functions_8php_source.html#l03314">functions.php:3314</a></div></div>
<div class="ttc" id="load_8php_html_a72e5386fcd7a5ce7526d208d0b03a0af"><div class="ttname"><a href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a></div><div class="ttdeci">is_multisite()</div><div class="ttdef"><b>Definition:</b> <a href="load_8php_source.html#l00677">load.php:677</a></div></div>
<div class="ttc" id="version_8php_html_a54d5b26d7b1ffa70fc22506a2cfedfea"><div class="ttname"><a href="version_8php.html#a54d5b26d7b1ffa70fc22506a2cfedfea">$wp_db_version</a></div><div class="ttdeci">$wp_db_version</div><div class="ttdef"><b>Definition:</b> <a href="version_8php_source.html#l00014">version.php:14</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a4123a7eed5c3db1e2e471e636e7f4019_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a4123a7eed5c3db1e2e471e636e7f4019_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a4123a7eed5c3db1e2e471e636e7f4019_cgraph" id="includes_2upgrade_8php_a4123a7eed5c3db1e2e471e636e7f4019_cgraph">
<area shape="rect" id="node2" href="wp-includes_2functions_8php.html#a494c188ad4536ef708f4d684cc1a8178" title="is_main_network" alt="" coords="200,56,319,83"/><area shape="rect" id="node3" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="377,5,465,32"/><area shape="rect" id="node4" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="368,56,473,83"/><area shape="rect" id="node5" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="367,107,475,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a80fbc8c3883ba92927aebc7a131d2cc3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">translate_level_to_role </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$level</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Translate user level to user role name.</p>
<dl class="section since"><dt>Since</dt><dd>2.0.0</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$level</td><td>User level. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string User role name. </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01897">1897</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00631">upgrade_160()</a>.</p>
<div class="fragment"><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                                         {</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    <span class="keywordflow">switch</span> ($level) {</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <span class="keywordflow">case</span> 10:</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    <span class="keywordflow">case</span> 9:</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    <span class="keywordflow">case</span> 8:</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;administrator&#39;</span>;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <span class="keywordflow">case</span> 7:</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="keywordflow">case</span> 6:</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    <span class="keywordflow">case</span> 5:</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;editor&#39;</span>;</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;author&#39;</span>;</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;contributor&#39;</span>;</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;subscriber&#39;</span>;</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    }</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a80fbc8c3883ba92927aebc7a131d2cc3_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a80fbc8c3883ba92927aebc7a131d2cc3_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a80fbc8c3883ba92927aebc7a131d2cc3_icgraph" id="includes_2upgrade_8php_a80fbc8c3883ba92927aebc7a131d2cc3_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#a3fb25174b5e402c9666da33248094bfe" title="upgrade_160" alt="" coords="204,5,300,32"/><area shape="rect" id="node3" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="348,5,436,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac9f9f0f1c15e3c295fbe0eea4fcad01b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_100 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 1.0.</p>
<dl class="section since"><dt>Since</dt><dd>1.0.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00418">418</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="edit-form-advanced_8php_source.html#l00433">$post</a>, <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="export_8php_source.html#l00173">endforeach</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00021">endif</a>, and <a class="el" href="formatting_8php_source.html#l00951">sanitize_title()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                       {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">// Get the title and ID of every post, post_name to check if it already has a value</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    $posts = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, post_title, post_name FROM $wpdb-&gt;posts WHERE post_name = &#39;&#39;&quot;</span>);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">if</span> ($posts) {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordflow">foreach</span>($posts as <a class="code" href="edit-form-advanced_8php.html#ae52c52c4dfa2970c393095396ff934fd">$post</a>) {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <span class="keywordflow">if</span> (<span class="stringliteral">&#39;&#39;</span> == $post-&gt;post_name) {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                $newtitle = <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>($post-&gt;post_title);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_name = %s WHERE ID = %d&quot;</span>, $newtitle, $post-&gt;ID) );</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    $categories = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT cat_ID, cat_name, category_nicename FROM $wpdb-&gt;categories&quot;</span>);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">foreach</span> ($categories as $category) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordflow">if</span> (<span class="stringliteral">&#39;&#39;</span> == $category-&gt;category_nicename) {</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            $newtitle = <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>($category-&gt;cat_name);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;categories, array(<span class="stringliteral">&#39;category_nicename&#39;</span> =&gt; $newtitle), array(<span class="stringliteral">&#39;cat_ID&#39;</span> =&gt; $category-&gt;cat_ID) );</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;options SET option_value = REPLACE(option_value, &#39;wp-links/links-images/&#39;, &#39;wp-images/links/&#39;)</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="stringliteral">    WHERE option_name LIKE &#39;links_rating_image%&#39;</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="stringliteral">    AND option_value LIKE &#39;wp-links/links-images/%&#39;&quot;</span>);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    $done_ids = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT DISTINCT post_id FROM $wpdb-&gt;post2cat&quot;</span>);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordflow">if</span> ($done_ids) :</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">foreach</span> ($done_ids as $done_id) :</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            $done_posts[] = $done_id-&gt;post_id;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <a class="code" href="export_8php.html#a672d9707ef91db026c210f98cc601123">endforeach</a>;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        $catwhere = <span class="stringliteral">&#39; AND ID NOT IN (&#39;</span> . implode(<span class="charliteral">&#39;,&#39;</span>, $done_posts) . <span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        $catwhere = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    $allposts = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, post_category FROM $wpdb-&gt;posts WHERE post_category != &#39;0&#39; $catwhere&quot;</span>);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">if</span> ($allposts) :</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keywordflow">foreach</span> ($allposts as $post) {</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            <span class="comment">// Check to see if it&#39;s already been imported</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            $cat = $wpdb-&gt;get_row( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT * FROM $wpdb-&gt;post2cat WHERE post_id = %d AND category_id = %d&quot;</span>, $post-&gt;ID, $post-&gt;post_category) );</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <span class="keywordflow">if</span> (!$cat &amp;&amp; 0 != $post-&gt;post_category) { <span class="comment">// If there&#39;s no result</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                $wpdb-&gt;insert( $wpdb-&gt;post2cat, array(<span class="stringliteral">&#39;post_id&#39;</span> =&gt; $post-&gt;ID, <span class="stringliteral">&#39;category_id&#39;</span> =&gt; $post-&gt;post_category) );</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;}</div>
<div class="ttc" id="formatting_8php_html_ac6495c47468fb816d78bb2d2b326d808"><div class="ttname"><a href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a></div><div class="ttdeci">sanitize_title($title, $fallback_title= '', $context= 'save')</div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l00951">formatting.php:951</a></div></div>
<div class="ttc" id="edit-form-advanced_8php_html_ae52c52c4dfa2970c393095396ff934fd"><div class="ttname"><a href="edit-form-advanced_8php.html#ae52c52c4dfa2970c393095396ff934fd">$post</a></div><div class="ttdeci">if( 'page'==$post_type) do_action('submitpage_box' $post</div><div class="ttdef"><b>Definition:</b> <a href="edit-form-advanced_8php_source.html#l00433">edit-form-advanced.php:433</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_aad8d91e6a86c1c561f1ed66bc19e5a63"><div class="ttname"><a href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a></div><div class="ttdeci">if(!function_exists('wp_install'))($blog_title, $user_name, $user_email, $public, $deprecated= '', $user_password= '') endif</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00021">upgrade.php:21</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
<div class="ttc" id="export_8php_html_a672d9707ef91db026c210f98cc601123"><div class="ttname"><a href="export_8php.html#a672d9707ef91db026c210f98cc601123">endforeach</a></div><div class="ttdeci">endforeach</div><div class="ttdef"><b>Definition:</b> <a href="export_8php_source.html#l00173">export.php:173</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_ac9f9f0f1c15e3c295fbe0eea4fcad01b_cgraph.png" border="0" usemap="#includes_2upgrade_8php_ac9f9f0f1c15e3c295fbe0eea4fcad01b_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_ac9f9f0f1c15e3c295fbe0eea4fcad01b_cgraph" id="includes_2upgrade_8php_ac9f9f0f1c15e3c295fbe0eea4fcad01b_cgraph">
<area shape="rect" id="node2" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808" title="sanitize_title" alt="" coords="149,424,244,451"/><area shape="rect" id="node3" href="formatting_8php.html#a05e464b55ec2c8b334abed9864d014e9" title="remove_accents" alt="" coords="292,385,408,412"/><area shape="rect" id="node6" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="903,411,993,437"/><area shape="rect" id="node4" href="formatting_8php.html#a618ba7bdc2cf2790af2e9fa968f03615" title="seems_utf8" alt="" coords="456,385,545,412"/><area shape="rect" id="node5" href="l10n_8php.html#a6ec9fd4baced85768ba16386e9e1b339" title="get_locale" alt="" coords="460,284,541,311"/><area shape="rect" id="node7" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="1071,5,1159,32"/><area shape="rect" id="node8" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="607,284,690,311"/><area shape="rect" id="node9" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa" title="get_site_option" alt="" coords="593,208,704,235"/><area shape="rect" id="node10" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1063,309,1168,336"/><area shape="rect" id="node11" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="752,208,835,235"/><area shape="rect" id="node14" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="895,56,1001,83"/><area shape="rect" id="node16" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="883,107,1013,133"/><area shape="rect" id="node12" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="883,157,1013,184"/><area shape="rect" id="node13" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1061,208,1169,235"/><area shape="rect" id="node15" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="892,208,1004,235"/><area shape="rect" id="node17" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="1068,107,1163,133"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_ac9f9f0f1c15e3c295fbe0eea4fcad01b_icgraph.png" border="0" usemap="#includes_2upgrade_8php_ac9f9f0f1c15e3c295fbe0eea4fcad01b_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_ac9f9f0f1c15e3c295fbe0eea4fcad01b_icgraph" id="includes_2upgrade_8php_ac9f9f0f1c15e3c295fbe0eea4fcad01b_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6e6d4fb5df8f86dc0aafa740bf1dfe60"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_101 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 1.0.1.</p>
<dl class="section since"><dt>Since</dt><dd>1.0.1 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00471">471</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, and <a class="el" href="includes_2upgrade_8php_source.html#l01353">add_clean_index()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                       {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">// Clean up indices, add a few</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;posts, <span class="stringliteral">&#39;post_name&#39;</span>);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;posts, <span class="stringliteral">&#39;post_status&#39;</span>);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;categories, <span class="stringliteral">&#39;category_nicename&#39;</span>);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;comments, <span class="stringliteral">&#39;comment_approved&#39;</span>);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;comments, <span class="stringliteral">&#39;comment_post_ID&#39;</span>);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;links , <span class="stringliteral">&#39;link_category&#39;</span>);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;links , <span class="stringliteral">&#39;link_visible&#39;</span>);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;}</div>
<div class="ttc" id="includes_2upgrade_8php_html_aef14f769511df2c27368d9f7df68eaa4"><div class="ttname"><a href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a></div><div class="ttdeci">add_clean_index($table, $index)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01353">upgrade.php:1353</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a6e6d4fb5df8f86dc0aafa740bf1dfe60_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a6e6d4fb5df8f86dc0aafa740bf1dfe60_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a6e6d4fb5df8f86dc0aafa740bf1dfe60_cgraph" id="includes_2upgrade_8php_a6e6d4fb5df8f86dc0aafa740bf1dfe60_cgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4" title="add_clean_index" alt="" coords="149,5,268,32"/><area shape="rect" id="node3" href="includes_2upgrade_8php.html#a803e9c6735f71e763ab18bd8bdc630ab" title="drop_index" alt="" coords="316,5,401,32"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a6e6d4fb5df8f86dc0aafa740bf1dfe60_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a6e6d4fb5df8f86dc0aafa740bf1dfe60_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a6e6d4fb5df8f86dc0aafa740bf1dfe60_icgraph" id="includes_2upgrade_8php_a6e6d4fb5df8f86dc0aafa740bf1dfe60_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afe18c72dcd93806bfefc8bde68fccd8a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_110 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 1.2.</p>
<dl class="section since"><dt>Since</dt><dd>1.2.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00489">489</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="wp-cron_8php_source.html#l00051">$gmt_time</a>, <a class="el" href="wp-comments-post_8php_source.html#l00092">$user</a>, <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="option_8php_source.html#l00292">add_option()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01391">get_alloptions_110()</a>, and <a class="el" href="formatting_8php_source.html#l00951">sanitize_title()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                       {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="comment">// Set user_nicename.</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    $users = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, user_nickname, user_nicename FROM $wpdb-&gt;users&quot;</span>);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">foreach</span> ($users as <a class="code" href="wp-comments-post_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>) {</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">if</span> (<span class="stringliteral">&#39;&#39;</span> == $user-&gt;user_nicename) {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            $newname = <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>($user-&gt;user_nickname);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;users, array(<span class="stringliteral">&#39;user_nicename&#39;</span> =&gt; $newname), array(<span class="stringliteral">&#39;ID&#39;</span> =&gt; $user-&gt;ID) );</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        }</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    $users = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, user_pass from $wpdb-&gt;users&quot;</span>);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">foreach</span> ($users as $row) {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="keywordflow">if</span> (!preg_match(<span class="stringliteral">&#39;/^[A-Fa-f0-9]{32}$/&#39;</span>, $row-&gt;user_pass)) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;users, array(<span class="stringliteral">&#39;user_pass&#39;</span> =&gt; md5($row-&gt;user_pass)), array(<span class="stringliteral">&#39;ID&#39;</span> =&gt; $row-&gt;ID) );</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">// Get the GMT offset, we&#39;ll use that later on</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    $all_options = <a class="code" href="includes_2upgrade_8php.html#a0a23ab0934c3f2e5618f931a4ea4c483">get_alloptions_110</a>();</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    $time_difference = $all_options-&gt;time_difference;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        $server_time = time()+<a class="code" href="namespacedate.html">date</a>(<span class="charliteral">&#39;Z&#39;</span>);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    $weblogger_time = $server_time + $time_difference * HOUR_IN_SECONDS;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <a class="code" href="wp-cron_8php.html#af9569cf1bd677c4e8b7cd58bac204a84">$gmt_time</a> = time();</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    $diff_gmt_server = (<a class="code" href="wp-cron_8php.html#af9569cf1bd677c4e8b7cd58bac204a84">$gmt_time</a> - $server_time) / HOUR_IN_SECONDS;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    $diff_weblogger_server = ($weblogger_time - $server_time) / HOUR_IN_SECONDS;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    $diff_gmt_weblogger = $diff_gmt_server - $diff_weblogger_server;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    $gmt_offset = -$diff_gmt_weblogger;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="comment">// Add a gmt_offset option, with value $gmt_offset</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <a class="code" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494">add_option</a>(<span class="stringliteral">&#39;gmt_offset&#39;</span>, $gmt_offset);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="comment">// Check if we already set the GMT fields (if we did, then</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="comment">// MAX(post_date_gmt) can&#39;t be &#39;0000-00-00 00:00:00&#39;</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="comment">// &lt;michel_v&gt; I just slapped myself silly for not thinking about it earlier</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    $got_gmt_fields = ! ($wpdb-&gt;get_var(<span class="stringliteral">&quot;SELECT MAX(post_date_gmt) FROM $wpdb-&gt;posts&quot;</span>) == <span class="stringliteral">&#39;0000-00-00 00:00:00&#39;</span>);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">if</span> (!$got_gmt_fields) {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="comment">// Add or subtract time to all dates, to get GMT dates</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        $add_hours = intval($diff_gmt_weblogger);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        $add_minutes = intval(60 * ($diff_gmt_weblogger - $add_hours));</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_date_gmt = DATE_ADD(post_date, INTERVAL &#39;$add_hours:$add_minutes&#39; HOUR_MINUTE)&quot;</span>);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_modified = post_date&quot;</span>);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_modified_gmt = DATE_ADD(post_modified, INTERVAL &#39;$add_hours:$add_minutes&#39; HOUR_MINUTE) WHERE post_modified != &#39;0000-00-00 00:00:00&#39;&quot;</span>);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;comments SET comment_date_gmt = DATE_ADD(comment_date, INTERVAL &#39;$add_hours:$add_minutes&#39; HOUR_MINUTE)&quot;</span>);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;users SET user_registered = DATE_ADD(user_registered, INTERVAL &#39;$add_hours:$add_minutes&#39; HOUR_MINUTE)&quot;</span>);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;}</div>
<div class="ttc" id="wp-comments-post_8php_html_a598ca4e71b15a1313ec95f0df1027ca5"><div class="ttname"><a href="wp-comments-post_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a></div><div class="ttdeci">$user</div><div class="ttdef"><b>Definition:</b> <a href="wp-comments-post_8php_source.html#l00092">wp-comments-post.php:92</a></div></div>
<div class="ttc" id="option_8php_html_afacc3facc45e9b1cf03120755d40f494"><div class="ttname"><a href="option_8php.html#afacc3facc45e9b1cf03120755d40f494">add_option</a></div><div class="ttdeci">add_option($option, $value= '', $deprecated= '', $autoload= 'yes')</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00292">option.php:292</a></div></div>
<div class="ttc" id="namespacedate_html"><div class="ttname"><a href="namespacedate.html">date</a></div></div>
<div class="ttc" id="wp-cron_8php_html_af9569cf1bd677c4e8b7cd58bac204a84"><div class="ttname"><a href="wp-cron_8php.html#af9569cf1bd677c4e8b7cd58bac204a84">$gmt_time</a></div><div class="ttdeci">$gmt_time</div><div class="ttdef"><b>Definition:</b> <a href="wp-cron_8php_source.html#l00051">wp-cron.php:51</a></div></div>
<div class="ttc" id="formatting_8php_html_ac6495c47468fb816d78bb2d2b326d808"><div class="ttname"><a href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a></div><div class="ttdeci">sanitize_title($title, $fallback_title= '', $context= 'save')</div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l00951">formatting.php:951</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a0a23ab0934c3f2e5618f931a4ea4c483"><div class="ttname"><a href="includes_2upgrade_8php.html#a0a23ab0934c3f2e5618f931a4ea4c483">get_alloptions_110</a></div><div class="ttdeci">get_alloptions_110()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01391">upgrade.php:1391</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_afe18c72dcd93806bfefc8bde68fccd8a_cgraph.png" border="0" usemap="#includes_2upgrade_8php_afe18c72dcd93806bfefc8bde68fccd8a_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_afe18c72dcd93806bfefc8bde68fccd8a_cgraph" id="includes_2upgrade_8php_afe18c72dcd93806bfefc8bde68fccd8a_cgraph">
<area shape="rect" id="node2" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="172,841,257,868"/><area shape="rect" id="node45" href="includes_2upgrade_8php.html#a0a23ab0934c3f2e5618f931a4ea4c483" title="get_alloptions_110" alt="" coords="149,1475,280,1501"/><area shape="rect" id="node46" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808" title="sanitize_title" alt="" coords="167,1323,262,1349"/><area shape="rect" id="node3" href="wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532" title="_deprecated_argument" alt="" coords="720,259,875,285"/><area shape="rect" id="node4" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="976,56,1055,83"/><area shape="rect" id="node7" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="328,910,461,951"/><area shape="rect" id="node13" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="1185,1424,1316,1451"/><area shape="rect" id="node15" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1418,1348,1523,1375"/><area shape="rect" id="node19" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="340,765,449,792"/><area shape="rect" id="node39" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="974,1424,1057,1451"/><area shape="rect" id="node40" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="1198,1525,1303,1552"/><area shape="rect" id="node44" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="337,157,453,184"/><area shape="rect" id="node6" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="1205,816,1296,843"/><area shape="rect" id="node5" href="wp-includes_2plugin_8php.html#af891e88ab346a2da31111facfcf6b2cf" title="_wp_call_all_hook" alt="" coords="1187,5,1314,32"/><area shape="rect" id="node8" href="wp-includes_2functions_8php.html#a06d38a93c806c187fd21200c1baa9f53" title="wp_die" alt="" coords="766,1069,829,1096"/><area shape="rect" id="node9" href="formatting_8php.html#a77a1b666b7ca0e393239a9e1d1af72d3" title="esc_html" alt="" coords="553,917,628,944"/><area shape="rect" id="node10" href="formatting_8php.html#a745879b47424ac7b0d3b95a1edec8361" title="wp_check_invalid_utf8" alt="" coords="722,968,873,995"/><area shape="rect" id="node12" href="formatting_8php.html#ab9121c7a11ad101936875a65b233e126" title="_wp_specialchars" alt="" coords="735,867,860,893"/><area shape="rect" id="node11" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="974,1019,1057,1045"/><area shape="rect" id="node17" href="formatting_8php.html#a4389f130de336d59e890c79b10a60beb" title="wp_specialchars_decode" alt="" coords="932,867,1099,893"/><area shape="rect" id="node18" href="kses_8php.html#abc0e5ed7e9bad89cc998a35b48653fdb" title="wp_kses_normalize_entities" alt="" coords="923,563,1108,589"/><area shape="rect" id="node14" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="1427,1576,1515,1603"/><area shape="rect" id="node16" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1417,1449,1525,1476"/><area shape="rect" id="node20" href="formatting_8php.html#a1a391a56d1c6c0e52239a553a0dbfb73" title="sanitize_email" alt="" coords="745,411,850,437"/><area shape="rect" id="node21" href="formatting_8php.html#aa394269ea323c88435820bb0a0f5912f" title="is_email" alt="" coords="555,309,626,336"/><area shape="rect" id="node22" href="wp-admin_2includes_2template_8php.html#ac54155d98db655b34d0c2c87d1e53c64" title="add_settings_error" alt="" coords="526,765,655,792"/><area shape="rect" id="node23" href="kses_8php.html#aa0817828c22f5e89ff755ae1ad1de60c" title="wp_kses_post" alt="" coords="538,664,643,691"/><area shape="rect" id="node30" href="kses_8php.html#a050aa6ac503f4f1a2eb655efe9b42dc6" title="wp_kses_data" alt="" coords="538,816,643,843"/><area shape="rect" id="node32" href="formatting_8php.html#ad9e809b6901d247527672e11ce5d7368" title="esc_url_raw" alt="" coords="545,537,636,564"/><area shape="rect" id="node38" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332" title="get_available_languages" alt="" coords="509,867,672,893"/><area shape="rect" id="node24" href="kses_8php.html#a16c90f8f4b5152db3c88044526e28f59" title="wp_kses" alt="" coords="761,664,834,691"/><area shape="rect" id="node25" href="wp-includes_2functions_8php.html#a410d6d8e60b99a2fbc62fe8116978711" title="wp_allowed_protocols" alt="" coords="941,512,1089,539"/><area shape="rect" id="node26" href="kses_8php.html#a6a32ba00333b67cff42a76ec3762e5c3" title="wp_kses_no_null" alt="" coords="1596,107,1717,133"/><area shape="rect" id="node27" href="kses_8php.html#a3dec56a527f620ff81fa9dc188238b4f" title="wp_kses_js_entities" alt="" coords="946,715,1085,741"/><area shape="rect" id="node28" href="kses_8php.html#a387ea2ab906936be7f094a0152f7886a" title="wp_kses_hook" alt="" coords="961,664,1069,691"/><area shape="rect" id="node29" href="kses_8php.html#a1157570413297149e62e627d8e10c6b9" title="wp_kses_split" alt="" coords="963,765,1067,792"/><area shape="rect" id="node31" href="wp-includes_2plugin_8php.html#ae088c31761ae2cdcff6491755b1bdab6" title="current_filter" alt="" coords="751,816,844,843"/><area shape="rect" id="node33" href="formatting_8php.html#a42f495a436026ff2811d0d80caca937d" title="esc_url" alt="" coords="765,487,829,513"/><area shape="rect" id="node34" href="formatting_8php.html#a07cee162d2dea8a7e788f6542534490a" title="_deep_replace" alt="" coords="962,411,1069,437"/><area shape="rect" id="node35" href="kses_8php.html#a6164e160cf41fb1682f086b13ce434a0" title="wp_kses_bad_protocol" alt="" coords="938,107,1093,133"/><area shape="rect" id="node36" href="kses_8php.html#ac1591c243a4c8272a934db51a9b53259" title="wp_kses_bad_protocol_once" alt="" coords="1156,56,1345,83"/><area shape="rect" id="node37" href="kses_8php.html#a6a97826fbe8f92352f4acc5143cdb0f7" title="wp_kses_bad_protocol\l_once2" alt="" coords="1393,41,1548,82"/><area shape="rect" id="node41" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="1195,1627,1307,1653"/><area shape="rect" id="node42" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="1185,1120,1316,1147"/><area shape="rect" id="node43" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="1423,664,1518,691"/><area shape="rect" id="node47" href="formatting_8php.html#a05e464b55ec2c8b334abed9864d014e9" title="remove_accents" alt="" coords="337,1272,453,1299"/><area shape="rect" id="node48" href="formatting_8php.html#a618ba7bdc2cf2790af2e9fa968f03615" title="seems_utf8" alt="" coords="546,1272,635,1299"/><area shape="rect" id="node49" href="l10n_8php.html#a6ec9fd4baced85768ba16386e9e1b339" title="get_locale" alt="" coords="550,1221,631,1248"/><area shape="rect" id="node50" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa" title="get_site_option" alt="" coords="742,1323,853,1349"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_afe18c72dcd93806bfefc8bde68fccd8a_icgraph.png" border="0" usemap="#includes_2upgrade_8php_afe18c72dcd93806bfefc8bde68fccd8a_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_afe18c72dcd93806bfefc8bde68fccd8a_icgraph" id="includes_2upgrade_8php_afe18c72dcd93806bfefc8bde68fccd8a_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa1681e2b2e9fc1c0ebaa20a05c278067"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_130 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 1.5.</p>
<dl class="section since"><dt>Since</dt><dd>1.5.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00549">549</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="wp-comments-post_8php_source.html#l00086">$comment_author</a>, <a class="el" href="wp-comments-post_8php_source.html#l00089">$comment_content</a>, <a class="el" href="comments-popup_8php_source.html#l00045">$comments</a>, <a class="el" href="link-add_8php_source.html#l00026">$link</a>, <a class="el" href="wp-admin_2index_8php_source.html#l00114">$option</a>, <a class="el" href="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php_source.html#l00015">$options</a>, <a class="el" href="edit-form-advanced_8php_source.html#l00433">$post</a>, <a class="el" href="wp-admin_2revision_8php_source.html#l00066">$post_title</a>, <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01413">__get_option()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01443">deslash()</a>, <a class="el" href="link-template_8php_source.html#l00080">get_permalink()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01848">make_site_theme()</a>, and <a class="el" href="option_8php_source.html#l00214">update_option()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                       {</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">// Remove extraneous backslashes.</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    $posts = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, post_title, post_content, post_excerpt, guid, post_date, post_name, post_status, post_author FROM $wpdb-&gt;posts&quot;</span>);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">if</span> ($posts) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="keywordflow">foreach</span>($posts as <a class="code" href="edit-form-advanced_8php.html#ae52c52c4dfa2970c393095396ff934fd">$post</a>) {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            $post_content = addslashes(<a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($post-&gt;post_content));</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <a class="code" href="wp-admin_2revision_8php.html#a2c341533faf2b8a0da38fab3ea68b253">$post_title</a> = addslashes(<a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($post-&gt;post_title));</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            $post_excerpt = addslashes(<a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($post-&gt;post_excerpt));</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="keywordflow">if</span> ( empty($post-&gt;guid) )</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                $guid = <a class="code" href="link-template_8php.html#a79b798d609e7c891cee471adea3a2376">get_permalink</a>($post-&gt;ID);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                $guid = $post-&gt;guid;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;posts, compact(<span class="stringliteral">&#39;post_title&#39;</span>, <span class="stringliteral">&#39;post_content&#39;</span>, <span class="stringliteral">&#39;post_excerpt&#39;</span>, <span class="stringliteral">&#39;guid&#39;</span>), array(<span class="stringliteral">&#39;ID&#39;</span> =&gt; $post-&gt;ID) );</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        }</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="comment">// Remove extraneous backslashes.</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <a class="code" href="comments-popup_8php.html#a35e8cdeb473a5eb016fea893d14de951">$comments</a> = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT comment_ID, comment_author, comment_content FROM $wpdb-&gt;comments&quot;</span>);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="comments-popup_8php.html#a35e8cdeb473a5eb016fea893d14de951">$comments</a>) {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">foreach</span>(<a class="code" href="comments-popup_8php.html#a35e8cdeb473a5eb016fea893d14de951">$comments</a> as $comment) {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            <a class="code" href="wp-comments-post_8php.html#a578d4b959043c664d3ff1a4e1a112280">$comment_content</a> = <a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($comment-&gt;comment_content);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            <a class="code" href="wp-comments-post_8php.html#a7f9391816b91dae731d7345543a1c816">$comment_author</a> = <a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($comment-&gt;comment_author);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            $wpdb-&gt;update($wpdb-&gt;comments, compact(<span class="stringliteral">&#39;comment_content&#39;</span>, <span class="stringliteral">&#39;comment_author&#39;</span>), array(<span class="stringliteral">&#39;comment_ID&#39;</span> =&gt; $comment-&gt;comment_ID) );</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="comment">// Remove extraneous backslashes.</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    $links = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT link_id, link_name, link_description FROM $wpdb-&gt;links&quot;</span>);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">if</span> ($links) {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="keywordflow">foreach</span>($links as <a class="code" href="link-add_8php.html#a5d346e31b75d916e3bac9cb193bfc97f">$link</a>) {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            $link_name = <a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($link-&gt;link_name);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            $link_description = <a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($link-&gt;link_description);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;links, compact(<span class="stringliteral">&#39;link_name&#39;</span>, <span class="stringliteral">&#39;link_description&#39;</span>), array(<span class="stringliteral">&#39;link_id&#39;</span> =&gt; $link-&gt;link_id) );</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    }</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    $active_plugins = <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;active_plugins&#39;</span>);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="comment">// If plugins are not stored in an array, they&#39;re stored in the old</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="comment">// newline separated format. Convert to new format.</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordflow">if</span> ( !is_array( $active_plugins ) ) {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        $active_plugins = explode(<span class="stringliteral">&quot;\n&quot;</span>, trim($active_plugins));</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <a class="code" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a>(<span class="stringliteral">&#39;active_plugins&#39;</span>, $active_plugins);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="comment">// Obsolete tables</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;optionvalues&#39;</span>);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;optiontypes&#39;</span>);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;optiongroups&#39;</span>);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;optiongroup_options&#39;</span>);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">// Update comments table to use comment_type</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;comments SET comment_type=&#39;trackback&#39;, comment_content = REPLACE(comment_content, &#39;&lt;trackback /&gt;&#39;, &#39;&#39;) WHERE comment_content LIKE &#39;&lt;trackback /&gt;%&#39;&quot;</span>);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;comments SET comment_type=&#39;pingback&#39;, comment_content = REPLACE(comment_content, &#39;&lt;pingback /&gt;&#39;, &#39;&#39;) WHERE comment_content LIKE &#39;&lt;pingback /&gt;%&#39;&quot;</span>);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="comment">// Some versions have multiple duplicate option_name rows with the same values</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <a class="code" href="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php.html#ad485bdc644c889fcb77db6edc8323836">$options</a> = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT option_name, COUNT(option_name) AS dupes FROM `$wpdb-&gt;options` GROUP BY option_name&quot;</span>);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordflow">foreach</span> ( <a class="code" href="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php.html#ad485bdc644c889fcb77db6edc8323836">$options</a> as <a class="code" href="wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> ) {</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">if</span> ( 1 != $option-&gt;dupes ) { <span class="comment">// Could this be done in the query?</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            $limit = $option-&gt;dupes - 1;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            $dupe_ids = $wpdb-&gt;get_col( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT option_id FROM $wpdb-&gt;options WHERE option_name = %s LIMIT %d&quot;</span>, $option-&gt;option_name, $limit) );</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <span class="keywordflow">if</span> ( $dupe_ids ) {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                $dupe_ids = join($dupe_ids, <span class="charliteral">&#39;,&#39;</span>);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                $wpdb-&gt;query(<span class="stringliteral">&quot;DELETE FROM $wpdb-&gt;options WHERE option_id IN ($dupe_ids)&quot;</span>);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        }</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aabe08bc33812c096cbe094c1fa7c95ef">make_site_theme</a>();</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;}</div>
<div class="ttc" id="link-add_8php_html_a5d346e31b75d916e3bac9cb193bfc97f"><div class="ttname"><a href="link-add_8php.html#a5d346e31b75d916e3bac9cb193bfc97f">$link</a></div><div class="ttdeci">$link</div><div class="ttdef"><b>Definition:</b> <a href="link-add_8php_source.html#l00026">link-add.php:26</a></div></div>
<div class="ttc" id="option_8php_html_a7c47bc5d444687bebd583e6b5dfc04bc"><div class="ttname"><a href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a></div><div class="ttdeci">update_option($option, $newvalue)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00214">option.php:214</a></div></div>
<div class="ttc" id="link-template_8php_html_a79b798d609e7c891cee471adea3a2376"><div class="ttname"><a href="link-template_8php.html#a79b798d609e7c891cee471adea3a2376">get_permalink</a></div><div class="ttdeci">get_permalink($id=0, $leavename=false)</div><div class="ttdef"><b>Definition:</b> <a href="link-template_8php_source.html#l00080">link-template.php:80</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_afd6d5e27da310b6ded125a7ab130e336"><div class="ttname"><a href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a></div><div class="ttdeci">deslash($content)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01443">upgrade.php:1443</a></div></div>
<div class="ttc" id="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php_html_ad485bdc644c889fcb77db6edc8323836"><div class="ttname"><a href="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php.html#ad485bdc644c889fcb77db6edc8323836">$options</a></div><div class="ttdeci">if(!file_exists($kmyacc)) $options</div><div class="ttdef"><b>Definition:</b> <a href="_p_h_p-_parser-1_80_81_2grammar_2rebuild_parser_8php_source.html#l00015">rebuildParser.php:15</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a913d174175f69bd5da3dba3288acc2b1"><div class="ttname"><a href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a></div><div class="ttdeci">__get_option($setting)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01413">upgrade.php:1413</a></div></div>
<div class="ttc" id="wp-admin_2revision_8php_html_a2c341533faf2b8a0da38fab3ea68b253"><div class="ttname"><a href="wp-admin_2revision_8php.html#a2c341533faf2b8a0da38fab3ea68b253">$post_title</a></div><div class="ttdeci">if(!wp_revisions_enabled($post)&amp;&amp;!wp_is_post_autosave($revision)) $post_title</div><div class="ttdef"><b>Definition:</b> <a href="wp-admin_2revision_8php_source.html#l00066">revision.php:66</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_aabe08bc33812c096cbe094c1fa7c95ef"><div class="ttname"><a href="includes_2upgrade_8php.html#aabe08bc33812c096cbe094c1fa7c95ef">make_site_theme</a></div><div class="ttdeci">make_site_theme()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01848">upgrade.php:1848</a></div></div>
<div class="ttc" id="comments-popup_8php_html_a35e8cdeb473a5eb016fea893d14de951"><div class="ttname"><a href="comments-popup_8php.html#a35e8cdeb473a5eb016fea893d14de951">$comments</a></div><div class="ttdeci">$comments</div><div class="ttdef"><b>Definition:</b> <a href="comments-popup_8php_source.html#l00045">comments-popup.php:45</a></div></div>
<div class="ttc" id="wp-admin_2index_8php_html_a3691fb4ac25261a9b1efa1fd6d58923b"><div class="ttname"><a href="wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a></div><div class="ttdeci">if(has_action( 'welcome_panel')&amp;&amp;current_user_can( 'edit_theme_options')) $option</div><div class="ttdef"><b>Definition:</b> <a href="wp-admin_2index_8php_source.html#l00114">index.php:114</a></div></div>
<div class="ttc" id="edit-form-advanced_8php_html_ae52c52c4dfa2970c393095396ff934fd"><div class="ttname"><a href="edit-form-advanced_8php.html#ae52c52c4dfa2970c393095396ff934fd">$post</a></div><div class="ttdeci">if( 'page'==$post_type) do_action('submitpage_box' $post</div><div class="ttdef"><b>Definition:</b> <a href="edit-form-advanced_8php_source.html#l00433">edit-form-advanced.php:433</a></div></div>
<div class="ttc" id="wp-comments-post_8php_html_a7f9391816b91dae731d7345543a1c816"><div class="ttname"><a href="wp-comments-post_8php.html#a7f9391816b91dae731d7345543a1c816">$comment_author</a></div><div class="ttdeci">$comment_author</div><div class="ttdef"><b>Definition:</b> <a href="wp-comments-post_8php_source.html#l00086">wp-comments-post.php:86</a></div></div>
<div class="ttc" id="wp-comments-post_8php_html_a578d4b959043c664d3ff1a4e1a112280"><div class="ttname"><a href="wp-comments-post_8php.html#a578d4b959043c664d3ff1a4e1a112280">$comment_content</a></div><div class="ttdeci">$comment_content</div><div class="ttdef"><b>Definition:</b> <a href="wp-comments-post_8php_source.html#l00089">wp-comments-post.php:89</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_aa1681e2b2e9fc1c0ebaa20a05c278067_cgraph.png" border="0" usemap="#includes_2upgrade_8php_aa1681e2b2e9fc1c0ebaa20a05c278067_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_aa1681e2b2e9fc1c0ebaa20a05c278067_cgraph" id="includes_2upgrade_8php_aa1681e2b2e9fc1c0ebaa20a05c278067_cgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1" title="__get_option" alt="" coords="547,616,643,643"/><area shape="rect" id="node6" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336" title="deslash" alt="" coords="179,1376,245,1403"/><area shape="rect" id="node7" href="link-template_8php.html#a79b798d609e7c891cee471adea3a2376" title="get_permalink" alt="" coords="161,1325,263,1352"/><area shape="rect" id="node38" href="includes_2upgrade_8php.html#aabe08bc33812c096cbe094c1fa7c95ef" title="make_site_theme" alt="" coords="149,553,275,580"/><area shape="rect" id="node42" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc" title="update_option" alt="" coords="350,372,453,399"/><area shape="rect" id="node3" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="905,515,1036,541"/><area shape="rect" id="node5" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="1106,768,1218,795"/><area shape="rect" id="node4" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="1115,515,1209,541"/><area shape="rect" id="node8" href="wp-includes_2post_8php.html#a39e30b5bbefa3b21d828591673150b89" title="get_post" alt="" coords="935,1427,1007,1453"/><area shape="rect" id="node13" href="link-template_8php.html#ad33245f1affb9dbc398c9b8dca65c548" title="get_page_link" alt="" coords="350,1325,453,1352"/><area shape="rect" id="node14" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="929,768,1012,795"/><area shape="rect" id="node15" href="link-template_8php.html#a85adfe3cfd69ffdcb17d9960fe9ed830" title="home_url" alt="" coords="747,1224,821,1251"/><area shape="rect" id="node18" href="link-template_8php.html#a359dce6823e3066591e8381e82dbade1" title="user_trailingslashit" alt="" coords="719,920,849,947"/><area shape="rect" id="node20" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="925,1072,1016,1099"/><area shape="rect" id="node21" href="link-template_8php.html#a5338c142d6cf827c81bbc8a12d73224c" title="get_attachment_link" alt="" coords="332,1021,471,1048"/><area shape="rect" id="node22" href="wp-includes_2post_8php.html#a608a82c55bc57d0bc9b34888b92212e1" title="get_post_types" alt="" coords="346,1579,457,1605"/><area shape="rect" id="node24" href="link-template_8php.html#aeae742ade68e00c24a410e51322c15fa" title="get_post_permalink" alt="" coords="528,1477,663,1504"/><area shape="rect" id="node25" href="class-wp-error_8php.html#a741b5ec807dbba8d2a0851e32e7d926c" title="is_wp_error" alt="" coords="740,1781,828,1808"/><area shape="rect" id="node28" href="category-template_8php.html#addab29993a41d62a9c9075cfb7ddead8" title="get_the_category" alt="" coords="534,1883,657,1909"/><area shape="rect" id="node31" href="wp-includes_2taxonomy_8php.html#a7236b1f5cd8e83a6210bddafb917835b" title="get_term" alt="" coords="747,1984,821,2011"/><area shape="rect" id="node34" href="category-template_8php.html#a6816e4ede697940c0d7a6ec888dfbf31" title="get_category_parents" alt="" coords="328,1680,475,1707"/><area shape="rect" id="node35" href="wp-includes_2category_8php.html#a2e3d14730f188424e484749176da797f" title="get_category" alt="" coords="547,1832,644,1859"/><area shape="rect" id="node9" href="class_w_p___post.html#aaa48c3381efbd06826faee0b4cd5ba36" title="WP_Post\\get_instance" alt="" coords="1084,1503,1240,1529"/><area shape="rect" id="node11" href="wp-includes_2post_8php.html#a8eebee8e7e751c84f75b5d4da365438c" title="sanitize_post" alt="" coords="1293,1604,1391,1631"/><area shape="rect" id="node10" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1289,413,1395,440"/><area shape="rect" id="node12" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1288,1503,1396,1529"/><area shape="rect" id="node16" href="link-template_8php.html#aa976f76e91216ba956542ed5b0378d53" title="_get_page_link" alt="" coords="541,1123,650,1149"/><area shape="rect" id="node17" href="wp-includes_2post_8php.html#a5a08a7d7373f55d63e62af46ee6c77d6" title="get_page_uri" alt="" coords="736,1376,832,1403"/><area shape="rect" id="node19" href="formatting_8php.html#a996c0584f3d97040938ef0073352c114" title="trailingslashit" alt="" coords="921,869,1020,896"/><area shape="rect" id="node23" href="wp-includes_2functions_8php.html#ab34fe39d060b41a5eba441a38bc15d60" title="wp_filter_object_list" alt="" coords="528,1579,663,1605"/><area shape="rect" id="node26" href="wp-includes_2post_8php.html#a61c47864d25a054d86d7977ed6bc6bed" title="get_post_type_object" alt="" coords="711,1579,857,1605"/><area shape="rect" id="node27" href="wp-includes_2functions_8php.html#a6e348722923afe18808c59773964c162" title="add_query_arg" alt="" coords="731,1528,837,1555"/><area shape="rect" id="node29" href="category-template_8php.html#a9cb78def90d47a90bab3cc2d64abde80" title="get_the_terms" alt="" coords="731,1933,837,1960"/><area shape="rect" id="node30" href="wp-includes_2category_8php.html#afec81cc47ed27857af71edfe82ed5856" title="_make_cat_compat" alt="" coords="716,1832,852,1859"/><area shape="rect" id="node32" href="wp-includes_2taxonomy_8php.html#a16a01a06b9e3eca5ddef6cc18333b4d6" title="sanitize_term" alt="" coords="921,2009,1021,2036"/><area shape="rect" id="node33" href="wp-includes_2taxonomy_8php.html#a5f7e3a6dba12bb44cbe203aefce3ef8d" title="taxonomy_exists" alt="" coords="910,1959,1031,1985"/><area shape="rect" id="node36" href="formatting_8php.html#a42f495a436026ff2811d0d80caca937d" title="esc_url" alt="" coords="563,1629,627,1656"/><area shape="rect" id="node37" href="category-template_8php.html#a02c9bb9e5bfb58efddd35da38f696461" title="get_category_link" alt="" coords="533,1731,657,1757"/><area shape="rect" id="node39" href="includes_2upgrade_8php.html#a0771fe384061bbaf9ab5c6ff7bff1f93" title="make_site_theme_from\l_default" alt="" coords="323,605,480,646"/><area shape="rect" id="node40" href="includes_2upgrade_8php.html#a278f8eaf153a74f3348fe92d16e044d2" title="make_site_theme_from\l_oldschool" alt="" coords="323,487,480,529"/><area shape="rect" id="node41" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808" title="sanitize_title" alt="" coords="354,671,449,697"/><area shape="rect" id="node43" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="717,145,851,186"/><area shape="rect" id="node44" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="729,515,839,541"/><area shape="rect" id="node45" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="743,464,825,491"/><area shape="rect" id="node46" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="905,363,1036,389"/><area shape="rect" id="node47" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="918,211,1023,237"/><area shape="rect" id="node48" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="553,312,638,339"/><area shape="rect" id="node49" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="726,363,842,389"/><area shape="rect" id="node50" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="745,93,823,120"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_aa1681e2b2e9fc1c0ebaa20a05c278067_icgraph.png" border="0" usemap="#includes_2upgrade_8php_aa1681e2b2e9fc1c0ebaa20a05c278067_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_aa1681e2b2e9fc1c0ebaa20a05c278067_icgraph" id="includes_2upgrade_8php_aa1681e2b2e9fc1c0ebaa20a05c278067_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3fb25174b5e402c9666da33248094bfe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_160 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 2.0.</p>
<dl class="section since"><dt>Since</dt><dd>2.0.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00631">631</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="comments-popup_8php_source.html#l00045">$comments</a>, <a class="el" href="async-upload_8php_source.html#l00082">$id</a>, <a class="el" href="wp-comments-post_8php_source.html#l00092">$user</a>, <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="export_8php_source.html#l00173">endforeach</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00021">endif</a>, <a class="el" href="wp-includes_2post_8php_source.html#l01763">get_post_meta()</a>, <a class="el" href="wp-includes_2user_8php_source.html#l00843">get_user_meta()</a>, <a class="el" href="schema_8php_source.html#l00572">populate_roles_160()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01897">translate_level_to_role()</a>, <a class="el" href="wp-includes_2post_8php_source.html#l00209">update_attached_file()</a>, <a class="el" href="wp-includes_2user_8php_source.html#l00865">update_user_meta()</a>, and <a class="el" href="formatting_8php_source.html#l03381">wp_slash()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                       {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>, $wp_current_db_version;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <a class="code" href="schema_8php.html#a27dc108eca74bf18d869661ef858f798">populate_roles_160</a>();</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    $users = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT * FROM $wpdb-&gt;users&quot;</span>);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">foreach</span> ( $users as <a class="code" href="wp-comments-post_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a> ) :</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_firstname ) )</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;first_name&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_firstname) );</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_lastname ) )</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;last_name&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_lastname) );</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_nickname ) )</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;nickname&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_nickname) );</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_level ) )</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, $wpdb-&gt;prefix . <span class="stringliteral">&#39;user_level&#39;</span>, $user-&gt;user_level );</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_icq ) )</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;icq&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_icq) );</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_aim ) )</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;aim&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_aim) );</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_msn ) )</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;msn&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_msn) );</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_yim ) )</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;yim&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_icq) );</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_description ) )</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;description&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_description) );</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">if</span> ( isset( $user-&gt;user_idmode ) ):</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            $idmode = $user-&gt;user_idmode;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            <span class="keywordflow">if</span> ($idmode == <span class="stringliteral">&#39;nickname&#39;</span>) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_nickname;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            <span class="keywordflow">if</span> ($idmode == <span class="stringliteral">&#39;login&#39;</span>) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_login;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            <span class="keywordflow">if</span> ($idmode == <span class="stringliteral">&#39;firstname&#39;</span>) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_firstname;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <span class="keywordflow">if</span> ($idmode == <span class="stringliteral">&#39;lastname&#39;</span>) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_lastname;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            <span class="keywordflow">if</span> ($idmode == <span class="stringliteral">&#39;namefl&#39;</span>) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_firstname.<span class="charliteral">&#39; &#39;</span>.$user-&gt;user_lastname;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            <span class="keywordflow">if</span> ($idmode == <span class="stringliteral">&#39;namelf&#39;</span>) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_lastname.<span class="charliteral">&#39; &#39;</span>.$user-&gt;user_firstname;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            <span class="keywordflow">if</span> (!$idmode) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_nickname;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;users, array(<span class="stringliteral">&#39;display_name&#39;</span> =&gt; <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a>), array(<span class="stringliteral">&#39;ID&#39;</span> =&gt; $user-&gt;ID) );</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a>;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="comment">// FIXME: RESET_CAPS is temporary code to reset roles and caps if flag is set.</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        $caps = <a class="code" href="wp-includes_2user_8php.html#aa867ddb4cac7504b879d2706b939fe5a">get_user_meta</a>( $user-&gt;ID, $wpdb-&gt;prefix . <span class="stringliteral">&#39;capabilities&#39;</span>);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">if</span> ( empty($caps) || defined(<span class="stringliteral">&#39;RESET_CAPS&#39;</span>) ) {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            $level = <a class="code" href="wp-includes_2user_8php.html#aa867ddb4cac7504b879d2706b939fe5a">get_user_meta</a>($user-&gt;ID, $wpdb-&gt;prefix . <span class="stringliteral">&#39;user_level&#39;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            $role = <a class="code" href="includes_2upgrade_8php.html#a80fbc8c3883ba92927aebc7a131d2cc3">translate_level_to_role</a>($level);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, $wpdb-&gt;prefix . <span class="stringliteral">&#39;capabilities&#39;</span>, array($role =&gt; <span class="keyword">true</span>) );</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <a class="code" href="export_8php.html#a672d9707ef91db026c210f98cc601123">endforeach</a>;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    $old_user_fields = array( <span class="stringliteral">&#39;user_firstname&#39;</span>, <span class="stringliteral">&#39;user_lastname&#39;</span>, <span class="stringliteral">&#39;user_icq&#39;</span>, <span class="stringliteral">&#39;user_aim&#39;</span>, <span class="stringliteral">&#39;user_msn&#39;</span>, <span class="stringliteral">&#39;user_yim&#39;</span>, <span class="stringliteral">&#39;user_idmode&#39;</span>, <span class="stringliteral">&#39;user_ip&#39;</span>, <span class="stringliteral">&#39;user_domain&#39;</span>, <span class="stringliteral">&#39;user_browser&#39;</span>, <span class="stringliteral">&#39;user_description&#39;</span>, <span class="stringliteral">&#39;user_nickname&#39;</span>, <span class="stringliteral">&#39;user_level&#39;</span> );</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    $wpdb-&gt;hide_errors();</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">foreach</span> ( $old_user_fields as $old )</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;users DROP $old&quot;</span>);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    $wpdb-&gt;show_errors();</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="comment">// populate comment_count field of posts table</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <a class="code" href="comments-popup_8php.html#a35e8cdeb473a5eb016fea893d14de951">$comments</a> = $wpdb-&gt;get_results( <span class="stringliteral">&quot;SELECT comment_post_ID, COUNT(*) as c FROM $wpdb-&gt;comments WHERE comment_approved = &#39;1&#39; GROUP BY comment_post_ID&quot;</span> );</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keywordflow">if</span> ( is_array( <a class="code" href="comments-popup_8php.html#a35e8cdeb473a5eb016fea893d14de951">$comments</a> ) )</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="keywordflow">foreach</span> (<a class="code" href="comments-popup_8php.html#a35e8cdeb473a5eb016fea893d14de951">$comments</a> as $comment)</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;posts, array(<span class="stringliteral">&#39;comment_count&#39;</span> =&gt; $comment-&gt;c), array(<span class="stringliteral">&#39;ID&#39;</span> =&gt; $comment-&gt;comment_post_ID) );</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="comment">// Some alpha versions used a post status of object instead of attachment and put</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="comment">// the mime type in post_type instead of post_mime_type.</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &gt; 2541 &amp;&amp; $wp_current_db_version &lt;= 3091 ) {</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        $objects = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, post_type FROM $wpdb-&gt;posts WHERE post_status = &#39;object&#39;&quot;</span>);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <span class="keywordflow">foreach</span> ($objects as $object) {</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;posts, array( <span class="stringliteral">&#39;post_status&#39;</span> =&gt; <span class="stringliteral">&#39;attachment&#39;</span>,</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                                                <span class="stringliteral">&#39;post_mime_type&#39;</span> =&gt; $object-&gt;post_type,</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                                                <span class="stringliteral">&#39;post_type&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>),</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                                         array( <span class="stringliteral">&#39;ID&#39;</span> =&gt; $object-&gt;ID ) );</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            $meta = <a class="code" href="wp-includes_2post_8php.html#a5ac8d9eefeeb2ac8b45650a335971b81">get_post_meta</a>($object-&gt;ID, <span class="stringliteral">&#39;imagedata&#39;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            <span class="keywordflow">if</span> ( ! empty($meta[<span class="stringliteral">&#39;file&#39;</span>]) )</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                <a class="code" href="wp-includes_2post_8php.html#a1a4ddf27527646308447391e3ac4dce3">update_attached_file</a>( $object-&gt;ID, $meta[<span class="stringliteral">&#39;file&#39;</span>] );</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;}</div>
<div class="ttc" id="schema_8php_html_a27dc108eca74bf18d869661ef858f798"><div class="ttname"><a href="schema_8php.html#a27dc108eca74bf18d869661ef858f798">populate_roles_160</a></div><div class="ttdeci">populate_roles_160()</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00572">schema.php:572</a></div></div>
<div class="ttc" id="wp-comments-post_8php_html_a598ca4e71b15a1313ec95f0df1027ca5"><div class="ttname"><a href="wp-comments-post_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a></div><div class="ttdeci">$user</div><div class="ttdef"><b>Definition:</b> <a href="wp-comments-post_8php_source.html#l00092">wp-comments-post.php:92</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a80fbc8c3883ba92927aebc7a131d2cc3"><div class="ttname"><a href="includes_2upgrade_8php.html#a80fbc8c3883ba92927aebc7a131d2cc3">translate_level_to_role</a></div><div class="ttdeci">translate_level_to_role($level)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01897">upgrade.php:1897</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a1a4ddf27527646308447391e3ac4dce3"><div class="ttname"><a href="wp-includes_2post_8php.html#a1a4ddf27527646308447391e3ac4dce3">update_attached_file</a></div><div class="ttdeci">update_attached_file($attachment_id, $file)</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l00209">post.php:209</a></div></div>
<div class="ttc" id="formatting_8php_html_aa5eab0fce35c72689998f801b8fc7dfe"><div class="ttname"><a href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a></div><div class="ttdeci">wp_slash($value)</div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l03381">formatting.php:3381</a></div></div>
<div class="ttc" id="async-upload_8php_html_ad69de186eb69f332f105ae157136192e"><div class="ttname"><a href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a></div><div class="ttdeci">if(isset($_REQUEST['post_id'])) $id</div><div class="ttdef"><b>Definition:</b> <a href="async-upload_8php_source.html#l00082">async-upload.php:82</a></div></div>
<div class="ttc" id="wp-includes_2user_8php_html_aa867ddb4cac7504b879d2706b939fe5a"><div class="ttname"><a href="wp-includes_2user_8php.html#aa867ddb4cac7504b879d2706b939fe5a">get_user_meta</a></div><div class="ttdeci">get_user_meta($user_id, $key= '', $single=false)</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2user_8php_source.html#l00843">user.php:843</a></div></div>
<div class="ttc" id="wp-includes_2user_8php_html_a414887490e946c7f6459d886b09e0e5a"><div class="ttname"><a href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a></div><div class="ttdeci">update_user_meta($user_id, $meta_key, $meta_value, $prev_value= '')</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2user_8php_source.html#l00865">user.php:865</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a5ac8d9eefeeb2ac8b45650a335971b81"><div class="ttname"><a href="wp-includes_2post_8php.html#a5ac8d9eefeeb2ac8b45650a335971b81">get_post_meta</a></div><div class="ttdeci">get_post_meta($post_id, $key= '', $single=false)</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l01763">post.php:1763</a></div></div>
<div class="ttc" id="comments-popup_8php_html_a35e8cdeb473a5eb016fea893d14de951"><div class="ttname"><a href="comments-popup_8php.html#a35e8cdeb473a5eb016fea893d14de951">$comments</a></div><div class="ttdeci">$comments</div><div class="ttdef"><b>Definition:</b> <a href="comments-popup_8php_source.html#l00045">comments-popup.php:45</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_aad8d91e6a86c1c561f1ed66bc19e5a63"><div class="ttname"><a href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a></div><div class="ttdeci">if(!function_exists('wp_install'))($blog_title, $user_name, $user_email, $public, $deprecated= '', $user_password= '') endif</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00021">upgrade.php:21</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
<div class="ttc" id="export_8php_html_a672d9707ef91db026c210f98cc601123"><div class="ttname"><a href="export_8php.html#a672d9707ef91db026c210f98cc601123">endforeach</a></div><div class="ttdeci">endforeach</div><div class="ttdef"><b>Definition:</b> <a href="export_8php_source.html#l00173">export.php:173</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a3fb25174b5e402c9666da33248094bfe_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a3fb25174b5e402c9666da33248094bfe_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a3fb25174b5e402c9666da33248094bfe_cgraph" id="includes_2upgrade_8php_a3fb25174b5e402c9666da33248094bfe_cgraph">
<area shape="rect" id="node2" href="wp-includes_2post_8php.html#a5ac8d9eefeeb2ac8b45650a335971b81" title="get_post_meta" alt="" coords="540,1209,648,1236"/><area shape="rect" id="node12" href="wp-includes_2user_8php.html#aa867ddb4cac7504b879d2706b939fe5a" title="get_user_meta" alt="" coords="540,1032,648,1059"/><area shape="rect" id="node13" href="schema_8php.html#a27dc108eca74bf18d869661ef858f798" title="populate_roles_160" alt="" coords="157,56,292,83"/><area shape="rect" id="node16" href="includes_2upgrade_8php.html#a80fbc8c3883ba92927aebc7a131d2cc3" title="translate_level_to_role" alt="" coords="149,1133,300,1160"/><area shape="rect" id="node17" href="wp-includes_2post_8php.html#a1a4ddf27527646308447391e3ac4dce3" title="update_attached_file" alt="" coords="154,993,295,1020"/><area shape="rect" id="node49" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a" title="update_user_meta" alt="" coords="719,1401,848,1428"/><area shape="rect" id="node50" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe" title="wp_slash" alt="" coords="187,1540,263,1567"/><area shape="rect" id="node3" href="meta_8php.html#a8f95de67adbb57e8cbc1fe5aec4f2aa9" title="get_metadata" alt="" coords="1149,1120,1250,1147"/><area shape="rect" id="node4" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="1713,1120,1803,1147"/><area shape="rect" id="node5" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1527,867,1632,893"/><area shape="rect" id="node6" href="meta_8php.html#af4009901e9f698dec1ade79ab5f61acf" title="update_meta_cache" alt="" coords="1325,1171,1464,1197"/><area shape="rect" id="node10" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="1514,715,1645,741"/><area shape="rect" id="node7" href="meta_8php.html#a5611631808dc5835340f9c8f309743f6" title="_get_meta_table" alt="" coords="1520,1373,1639,1400"/><area shape="rect" id="node8" href="formatting_8php.html#a0ebdd3bb5f66266f5302c24c3537fb50" title="sanitize_key" alt="" coords="1532,1323,1627,1349"/><area shape="rect" id="node9" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1525,917,1633,944"/><area shape="rect" id="node11" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="1711,1323,1805,1349"/><area shape="rect" id="node14" href="capabilities_8php.html#a2f0299f55d8f0d6d30103df6ce3f3bfb" title="add_role" alt="" coords="377,5,448,32"/><area shape="rect" id="node15" href="capabilities_8php.html#a41bea05b81b5374112aab194c590dd80" title="get_role" alt="" coords="379,56,447,83"/><area shape="rect" id="node18" href="wp-includes_2post_8php.html#ae3d90994c47372fb9ebdd7c48f862d5c" title="_wp_relative_upload_path" alt="" coords="904,512,1073,539"/><area shape="rect" id="node32" href="wp-includes_2post_8php.html#a138c55d0c3508741575e1f3fad256f65" title="delete_post_meta" alt="" coords="350,1159,475,1185"/><area shape="rect" id="node41" href="wp-includes_2post_8php.html#a39e30b5bbefa3b21d828591673150b89" title="get_post" alt="" coords="953,968,1025,995"/><area shape="rect" id="node45" href="wp-includes_2post_8php.html#ac984a204e35272d1a897fedce9a92847" title="update_post_meta" alt="" coords="348,1108,477,1135"/><area shape="rect" id="node19" href="wp-includes_2functions_8php.html#a56ac642deeb8d6695877aade6e77ee62" title="wp_upload_dir" alt="" coords="1147,512,1251,539"/><area shape="rect" id="node20" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="1538,233,1621,260"/><area shape="rect" id="node21" href="wp-includes_2functions_8php.html#a8a71f9902193fd3868160d28e04027c8" title="path_join" alt="" coords="1357,613,1432,640"/><area shape="rect" id="node22" href="formatting_8php.html#a996c0584f3d97040938ef0073352c114" title="trailingslashit" alt="" coords="1345,715,1444,741"/><area shape="rect" id="node23" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="1523,765,1635,792"/><area shape="rect" id="node24" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="1535,424,1623,451"/><area shape="rect" id="node25" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa" title="get_site_option" alt="" coords="1339,512,1450,539"/><area shape="rect" id="node26" href="wp-includes_2functions_8php.html#a494c188ad4536ef708f4d684cc1a8178" title="is_main_network" alt="" coords="1335,816,1454,843"/><area shape="rect" id="node27" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a" title="is_main_site" alt="" coords="1347,360,1442,387"/><area shape="rect" id="node28" href="load_8php.html#a49b99067b44a28b2df04dcbd50569624" title="get_current_blog_id" alt="" coords="1512,348,1647,375"/><area shape="rect" id="node29" href="ms-blogs_8php.html#acdd8f8ff288ca7c7aec4e9747a4189d6" title="ms_is_switched" alt="" coords="1337,461,1452,488"/><area shape="rect" id="node30" href="wp-includes_2functions_8php.html#a4dacfef72ebe1c7276f7d94fdbe93554" title="current_time" alt="" coords="1347,259,1442,285"/><area shape="rect" id="node31" href="wp-includes_2functions_8php.html#a05bb23be69c46562a53ab2b29d5bc2d3" title="wp_mkdir_p" alt="" coords="1349,563,1440,589"/><area shape="rect" id="node33" href="meta_8php.html#ad0369e71d632895be530f5693855ec95" title="delete_metadata" alt="" coords="1335,1576,1454,1603"/><area shape="rect" id="node39" href="wp-includes_2revision_8php.html#a700214c190eec741ced5d495e4640aa9" title="wp_is_post_revision" alt="" coords="525,1159,663,1185"/><area shape="rect" id="node34" href="formatting_8php.html#a6dba609f82ebf662ef06615fac81a032" title="wp_unslash" alt="" coords="1534,1677,1625,1704"/><area shape="rect" id="node36" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="1521,1475,1637,1501"/><area shape="rect" id="node37" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="1540,1525,1619,1552"/><area shape="rect" id="node38" href="cache_8php.html#a5051b30effe4731d830d0a838121b867" title="wp_cache_delete" alt="" coords="1518,1627,1641,1653"/><area shape="rect" id="node35" href="formatting_8php.html#a3b974f63529424e457b55f009a795461" title="stripslashes_deep" alt="" coords="1695,1677,1821,1704"/><area shape="rect" id="node40" href="wp-includes_2revision_8php.html#a9ecc59d15b04a123bdb3a0f9c178ada5" title="wp_get_post_revision" alt="" coords="711,1069,856,1096"/><area shape="rect" id="node42" href="class_w_p___post.html#aaa48c3381efbd06826faee0b4cd5ba36" title="WP_Post\\get_instance" alt="" coords="1121,917,1277,944"/><area shape="rect" id="node43" href="wp-includes_2post_8php.html#a8eebee8e7e751c84f75b5d4da365438c" title="sanitize_post" alt="" coords="1345,968,1444,995"/><area shape="rect" id="node44" href="wp-includes_2post_8php.html#addfb1c1acdc2e6b318105d1ebb537ce8" title="sanitize_post_field" alt="" coords="1515,1019,1644,1045"/><area shape="rect" id="node46" href="meta_8php.html#af883920aecfe357a838107c657b933c6" title="update_metadata" alt="" coords="927,1392,1050,1419"/><area shape="rect" id="node47" href="meta_8php.html#a548487296714f6667278139ad63b4465" title="sanitize_meta" alt="" coords="1528,1272,1631,1299"/><area shape="rect" id="node48" href="meta_8php.html#ab5557d6589219e8cf8fd8eddb172172a" title="add_metadata" alt="" coords="1343,1424,1447,1451"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a3fb25174b5e402c9666da33248094bfe_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a3fb25174b5e402c9666da33248094bfe_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a3fb25174b5e402c9666da33248094bfe_icgraph" id="includes_2upgrade_8php_a3fb25174b5e402c9666da33248094bfe_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aab67ca7d2045305d3847acdc086ffae3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_210 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 2.1.</p>
<dl class="section since"><dt>Since</dt><dd>2.1.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00712">712</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="options-general_8php_source.html#l00186">$now</a>, <a class="el" href="edit-form-advanced_8php_source.html#l00433">$post</a>, <a class="el" href="wp-comments-post_8php_source.html#l00036">$status</a>, <a class="el" href="media-upload_8php_source.html#l00044">$type</a>, <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="wp-includes_2functions_8php_source.html#l00026">mysql2date()</a>, <a class="el" href="schema_8php_source.html#l00677">populate_roles_210()</a>, and <a class="el" href="cron_8php_source.html#l00022">wp_schedule_single_event()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                       {</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>, $wp_current_db_version;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 3506 ) {</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="comment">// Update status and type.</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        $posts = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, post_status FROM $wpdb-&gt;posts&quot;</span>);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">if</span> ( ! empty($posts) ) <span class="keywordflow">foreach</span> ($posts as <a class="code" href="edit-form-advanced_8php.html#ae52c52c4dfa2970c393095396ff934fd">$post</a>) {</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            <a class="code" href="wp-comments-post_8php.html#a47507f728fb0b77c9c07ae6962d738f8">$status</a> = $post-&gt;post_status;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            <a class="code" href="media-upload_8php.html#af01853db8db960be881882b7fb29792e">$type</a> = <span class="stringliteral">&#39;post&#39;</span>;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;static&#39;</span> == <a class="code" href="wp-comments-post_8php.html#a47507f728fb0b77c9c07ae6962d738f8">$status</a> ) {</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                <a class="code" href="wp-comments-post_8php.html#a47507f728fb0b77c9c07ae6962d738f8">$status</a> = <span class="stringliteral">&#39;publish&#39;</span>;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                <a class="code" href="media-upload_8php.html#af01853db8db960be881882b7fb29792e">$type</a> = <span class="stringliteral">&#39;page&#39;</span>;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;attachment&#39;</span> == <a class="code" href="wp-comments-post_8php.html#a47507f728fb0b77c9c07ae6962d738f8">$status</a> ) {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                <a class="code" href="wp-comments-post_8php.html#a47507f728fb0b77c9c07ae6962d738f8">$status</a> = <span class="stringliteral">&#39;inherit&#39;</span>;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                <a class="code" href="media-upload_8php.html#af01853db8db960be881882b7fb29792e">$type</a> = <span class="stringliteral">&#39;attachment&#39;</span>;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            }</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_status = %s, post_type = %s WHERE ID = %d&quot;</span>, <a class="code" href="wp-comments-post_8php.html#a47507f728fb0b77c9c07ae6962d738f8">$status</a>, <a class="code" href="media-upload_8php.html#af01853db8db960be881882b7fb29792e">$type</a>, $post-&gt;ID) );</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        }</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    }</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 3845 ) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <a class="code" href="schema_8php.html#ad2ea188fe277219078755911b899cf78">populate_roles_210</a>();</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 3531 ) {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="comment">// Give future posts a post_status of future.</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <a class="code" href="options-general_8php.html#af1d5ccdee975b8f4d20aaffc5b28557c">$now</a> = gmdate(<span class="stringliteral">&#39;Y-m-d H:i:59&#39;</span>);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        $wpdb-&gt;query (<span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_status = &#39;future&#39; WHERE post_status = &#39;publish&#39; AND post_date_gmt &gt; &#39;$now&#39;&quot;</span>);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        $posts = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, post_date FROM $wpdb-&gt;posts WHERE post_status =&#39;future&#39;&quot;</span>);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="keywordflow">if</span> ( !empty($posts) )</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            <span class="keywordflow">foreach</span> ( $posts as $post )</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                <a class="code" href="cron_8php.html#aa1513c794ed209ff01c44928a64f6752">wp_schedule_single_event</a>(<a class="code" href="wp-includes_2functions_8php.html#af7ccbb4fe49b4877219cbdbddecd7f77">mysql2date</a>(<span class="charliteral">&#39;U&#39;</span>, $post-&gt;post_date, <span class="keyword">false</span>), <span class="stringliteral">&#39;publish_future_post&#39;</span>, array($post-&gt;ID));</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    }</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;}</div>
<div class="ttc" id="cron_8php_html_aa1513c794ed209ff01c44928a64f6752"><div class="ttname"><a href="cron_8php.html#aa1513c794ed209ff01c44928a64f6752">wp_schedule_single_event</a></div><div class="ttdeci">wp_schedule_single_event($timestamp, $hook, $args=array())</div><div class="ttdef"><b>Definition:</b> <a href="cron_8php_source.html#l00022">cron.php:22</a></div></div>
<div class="ttc" id="wp-comments-post_8php_html_a47507f728fb0b77c9c07ae6962d738f8"><div class="ttname"><a href="wp-comments-post_8php.html#a47507f728fb0b77c9c07ae6962d738f8">$status</a></div><div class="ttdeci">if(empty($post-&gt;comment_status)) $status</div><div class="ttdef"><b>Definition:</b> <a href="wp-comments-post_8php_source.html#l00036">wp-comments-post.php:36</a></div></div>
<div class="ttc" id="wp-includes_2functions_8php_html_af7ccbb4fe49b4877219cbdbddecd7f77"><div class="ttname"><a href="wp-includes_2functions_8php.html#af7ccbb4fe49b4877219cbdbddecd7f77">mysql2date</a></div><div class="ttdeci">mysql2date($format, $date, $translate=true)</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2functions_8php_source.html#l00026">functions.php:26</a></div></div>
<div class="ttc" id="options-general_8php_html_af1d5ccdee975b8f4d20aaffc5b28557c"><div class="ttname"><a href="options-general_8php.html#af1d5ccdee975b8f4d20aaffc5b28557c">$now</a></div><div class="ttdeci">$now</div><div class="ttdef"><b>Definition:</b> <a href="options-general_8php_source.html#l00186">options-general.php:186</a></div></div>
<div class="ttc" id="edit-form-advanced_8php_html_ae52c52c4dfa2970c393095396ff934fd"><div class="ttname"><a href="edit-form-advanced_8php.html#ae52c52c4dfa2970c393095396ff934fd">$post</a></div><div class="ttdeci">if( 'page'==$post_type) do_action('submitpage_box' $post</div><div class="ttdef"><b>Definition:</b> <a href="edit-form-advanced_8php_source.html#l00433">edit-form-advanced.php:433</a></div></div>
<div class="ttc" id="schema_8php_html_ad2ea188fe277219078755911b899cf78"><div class="ttname"><a href="schema_8php.html#ad2ea188fe277219078755911b899cf78">populate_roles_210</a></div><div class="ttdeci">populate_roles_210()</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00677">schema.php:677</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
<div class="ttc" id="media-upload_8php_html_af01853db8db960be881882b7fb29792e"><div class="ttname"><a href="media-upload_8php.html#af01853db8db960be881882b7fb29792e">$type</a></div><div class="ttdeci">else $type</div><div class="ttdef"><b>Definition:</b> <a href="media-upload_8php_source.html#l00044">media-upload.php:44</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_aab67ca7d2045305d3847acdc086ffae3_cgraph.png" border="0" usemap="#includes_2upgrade_8php_aab67ca7d2045305d3847acdc086ffae3_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_aab67ca7d2045305d3847acdc086ffae3_cgraph" id="includes_2upgrade_8php_aab67ca7d2045305d3847acdc086ffae3_cgraph">
<area shape="rect" id="node2" href="wp-includes_2functions_8php.html#af7ccbb4fe49b4877219cbdbddecd7f77" title="mysql2date" alt="" coords="533,107,622,133"/><area shape="rect" id="node8" href="schema_8php.html#ad2ea188fe277219078755911b899cf78" title="populate_roles_210" alt="" coords="151,313,286,340"/><area shape="rect" id="node10" href="cron_8php.html#aa1513c794ed209ff01c44928a64f6752" title="wp_schedule_single\l_event" alt="" coords="149,226,288,267"/><area shape="rect" id="node3" href="wp-includes_2functions_8php.html#a053ff37ae44c85a9bef47cd59328912e" title="date_i18n" alt="" coords="1381,107,1459,133"/><area shape="rect" id="node4" href="wp-includes_2functions_8php.html#a4dacfef72ebe1c7276f7d94fdbe93554" title="current_time" alt="" coords="1579,208,1674,235"/><area shape="rect" id="node5" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="1803,259,1886,285"/><area shape="rect" id="node6" href="formatting_8php.html#aed6a642e1f184ff3c8c8ec96a69ea077" title="backslashit" alt="" coords="1583,5,1671,32"/><area shape="rect" id="node7" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="2003,537,2094,564"/><area shape="rect" id="node9" href="capabilities_8php.html#a41bea05b81b5374112aab194c590dd80" title="get_role" alt="" coords="370,360,438,387"/><area shape="rect" id="node11" href="cron_8php.html#a43c91d6f17c79de5969b87b540ad151f" title="wp_next_scheduled" alt="" coords="336,259,472,285"/><area shape="rect" id="node12" href="cron_8php.html#ab5d2461d83cac30242eda86bd7f95cd8" title="_get_cron_array" alt="" coords="520,259,635,285"/><area shape="rect" id="node50" href="cron_8php.html#ae54ce0a72e466757f23228d3ef1d0d6f" title="_set_cron_array" alt="" coords="697,816,811,843"/><area shape="rect" id="node13" href="cron_8php.html#a7b833e0e1fdc7556be45be62f253f664" title="_upgrade_cron_array" alt="" coords="683,461,825,488"/><area shape="rect" id="node14" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc" title="update_option" alt="" coords="873,1005,976,1032"/><area shape="rect" id="node15" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="1157,574,1291,615"/><area shape="rect" id="node20" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="1779,1449,1910,1476"/><area shape="rect" id="node22" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1996,1608,2101,1635"/><area shape="rect" id="node26" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="1169,740,1279,767"/><area shape="rect" id="node30" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="1805,1019,1884,1045"/><area shape="rect" id="node43" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="1183,1373,1265,1400"/><area shape="rect" id="node44" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="1367,1272,1473,1299"/><area shape="rect" id="node48" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="1024,1108,1109,1135"/><area shape="rect" id="node49" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="1166,1069,1282,1096"/><area shape="rect" id="node16" href="wp-includes_2functions_8php.html#a06d38a93c806c187fd21200c1baa9f53" title="wp_die" alt="" coords="1813,411,1876,437"/><area shape="rect" id="node17" href="formatting_8php.html#a77a1b666b7ca0e393239a9e1d1af72d3" title="esc_html" alt="" coords="1383,512,1457,539"/><area shape="rect" id="node18" href="formatting_8php.html#a745879b47424ac7b0d3b95a1edec8361" title="wp_check_invalid_utf8" alt="" coords="1551,461,1702,488"/><area shape="rect" id="node19" href="formatting_8php.html#ab9121c7a11ad101936875a65b233e126" title="_wp_specialchars" alt="" coords="1564,664,1689,691"/><area shape="rect" id="node24" href="formatting_8php.html#a4389f130de336d59e890c79b10a60beb" title="wp_specialchars_decode" alt="" coords="1761,613,1928,640"/><area shape="rect" id="node25" href="kses_8php.html#abc0e5ed7e9bad89cc998a35b48653fdb" title="wp_kses_normalize_entities" alt="" coords="1752,664,1937,691"/><area shape="rect" id="node21" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="2005,1449,2093,1476"/><area shape="rect" id="node23" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1995,1537,2103,1564"/><area shape="rect" id="node27" href="formatting_8php.html#a1a391a56d1c6c0e52239a553a0dbfb73" title="sanitize_email" alt="" coords="1574,613,1679,640"/><area shape="rect" id="node28" href="formatting_8php.html#aa394269ea323c88435820bb0a0f5912f" title="is_email" alt="" coords="1385,867,1455,893"/><area shape="rect" id="node32" href="wp-admin_2includes_2template_8php.html#ac54155d98db655b34d0c2c87d1e53c64" title="add_settings_error" alt="" coords="1355,917,1485,944"/><area shape="rect" id="node33" href="kses_8php.html#aa0817828c22f5e89ff755ae1ad1de60c" title="wp_kses_post" alt="" coords="1367,765,1473,792"/><area shape="rect" id="node38" href="kses_8php.html#a050aa6ac503f4f1a2eb655efe9b42dc6" title="wp_kses_data" alt="" coords="1367,816,1473,843"/><area shape="rect" id="node40" href="formatting_8php.html#ad9e809b6901d247527672e11ce5d7368" title="esc_url_raw" alt="" coords="1375,715,1465,741"/><area shape="rect" id="node42" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332" title="get_available_languages" alt="" coords="1339,613,1501,640"/><area shape="rect" id="node29" href="wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532" title="_deprecated_argument" alt="" coords="1549,968,1704,995"/><area shape="rect" id="node31" href="wp-includes_2plugin_8php.html#af891e88ab346a2da31111facfcf6b2cf" title="_wp_call_all_hook" alt="" coords="1985,1019,2112,1045"/><area shape="rect" id="node34" href="kses_8php.html#a16c90f8f4b5152db3c88044526e28f59" title="wp_kses" alt="" coords="1590,765,1663,792"/><area shape="rect" id="node35" href="wp-includes_2functions_8php.html#a410d6d8e60b99a2fbc62fe8116978711" title="wp_allowed_protocols" alt="" coords="1771,765,1919,792"/><area shape="rect" id="node36" href="kses_8php.html#a6a32ba00333b67cff42a76ec3762e5c3" title="wp_kses_no_null" alt="" coords="1784,816,1905,843"/><area shape="rect" id="node37" href="kses_8php.html#a3dec56a527f620ff81fa9dc188238b4f" title="wp_kses_js_entities" alt="" coords="1775,867,1914,893"/><area shape="rect" id="node39" href="wp-includes_2plugin_8php.html#ae088c31761ae2cdcff6491755b1bdab6" title="current_filter" alt="" coords="1580,816,1673,843"/><area shape="rect" id="node41" href="formatting_8php.html#a42f495a436026ff2811d0d80caca937d" title="esc_url" alt="" coords="1595,715,1659,741"/><area shape="rect" id="node45" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="1364,1475,1476,1501"/><area shape="rect" id="node46" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="1355,1323,1485,1349"/><area shape="rect" id="node47" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="1579,1120,1674,1147"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_aab67ca7d2045305d3847acdc086ffae3_icgraph.png" border="0" usemap="#includes_2upgrade_8php_aab67ca7d2045305d3847acdc086ffae3_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_aab67ca7d2045305d3847acdc086ffae3_icgraph" id="includes_2upgrade_8php_aab67ca7d2045305d3847acdc086ffae3_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae2592de93ead8b5ad27d0c4881f04d4c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_230 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 2.3.</p>
<dl class="section since"><dt>Since</dt><dd>2.3.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00756">756</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php_source.html#l00174">$count</a>, <a class="el" href="wp-content_2themes_2twentyfourteen_2sidebar_8php_source.html#l00012">$description</a>, <a class="el" href="async-upload_8php_source.html#l00082">$id</a>, <a class="el" href="link-add_8php_source.html#l00026">$link</a>, <a class="el" href="options_8php_source.html#l00208">$name</a>, <a class="el" href="my-sites_8php_source.html#l00083">$num</a>, <a class="el" href="edit-form-advanced_8php_source.html#l00433">$post</a>, <a class="el" href="async-upload_8php_source.html#l00075">$post_id</a>, <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php_source.html#l00174">if</a>, <a class="el" href="schema_8php_source.html#l00724">populate_roles_230()</a>, <a class="el" href="formatting_8php_source.html#l00951">sanitize_title()</a>, <a class="el" href="option_8php_source.html#l00214">update_option()</a>, and <a class="el" href="formatting_8php_source.html#l03381">wp_slash()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                       {</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 5200 ) {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <a class="code" href="schema_8php.html#aecf1b5847c533f7633e26d20e9c37d71">populate_roles_230</a>();</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="comment">// Convert categories to terms.</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    $tt_ids = array();</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    $have_tags = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    $categories = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT * FROM $wpdb-&gt;categories ORDER BY cat_ID&quot;</span>);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">foreach</span> ($categories as $category) {</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        $term_id = (int) $category-&gt;cat_ID;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <a class="code" href="options_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> = $category-&gt;cat_name;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <a class="code" href="wp-content_2themes_2twentyfourteen_2sidebar_8php.html#a87b032cba06009e3467abf1c8018d960">$description</a> = $category-&gt;category_description;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        $slug = $category-&gt;category_nicename;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        $parent = $category-&gt;category_parent;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        $term_group = 0;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="comment">// Associate terms with the same slug in a term group and make slugs unique.</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <a class="code" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a174bd863e19b821e37abc700f6c84ba4">if</a> ( $exists = $wpdb-&gt;get_results( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT term_id, term_group FROM $wpdb-&gt;terms WHERE slug = %s&quot;</span>, $slug) ) ) {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            $term_group = $exists[0]-&gt;term_group;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $exists[0]-&gt;term_id;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            <a class="code" href="my-sites_8php.html#a606c9dff2aade84f01338c3c4cd8016b">$num</a> = 2;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                $alt_slug = $slug . <span class="stringliteral">&quot;-$num&quot;</span>;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                <a class="code" href="my-sites_8php.html#a606c9dff2aade84f01338c3c4cd8016b">$num</a>++;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                $slug_check = $wpdb-&gt;get_var( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT slug FROM $wpdb-&gt;terms WHERE slug = %s&quot;</span>, $alt_slug) );</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            } <span class="keywordflow">while</span> ( $slug_check );</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            $slug = $alt_slug;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            <span class="keywordflow">if</span> ( empty( $term_group ) ) {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                $term_group = $wpdb-&gt;get_var(<span class="stringliteral">&quot;SELECT MAX(term_group) FROM $wpdb-&gt;terms GROUP BY term_group&quot;</span>) + 1;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;terms SET term_group = %d WHERE term_id = %d&quot;</span>, $term_group, <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a>) );</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;INSERT INTO $wpdb-&gt;terms (term_id, name, slug, term_group) VALUES</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="stringliteral">        (%d, %s, %s, %d)&quot;</span>, $term_id, <a class="code" href="options_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>, $slug, $term_group) );</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <a class="code" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a55bb8f26877d42ae1535d2abea2915bc">$count</a> = 0;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordflow">if</span> ( !empty($category-&gt;category_count) ) {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            <a class="code" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a55bb8f26877d42ae1535d2abea2915bc">$count</a> = (int) $category-&gt;category_count;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            $taxonomy = <span class="stringliteral">&#39;category&#39;</span>;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;INSERT INTO $wpdb-&gt;term_taxonomy (term_id, taxonomy, description, parent, count) VALUES ( %d, %s, %s, %d, %d)&quot;</span>, $term_id, $taxonomy, <a class="code" href="wp-content_2themes_2twentyfourteen_2sidebar_8php.html#a87b032cba06009e3467abf1c8018d960">$description</a>, $parent, <a class="code" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a55bb8f26877d42ae1535d2abea2915bc">$count</a>) );</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            $tt_ids[$term_id][$taxonomy] = (int) $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        }</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keywordflow">if</span> ( !empty($category-&gt;link_count) ) {</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <a class="code" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a55bb8f26877d42ae1535d2abea2915bc">$count</a> = (int) $category-&gt;link_count;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            $taxonomy = <span class="stringliteral">&#39;link_category&#39;</span>;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;INSERT INTO $wpdb-&gt;term_taxonomy (term_id, taxonomy, description, parent, count) VALUES ( %d, %s, %s, %d, %d)&quot;</span>, $term_id, $taxonomy, <a class="code" href="wp-content_2themes_2twentyfourteen_2sidebar_8php.html#a87b032cba06009e3467abf1c8018d960">$description</a>, $parent, <a class="code" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a55bb8f26877d42ae1535d2abea2915bc">$count</a>) );</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            $tt_ids[$term_id][$taxonomy] = (int) $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        }</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="keywordflow">if</span> ( !empty($category-&gt;tag_count) ) {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            $have_tags = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <a class="code" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a55bb8f26877d42ae1535d2abea2915bc">$count</a> = (int) $category-&gt;tag_count;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            $taxonomy = <span class="stringliteral">&#39;post_tag&#39;</span>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            $wpdb-&gt;insert( $wpdb-&gt;term_taxonomy, compact(<span class="stringliteral">&#39;term_id&#39;</span>, <span class="stringliteral">&#39;taxonomy&#39;</span>, <span class="stringliteral">&#39;description&#39;</span>, <span class="stringliteral">&#39;parent&#39;</span>, <span class="stringliteral">&#39;count&#39;</span>) );</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            $tt_ids[$term_id][$taxonomy] = (int) $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        }</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <span class="keywordflow">if</span> ( empty(<a class="code" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a55bb8f26877d42ae1535d2abea2915bc">$count</a>) ) {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            <a class="code" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a55bb8f26877d42ae1535d2abea2915bc">$count</a> = 0;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            $taxonomy = <span class="stringliteral">&#39;category&#39;</span>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            $wpdb-&gt;insert( $wpdb-&gt;term_taxonomy, compact(<span class="stringliteral">&#39;term_id&#39;</span>, <span class="stringliteral">&#39;taxonomy&#39;</span>, <span class="stringliteral">&#39;description&#39;</span>, <span class="stringliteral">&#39;parent&#39;</span>, <span class="stringliteral">&#39;count&#39;</span>) );</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            $tt_ids[$term_id][$taxonomy] = (int) $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    }</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    $select = <span class="stringliteral">&#39;post_id, category_id&#39;</span>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">if</span> ( $have_tags )</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        $select .= <span class="stringliteral">&#39;, rel_type&#39;</span>;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    $posts = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT $select FROM $wpdb-&gt;post2cat GROUP BY post_id, category_id&quot;</span>);</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordflow">foreach</span> ( $posts as <a class="code" href="edit-form-advanced_8php.html#ae52c52c4dfa2970c393095396ff934fd">$post</a> ) {</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> = (int) $post-&gt;post_id;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        $term_id = (<span class="keywordtype">int</span>) $post-&gt;category_id;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        $taxonomy = <span class="stringliteral">&#39;category&#39;</span>;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="keywordflow">if</span> ( !empty($post-&gt;rel_type) &amp;&amp; <span class="stringliteral">&#39;tag&#39;</span> == $post-&gt;rel_type)</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            $taxonomy = <span class="stringliteral">&#39;tag&#39;</span>;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        $tt_id = $tt_ids[$term_id][$taxonomy];</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="keywordflow">if</span> ( empty($tt_id) )</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        $wpdb-&gt;insert( $wpdb-&gt;term_relationships, array(<span class="stringliteral">&#39;object_id&#39;</span> =&gt; <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;term_taxonomy_id&#39;</span> =&gt; $tt_id) );</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    }</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="comment">// &lt; 3570 we used linkcategories. &gt;= 3570 we used categories and link2cat.</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 3570 ) {</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="comment">// Create link_category terms for link categories. Create a map of link cat IDs</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="comment">// to link_category terms.</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        $link_cat_id_map = array();</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        $default_link_cat = 0;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        $tt_ids = array();</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        $link_cats = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT cat_id, cat_name FROM &quot;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;linkcategories&#39;</span>);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="keywordflow">foreach</span> ( $link_cats as $category) {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            $cat_id = (int) $category-&gt;cat_id;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            $term_id = 0;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            <a class="code" href="options_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> = <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($category-&gt;cat_name);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            $slug = <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>(<a class="code" href="options_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            $term_group = 0;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            <span class="comment">// Associate terms with the same slug in a term group and make slugs unique.</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            <span class="keywordflow">if</span> ( $exists = $wpdb-&gt;get_results( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT term_id, term_group FROM $wpdb-&gt;terms WHERE slug = %s&quot;</span>, $slug) ) ) {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                $term_group = $exists[0]-&gt;term_group;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                $term_id = $exists[0]-&gt;term_id;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            }</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            <span class="keywordflow">if</span> ( empty($term_id) ) {</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                $wpdb-&gt;insert( $wpdb-&gt;terms, compact(<span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;slug&#39;</span>, <span class="stringliteral">&#39;term_group&#39;</span>) );</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                $term_id = (int) $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            }</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            $link_cat_id_map[$cat_id] = $term_id;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            $default_link_cat = $term_id;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            $wpdb-&gt;insert( $wpdb-&gt;term_taxonomy, array(<span class="stringliteral">&#39;term_id&#39;</span> =&gt; $term_id, <span class="stringliteral">&#39;taxonomy&#39;</span> =&gt; <span class="stringliteral">&#39;link_category&#39;</span>, <span class="stringliteral">&#39;description&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;parent&#39;</span> =&gt; 0, <span class="stringliteral">&#39;count&#39;</span> =&gt; 0) );</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            $tt_ids[$term_id] = (int) $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <span class="comment">// Associate links to cats.</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        $links = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT link_id, link_category FROM $wpdb-&gt;links&quot;</span>);</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <span class="keywordflow">if</span> ( !empty($links) ) <span class="keywordflow">foreach</span> ( $links as <a class="code" href="link-add_8php.html#a5d346e31b75d916e3bac9cb193bfc97f">$link</a> ) {</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;            <span class="keywordflow">if</span> ( 0 == $link-&gt;link_category )</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            <span class="keywordflow">if</span> ( ! isset($link_cat_id_map[$link-&gt;link_category]) )</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            $term_id = $link_cat_id_map[$link-&gt;link_category];</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            $tt_id = $tt_ids[$term_id];</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            <span class="keywordflow">if</span> ( empty($tt_id) )</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            $wpdb-&gt;insert( $wpdb-&gt;term_relationships, array(<span class="stringliteral">&#39;object_id&#39;</span> =&gt; $link-&gt;link_id, <span class="stringliteral">&#39;term_taxonomy_id&#39;</span> =&gt; $tt_id) );</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        }</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        <span class="comment">// Set default to the last category we grabbed during the upgrade loop.</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <a class="code" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a>(<span class="stringliteral">&#39;default_link_category&#39;</span>, $default_link_cat);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        $links = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT link_id, category_id FROM $wpdb-&gt;link2cat GROUP BY link_id, category_id&quot;</span>);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <span class="keywordflow">foreach</span> ( $links as $link ) {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            $link_id = (int) $link-&gt;link_id;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            $term_id = (<span class="keywordtype">int</span>) $link-&gt;category_id;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            $taxonomy = <span class="stringliteral">&#39;link_category&#39;</span>;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            $tt_id = $tt_ids[$term_id][$taxonomy];</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            <span class="keywordflow">if</span> ( empty($tt_id) )</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            $wpdb-&gt;insert( $wpdb-&gt;term_relationships, array(<span class="stringliteral">&#39;object_id&#39;</span> =&gt; $link_id, <span class="stringliteral">&#39;term_taxonomy_id&#39;</span> =&gt; $tt_id) );</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    }</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 4772 ) {</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="comment">// Obsolete linkcategories table</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;linkcategories&#39;</span>);</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    }</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="comment">// Recalculate all counts</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    $terms = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT term_taxonomy_id, taxonomy FROM $wpdb-&gt;term_taxonomy&quot;</span>);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">foreach</span> ( (array) $terms as $term ) {</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">if</span> ( (<span class="stringliteral">&#39;post_tag&#39;</span> == $term-&gt;taxonomy) || (<span class="stringliteral">&#39;category&#39;</span> == $term-&gt;taxonomy) )</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            <a class="code" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a55bb8f26877d42ae1535d2abea2915bc">$count</a> = $wpdb-&gt;get_var( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT COUNT(*) FROM $wpdb-&gt;term_relationships, $wpdb-&gt;posts WHERE $wpdb-&gt;posts.ID = $wpdb-&gt;term_relationships.object_id AND post_status = &#39;publish&#39; AND post_type = &#39;post&#39; AND term_taxonomy_id = %d&quot;</span>, $term-&gt;term_taxonomy_id) );</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            <a class="code" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a55bb8f26877d42ae1535d2abea2915bc">$count</a> = $wpdb-&gt;get_var( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT COUNT(*) FROM $wpdb-&gt;term_relationships WHERE term_taxonomy_id = %d&quot;</span>, $term-&gt;term_taxonomy_id) );</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        $wpdb-&gt;update( $wpdb-&gt;term_taxonomy, array(<span class="stringliteral">&#39;count&#39;</span> =&gt; <a class="code" href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a55bb8f26877d42ae1535d2abea2915bc">$count</a>), array(<span class="stringliteral">&#39;term_taxonomy_id&#39;</span> =&gt; $term-&gt;term_taxonomy_id) );</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;}</div>
<div class="ttc" id="link-add_8php_html_a5d346e31b75d916e3bac9cb193bfc97f"><div class="ttname"><a href="link-add_8php.html#a5d346e31b75d916e3bac9cb193bfc97f">$link</a></div><div class="ttdeci">$link</div><div class="ttdef"><b>Definition:</b> <a href="link-add_8php_source.html#l00026">link-add.php:26</a></div></div>
<div class="ttc" id="option_8php_html_a7c47bc5d444687bebd583e6b5dfc04bc"><div class="ttname"><a href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a></div><div class="ttdeci">update_option($option, $newvalue)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00214">option.php:214</a></div></div>
<div class="ttc" id="my-sites_8php_html_a606c9dff2aade84f01338c3c4cd8016b"><div class="ttname"><a href="my-sites_8php.html#a606c9dff2aade84f01338c3c4cd8016b">$num</a></div><div class="ttdeci">$num</div><div class="ttdef"><b>Definition:</b> <a href="my-sites_8php_source.html#l00083">my-sites.php:83</a></div></div>
<div class="ttc" id="async-upload_8php_html_a2717aea9720d8d0b37b32fede52333b6"><div class="ttname"><a href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a></div><div class="ttdeci">$post_id</div><div class="ttdef"><b>Definition:</b> <a href="async-upload_8php_source.html#l00075">async-upload.php:75</a></div></div>
<div class="ttc" id="formatting_8php_html_aa5eab0fce35c72689998f801b8fc7dfe"><div class="ttname"><a href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a></div><div class="ttdeci">wp_slash($value)</div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l03381">formatting.php:3381</a></div></div>
<div class="ttc" id="schema_8php_html_aecf1b5847c533f7633e26d20e9c37d71"><div class="ttname"><a href="schema_8php.html#aecf1b5847c533f7633e26d20e9c37d71">populate_roles_230</a></div><div class="ttdeci">populate_roles_230()</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00724">schema.php:724</a></div></div>
<div class="ttc" id="async-upload_8php_html_ad69de186eb69f332f105ae157136192e"><div class="ttname"><a href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a></div><div class="ttdeci">if(isset($_REQUEST['post_id'])) $id</div><div class="ttdef"><b>Definition:</b> <a href="async-upload_8php_source.html#l00082">async-upload.php:82</a></div></div>
<div class="ttc" id="wp-content_2themes_2twentyfourteen_2sidebar_8php_html_a87b032cba06009e3467abf1c8018d960"><div class="ttname"><a href="wp-content_2themes_2twentyfourteen_2sidebar_8php.html#a87b032cba06009e3467abf1c8018d960">$description</a></div><div class="ttdeci">$description</div><div class="ttdef"><b>Definition:</b> <a href="wp-content_2themes_2twentyfourteen_2sidebar_8php_source.html#l00012">sidebar.php:12</a></div></div>
<div class="ttc" id="_p_h_p-_parser-1_80_81_2test__old_2run_8php_html_a174bd863e19b821e37abc700f6c84ba4"><div class="ttname"><a href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a174bd863e19b821e37abc700f6c84ba4">if</a></div><div class="ttdeci">if(0!==$parseFail) if(0!==$ppFail) if(0!==$compareFail)</div><div class="ttdef"><b>Definition:</b> <a href="_p_h_p-_parser-1_80_81_2test__old_2run_8php_source.html#l00174">run.php:174</a></div></div>
<div class="ttc" id="formatting_8php_html_ac6495c47468fb816d78bb2d2b326d808"><div class="ttname"><a href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a></div><div class="ttdeci">sanitize_title($title, $fallback_title= '', $context= 'save')</div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l00951">formatting.php:951</a></div></div>
<div class="ttc" id="_p_h_p-_parser-1_80_81_2test__old_2run_8php_html_a55bb8f26877d42ae1535d2abea2915bc"><div class="ttname"><a href="_p_h_p-_parser-1_80_81_2test__old_2run_8php.html#a55bb8f26877d42ae1535d2abea2915bc">$count</a></div><div class="ttdeci">if(0!==$parseFail) if(0!==$ppFail) $count</div><div class="ttdef"><b>Definition:</b> <a href="_p_h_p-_parser-1_80_81_2test__old_2run_8php_source.html#l00174">run.php:174</a></div></div>
<div class="ttc" id="edit-form-advanced_8php_html_ae52c52c4dfa2970c393095396ff934fd"><div class="ttname"><a href="edit-form-advanced_8php.html#ae52c52c4dfa2970c393095396ff934fd">$post</a></div><div class="ttdeci">if( 'page'==$post_type) do_action('submitpage_box' $post</div><div class="ttdef"><b>Definition:</b> <a href="edit-form-advanced_8php_source.html#l00433">edit-form-advanced.php:433</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
<div class="ttc" id="options_8php_html_ab2fc40d43824ea3e1ce5d86dee0d763b"><div class="ttname"><a href="options_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a></div><div class="ttdeci">$name</div><div class="ttdef"><b>Definition:</b> <a href="options_8php_source.html#l00208">options.php:208</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_ae2592de93ead8b5ad27d0c4881f04d4c_cgraph.png" border="0" usemap="#includes_2upgrade_8php_ae2592de93ead8b5ad27d0c4881f04d4c_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_ae2592de93ead8b5ad27d0c4881f04d4c_cgraph" id="includes_2upgrade_8php_ae2592de93ead8b5ad27d0c4881f04d4c_cgraph">
<area shape="rect" id="node2" href="schema_8php.html#aecf1b5847c533f7633e26d20e9c37d71" title="populate_roles_230" alt="" coords="149,366,284,393"/><area shape="rect" id="node4" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808" title="sanitize_title" alt="" coords="169,721,264,747"/><area shape="rect" id="node20" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc" title="update_option" alt="" coords="165,670,268,697"/><area shape="rect" id="node50" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe" title="wp_slash" alt="" coords="179,771,255,798"/><area shape="rect" id="node3" href="capabilities_8php.html#a41bea05b81b5374112aab194c590dd80" title="get_role" alt="" coords="356,113,424,139"/><area shape="rect" id="node5" href="formatting_8php.html#a05e464b55ec2c8b334abed9864d014e9" title="remove_accents" alt="" coords="332,467,448,494"/><area shape="rect" id="node8" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="1342,1227,1433,1254"/><area shape="rect" id="node6" href="formatting_8php.html#a618ba7bdc2cf2790af2e9fa968f03615" title="seems_utf8" alt="" coords="518,366,607,393"/><area shape="rect" id="node7" href="l10n_8php.html#a6ec9fd4baced85768ba16386e9e1b339" title="get_locale" alt="" coords="522,467,603,494"/><area shape="rect" id="node9" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="1343,163,1431,190"/><area shape="rect" id="node10" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="1142,1075,1225,1102"/><area shape="rect" id="node11" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa" title="get_site_option" alt="" coords="703,366,814,393"/><area shape="rect" id="node12" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1335,366,1440,393"/><area shape="rect" id="node13" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="924,366,1007,393"/><area shape="rect" id="node16" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="1131,518,1236,545"/><area shape="rect" id="node18" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="1118,113,1249,139"/><area shape="rect" id="node14" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="1118,214,1249,241"/><area shape="rect" id="node15" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1333,239,1441,266"/><area shape="rect" id="node17" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="1127,417,1239,443"/><area shape="rect" id="node19" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="1340,62,1435,89"/><area shape="rect" id="node21" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="496,1376,629,1417"/><area shape="rect" id="node28" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="508,1202,617,1229"/><area shape="rect" id="node32" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="1144,873,1223,899"/><area shape="rect" id="node48" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="347,670,433,697"/><area shape="rect" id="node49" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="505,163,621,190"/><area shape="rect" id="node22" href="wp-includes_2functions_8php.html#a06d38a93c806c187fd21200c1baa9f53" title="wp_die" alt="" coords="934,1734,997,1761"/><area shape="rect" id="node23" href="formatting_8php.html#a77a1b666b7ca0e393239a9e1d1af72d3" title="esc_html" alt="" coords="721,1481,796,1507"/><area shape="rect" id="node24" href="formatting_8php.html#a745879b47424ac7b0d3b95a1edec8361" title="wp_check_invalid_utf8" alt="" coords="890,1227,1041,1254"/><area shape="rect" id="node25" href="formatting_8php.html#ab9121c7a11ad101936875a65b233e126" title="_wp_specialchars" alt="" coords="903,1278,1028,1305"/><area shape="rect" id="node26" href="formatting_8php.html#a4389f130de336d59e890c79b10a60beb" title="wp_specialchars_decode" alt="" coords="1100,1177,1267,1203"/><area shape="rect" id="node27" href="kses_8php.html#abc0e5ed7e9bad89cc998a35b48653fdb" title="wp_kses_normalize_entities" alt="" coords="1091,1278,1276,1305"/><area shape="rect" id="node29" href="formatting_8php.html#a1a391a56d1c6c0e52239a553a0dbfb73" title="sanitize_email" alt="" coords="913,1126,1018,1153"/><area shape="rect" id="node30" href="formatting_8php.html#aa394269ea323c88435820bb0a0f5912f" title="is_email" alt="" coords="723,1227,794,1254"/><area shape="rect" id="node34" href="wp-admin_2includes_2template_8php.html#ac54155d98db655b34d0c2c87d1e53c64" title="add_settings_error" alt="" coords="694,1126,823,1153"/><area shape="rect" id="node35" href="kses_8php.html#aa0817828c22f5e89ff755ae1ad1de60c" title="wp_kses_post" alt="" coords="706,1430,811,1457"/><area shape="rect" id="node42" href="kses_8php.html#a050aa6ac503f4f1a2eb655efe9b42dc6" title="wp_kses_data" alt="" coords="706,1379,811,1406"/><area shape="rect" id="node44" href="formatting_8php.html#ad9e809b6901d247527672e11ce5d7368" title="esc_url_raw" alt="" coords="713,1329,804,1355"/><area shape="rect" id="node47" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332" title="get_available_languages" alt="" coords="677,1075,840,1102"/><area shape="rect" id="node31" href="wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532" title="_deprecated_argument" alt="" coords="888,923,1043,950"/><area shape="rect" id="node33" href="wp-includes_2plugin_8php.html#af891e88ab346a2da31111facfcf6b2cf" title="_wp_call_all_hook" alt="" coords="1324,873,1451,899"/><area shape="rect" id="node36" href="kses_8php.html#a16c90f8f4b5152db3c88044526e28f59" title="wp_kses" alt="" coords="929,1430,1002,1457"/><area shape="rect" id="node37" href="wp-includes_2functions_8php.html#a410d6d8e60b99a2fbc62fe8116978711" title="wp_allowed_protocols" alt="" coords="1109,1379,1257,1406"/><area shape="rect" id="node38" href="kses_8php.html#a6a32ba00333b67cff42a76ec3762e5c3" title="wp_kses_no_null" alt="" coords="1123,1430,1244,1457"/><area shape="rect" id="node39" href="kses_8php.html#a3dec56a527f620ff81fa9dc188238b4f" title="wp_kses_js_entities" alt="" coords="1114,1481,1253,1507"/><area shape="rect" id="node40" href="kses_8php.html#a387ea2ab906936be7f094a0152f7886a" title="wp_kses_hook" alt="" coords="1129,1582,1237,1609"/><area shape="rect" id="node41" href="kses_8php.html#a1157570413297149e62e627d8e10c6b9" title="wp_kses_split" alt="" coords="1131,1531,1235,1558"/><area shape="rect" id="node43" href="wp-includes_2plugin_8php.html#ae088c31761ae2cdcff6491755b1bdab6" title="current_filter" alt="" coords="919,1177,1012,1203"/><area shape="rect" id="node45" href="formatting_8php.html#a42f495a436026ff2811d0d80caca937d" title="esc_url" alt="" coords="933,1329,997,1355"/><area shape="rect" id="node46" href="formatting_8php.html#a07cee162d2dea8a7e788f6542534490a" title="_deep_replace" alt="" coords="1130,1227,1237,1254"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_ae2592de93ead8b5ad27d0c4881f04d4c_icgraph.png" border="0" usemap="#includes_2upgrade_8php_ae2592de93ead8b5ad27d0c4881f04d4c_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_ae2592de93ead8b5ad27d0c4881f04d4c_icgraph" id="includes_2upgrade_8php_ae2592de93ead8b5ad27d0c4881f04d4c_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a27bc17575990d42ea587d1473b2344a5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_230_old_tables </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove old categories, link2cat, and post2cat database tables.</p>
<dl class="section since"><dt>Since</dt><dd>2.3.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00944">944</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                                  {</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;categories&#39;</span>);</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;link2cat&#39;</span>);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;post2cat&#39;</span>);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;}</div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a27bc17575990d42ea587d1473b2344a5_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a27bc17575990d42ea587d1473b2344a5_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a27bc17575990d42ea587d1473b2344a5_icgraph" id="includes_2upgrade_8php_a27bc17575990d42ea587d1473b2344a5_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="216,5,304,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8bbabcdc52ae172d75e457cab5aed16b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_230_options_table </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove old options from the database.</p>
<dl class="section since"><dt>Since</dt><dd>2.3.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00930">930</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                                     {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    $old_options_fields = array( <span class="stringliteral">&#39;option_can_override&#39;</span>, <span class="stringliteral">&#39;option_type&#39;</span>, <span class="stringliteral">&#39;option_width&#39;</span>, <span class="stringliteral">&#39;option_height&#39;</span>, <span class="stringliteral">&#39;option_description&#39;</span>, <span class="stringliteral">&#39;option_admin_level&#39;</span> );</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    $wpdb-&gt;hide_errors();</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">foreach</span> ( $old_options_fields as $old )</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;options DROP $old&quot;</span>);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    $wpdb-&gt;show_errors();</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;}</div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a8bbabcdc52ae172d75e457cab5aed16b_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a8bbabcdc52ae172d75e457cab5aed16b_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a8bbabcdc52ae172d75e457cab5aed16b_icgraph" id="includes_2upgrade_8php_a8bbabcdc52ae172d75e457cab5aed16b_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="199,13,287,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8de9897e7cf8de14bb1d857f63d7eb31"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_250 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 2.5.0.</p>
<dl class="section since"><dt>Since</dt><dd>2.5.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00967">967</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00737">populate_roles_250()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                       {</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    global $wp_current_db_version;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 6689 ) {</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <a class="code" href="schema_8php.html#afce90368b01f472eb9bb1985ad8bf516">populate_roles_250</a>();</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    }</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;}</div>
<div class="ttc" id="schema_8php_html_afce90368b01f472eb9bb1985ad8bf516"><div class="ttname"><a href="schema_8php.html#afce90368b01f472eb9bb1985ad8bf516">populate_roles_250</a></div><div class="ttdeci">populate_roles_250()</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00737">schema.php:737</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a8de9897e7cf8de14bb1d857f63d7eb31_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a8de9897e7cf8de14bb1d857f63d7eb31_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a8de9897e7cf8de14bb1d857f63d7eb31_cgraph" id="includes_2upgrade_8php_a8de9897e7cf8de14bb1d857f63d7eb31_cgraph">
<area shape="rect" id="node2" href="schema_8php.html#afce90368b01f472eb9bb1985ad8bf516" title="populate_roles_250" alt="" coords="149,5,284,32"/><area shape="rect" id="node3" href="capabilities_8php.html#a41bea05b81b5374112aab194c590dd80" title="get_role" alt="" coords="332,5,400,32"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a8de9897e7cf8de14bb1d857f63d7eb31_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a8de9897e7cf8de14bb1d857f63d7eb31_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a8de9897e7cf8de14bb1d857f63d7eb31_icgraph" id="includes_2upgrade_8php_a8de9897e7cf8de14bb1d857f63d7eb31_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa067f5e7c95f1f875412140fc6c3b0c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_252 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 2.5.2.</p>
<dl class="section since"><dt>Since</dt><dd>2.5.2 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00981">981</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                       {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;users SET user_activation_key = &#39;&#39;&quot;</span>);</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;}</div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_aa067f5e7c95f1f875412140fc6c3b0c6_icgraph.png" border="0" usemap="#includes_2upgrade_8php_aa067f5e7c95f1f875412140fc6c3b0c6_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_aa067f5e7c95f1f875412140fc6c3b0c6_icgraph" id="includes_2upgrade_8php_aa067f5e7c95f1f875412140fc6c3b0c6_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad54593aefc766c0b0070e2d4d09d9b6b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_260 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 2.6.</p>
<dl class="section since"><dt>Since</dt><dd>2.6.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00992">992</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00750">populate_roles_260()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                       {</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    global $wp_current_db_version;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 8000 )</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <a class="code" href="schema_8php.html#aa8757d0a593613e9355764eed6e4d2bd">populate_roles_260</a>();</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;}</div>
<div class="ttc" id="schema_8php_html_aa8757d0a593613e9355764eed6e4d2bd"><div class="ttname"><a href="schema_8php.html#aa8757d0a593613e9355764eed6e4d2bd">populate_roles_260</a></div><div class="ttdeci">populate_roles_260()</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00750">schema.php:750</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_ad54593aefc766c0b0070e2d4d09d9b6b_cgraph.png" border="0" usemap="#includes_2upgrade_8php_ad54593aefc766c0b0070e2d4d09d9b6b_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_ad54593aefc766c0b0070e2d4d09d9b6b_cgraph" id="includes_2upgrade_8php_ad54593aefc766c0b0070e2d4d09d9b6b_cgraph">
<area shape="rect" id="node2" href="schema_8php.html#aa8757d0a593613e9355764eed6e4d2bd" title="populate_roles_260" alt="" coords="149,5,284,32"/><area shape="rect" id="node3" href="capabilities_8php.html#a41bea05b81b5374112aab194c590dd80" title="get_role" alt="" coords="332,5,400,32"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_ad54593aefc766c0b0070e2d4d09d9b6b_icgraph.png" border="0" usemap="#includes_2upgrade_8php_ad54593aefc766c0b0070e2d4d09d9b6b_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_ad54593aefc766c0b0070e2d4d09d9b6b_icgraph" id="includes_2upgrade_8php_ad54593aefc766c0b0070e2d4d09d9b6b_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a368ab1a3cf990a5d56d850ebf43134e3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_270 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 2.7.</p>
<dl class="section since"><dt>Since</dt><dd>2.7.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01004">1004</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, and <a class="el" href="schema_8php_source.html#l00764">populate_roles_270()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                       {</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>, $wp_current_db_version;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 8980 )</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <a class="code" href="schema_8php.html#a8bc8d01445e862efd317a5a8091515f4">populate_roles_270</a>();</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="comment">// Update post_date for unpublished posts with empty timestamp</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 8921 )</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_date = post_modified WHERE post_date = &#39;0000-00-00 00:00:00&#39;&quot;</span> );</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;}</div>
<div class="ttc" id="schema_8php_html_a8bc8d01445e862efd317a5a8091515f4"><div class="ttname"><a href="schema_8php.html#a8bc8d01445e862efd317a5a8091515f4">populate_roles_270</a></div><div class="ttdeci">populate_roles_270()</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00764">schema.php:764</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a368ab1a3cf990a5d56d850ebf43134e3_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a368ab1a3cf990a5d56d850ebf43134e3_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a368ab1a3cf990a5d56d850ebf43134e3_cgraph" id="includes_2upgrade_8php_a368ab1a3cf990a5d56d850ebf43134e3_cgraph">
<area shape="rect" id="node2" href="schema_8php.html#a8bc8d01445e862efd317a5a8091515f4" title="populate_roles_270" alt="" coords="149,5,284,32"/><area shape="rect" id="node3" href="capabilities_8php.html#a41bea05b81b5374112aab194c590dd80" title="get_role" alt="" coords="332,5,400,32"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a368ab1a3cf990a5d56d850ebf43134e3_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a368ab1a3cf990a5d56d850ebf43134e3_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a368ab1a3cf990a5d56d850ebf43134e3_icgraph" id="includes_2upgrade_8php_a368ab1a3cf990a5d56d850ebf43134e3_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0070e44c50c79d7fd455a3b1ea6f13d9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_280 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 2.8.</p>
<dl class="section since"><dt>Since</dt><dd>2.8.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01020">1020</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="load_8php_source.html#l00677">is_multisite()</a>, <a class="el" href="schema_8php_source.html#l00778">populate_roles_280()</a>, <a class="el" href="ms-blogs_8php_source.html#l00226">refresh_blog_details()</a>, and <a class="el" href="option_8php_source.html#l00214">update_option()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                       {</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 10360 )</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        <a class="code" href="schema_8php.html#a9e635badc4aab288965ee64bd2a8a607">populate_roles_280</a>();</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() ) {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        $start = 0;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <span class="keywordflow">while</span>( $rows = $wpdb-&gt;get_results( <span class="stringliteral">&quot;SELECT option_name, option_value FROM $wpdb-&gt;options ORDER BY option_id LIMIT $start, 20&quot;</span> ) ) {</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;            <span class="keywordflow">foreach</span>( $rows as $row ) {</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                $value = $row-&gt;option_value;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                <span class="keywordflow">if</span> ( !@unserialize( $value ) )</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                    $value = stripslashes( $value );</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                <span class="keywordflow">if</span> ( $value !== $row-&gt;option_value ) {</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                    <a class="code" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a>( $row-&gt;option_name, $value );</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                }</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            }</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;            $start += 20;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        }</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <a class="code" href="ms-blogs_8php.html#ad0c6ddbae2d629705b8f5f9a189abda7">refresh_blog_details</a>( $wpdb-&gt;blogid );</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    }</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;}</div>
<div class="ttc" id="option_8php_html_a7c47bc5d444687bebd583e6b5dfc04bc"><div class="ttname"><a href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a></div><div class="ttdeci">update_option($option, $newvalue)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00214">option.php:214</a></div></div>
<div class="ttc" id="ms-blogs_8php_html_ad0c6ddbae2d629705b8f5f9a189abda7"><div class="ttname"><a href="ms-blogs_8php.html#ad0c6ddbae2d629705b8f5f9a189abda7">refresh_blog_details</a></div><div class="ttdeci">refresh_blog_details($blog_id)</div><div class="ttdef"><b>Definition:</b> <a href="ms-blogs_8php_source.html#l00226">ms-blogs.php:226</a></div></div>
<div class="ttc" id="load_8php_html_a72e5386fcd7a5ce7526d208d0b03a0af"><div class="ttname"><a href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a></div><div class="ttdeci">is_multisite()</div><div class="ttdef"><b>Definition:</b> <a href="load_8php_source.html#l00677">load.php:677</a></div></div>
<div class="ttc" id="schema_8php_html_a9e635badc4aab288965ee64bd2a8a607"><div class="ttname"><a href="schema_8php.html#a9e635badc4aab288965ee64bd2a8a607">populate_roles_280</a></div><div class="ttdeci">populate_roles_280()</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00778">schema.php:778</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a0070e44c50c79d7fd455a3b1ea6f13d9_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a0070e44c50c79d7fd455a3b1ea6f13d9_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a0070e44c50c79d7fd455a3b1ea6f13d9_cgraph" id="includes_2upgrade_8php_a0070e44c50c79d7fd455a3b1ea6f13d9_cgraph">
<area shape="rect" id="node2" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="1331,195,1419,221"/><area shape="rect" id="node3" href="schema_8php.html#a9e635badc4aab288965ee64bd2a8a607" title="populate_roles_280" alt="" coords="149,1512,284,1539"/><area shape="rect" id="node5" href="ms-blogs_8php.html#ad0c6ddbae2d629705b8f5f9a189abda7" title="refresh_blog_details" alt="" coords="465,1296,603,1323"/><area shape="rect" id="node25" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc" title="update_option" alt="" coords="165,904,268,931"/><area shape="rect" id="node4" href="capabilities_8php.html#a41bea05b81b5374112aab194c590dd80" title="get_role" alt="" coords="341,1664,409,1691"/><area shape="rect" id="node6" href="ms-blogs_8php.html#a40f63d39307bb824283f002a76bd8959" title="get_blog_details" alt="" coords="674,1309,790,1336"/><area shape="rect" id="node14" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="1125,1547,1203,1573"/><area shape="rect" id="node24" href="ms-blogs_8php.html#a163ef29a3c969e466f850f1c5e1d8f15" title="clean_blog_cache" alt="" coords="669,1259,795,1285"/><area shape="rect" id="node7" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1323,1107,1428,1133"/><area shape="rect" id="node8" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="1111,1107,1217,1133"/><area shape="rect" id="node9" href="ms-load_8php.html#a34f9732e2013b8bce02c952e9b4e0d29" title="is_subdomain_install" alt="" coords="1093,1436,1235,1463"/><area shape="rect" id="node10" href="load_8php.html#a49b99067b44a28b2df04dcbd50569624" title="get_current_blog_id" alt="" coords="871,1411,1006,1437"/><area shape="rect" id="node11" href="ms-blogs_8php.html#a62bcd6dd6074665ed195a5d73cc5ee02" title="get_id_from_blogname" alt="" coords="863,1360,1015,1387"/><area shape="rect" id="node12" href="cache_8php.html#a5051b30effe4731d830d0a838121b867" title="wp_cache_delete" alt="" coords="877,1208,1000,1235"/><area shape="rect" id="node13" href="ms-blogs_8php.html#ad7c90de7a9734c0cf051edff556efcee" title="switch_to_blog" alt="" coords="885,1664,993,1691"/><area shape="rect" id="node21" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="1123,499,1205,525"/><area shape="rect" id="node22" href="ms-blogs_8php.html#aa6ec3a2b8c0ff571962ccc9bcdb82ced" title="restore_current_blog" alt="" coords="869,1715,1009,1741"/><area shape="rect" id="node23" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="1119,321,1209,348"/><area shape="rect" id="node16" href="cache_8php.html#a1439ccbb26c668be74b738cb9a69fe94" title="wp_cache_switch_to_blog" alt="" coords="1077,1831,1251,1857"/><area shape="rect" id="node17" href="cache_8php.html#adfff7f29d2eca9834839e0af19fad239" title="wp_cache_init" alt="" coords="1112,1597,1216,1624"/><area shape="rect" id="node18" href="cache_8php.html#a229759d2003cfe9a14c5fd07bda91d55" title="wp_cache_add_global\l_groups" alt="" coords="1089,1649,1239,1690"/><area shape="rect" id="node19" href="cache_8php.html#a68314416647178946c184fb20b3a6ed6" title="wp_cache_add_non_persistent\l_groups" alt="" coords="1064,1714,1264,1755"/><area shape="rect" id="node20" href="load-scripts_8php.html#a753b240fe7499a74631637be3dc28192" title="did_action" alt="" coords="1123,1780,1205,1807"/><area shape="rect" id="node15" href="wp-includes_2plugin_8php.html#af891e88ab346a2da31111facfcf6b2cf" title="_wp_call_all_hook" alt="" coords="1312,1547,1439,1573"/><area shape="rect" id="node26" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="467,450,601,491"/><area shape="rect" id="node31" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="1099,803,1229,829"/><area shape="rect" id="node33" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="479,540,589,567"/><area shape="rect" id="node45" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="897,955,980,981"/><area shape="rect" id="node49" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="332,904,417,931"/><area shape="rect" id="node50" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="476,43,592,69"/><area shape="rect" id="node27" href="wp-includes_2functions_8php.html#a06d38a93c806c187fd21200c1baa9f53" title="wp_die" alt="" coords="701,144,763,171"/><area shape="rect" id="node28" href="formatting_8php.html#a77a1b666b7ca0e393239a9e1d1af72d3" title="esc_html" alt="" coords="695,411,769,437"/><area shape="rect" id="node29" href="formatting_8php.html#a745879b47424ac7b0d3b95a1edec8361" title="wp_check_invalid_utf8" alt="" coords="863,397,1014,424"/><area shape="rect" id="node30" href="formatting_8php.html#ab9121c7a11ad101936875a65b233e126" title="_wp_specialchars" alt="" coords="876,448,1001,475"/><area shape="rect" id="node32" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1321,853,1429,880"/><area shape="rect" id="node34" href="formatting_8php.html#a1a391a56d1c6c0e52239a553a0dbfb73" title="sanitize_email" alt="" coords="679,195,785,221"/><area shape="rect" id="node35" href="formatting_8php.html#aa394269ea323c88435820bb0a0f5912f" title="is_email" alt="" coords="697,715,767,741"/><area shape="rect" id="node37" href="wp-admin_2includes_2template_8php.html#ac54155d98db655b34d0c2c87d1e53c64" title="add_settings_error" alt="" coords="667,613,797,640"/><area shape="rect" id="node38" href="kses_8php.html#aa0817828c22f5e89ff755ae1ad1de60c" title="wp_kses_post" alt="" coords="679,512,785,539"/><area shape="rect" id="node40" href="kses_8php.html#a050aa6ac503f4f1a2eb655efe9b42dc6" title="wp_kses_data" alt="" coords="679,664,785,691"/><area shape="rect" id="node42" href="formatting_8php.html#ad9e809b6901d247527672e11ce5d7368" title="esc_url_raw" alt="" coords="687,245,777,272"/><area shape="rect" id="node44" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332" title="get_available_languages" alt="" coords="651,563,813,589"/><area shape="rect" id="node36" href="wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532" title="_deprecated_argument" alt="" coords="861,701,1016,728"/><area shape="rect" id="node39" href="kses_8php.html#a16c90f8f4b5152db3c88044526e28f59" title="wp_kses" alt="" coords="902,549,975,576"/><area shape="rect" id="node41" href="wp-includes_2plugin_8php.html#ae088c31761ae2cdcff6491755b1bdab6" title="current_filter" alt="" coords="892,600,985,627"/><area shape="rect" id="node43" href="formatting_8php.html#a42f495a436026ff2811d0d80caca937d" title="esc_url" alt="" coords="907,245,971,272"/><area shape="rect" id="node46" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="1108,955,1220,981"/><area shape="rect" id="node47" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="1099,853,1229,880"/><area shape="rect" id="node48" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="1328,651,1423,677"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a0070e44c50c79d7fd455a3b1ea6f13d9_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a0070e44c50c79d7fd455a3b1ea6f13d9_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a0070e44c50c79d7fd455a3b1ea6f13d9_icgraph" id="includes_2upgrade_8php_a0070e44c50c79d7fd455a3b1ea6f13d9_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a657edc069a4c61d359944a04164a7ee3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_290 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 2.9.</p>
<dl class="section since"><dt>Since</dt><dd>2.9.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01047">1047</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="load-scripts_8php_source.html#l00042">get_option()</a>, and <a class="el" href="option_8php_source.html#l00214">update_option()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                       {</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    global $wp_current_db_version;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 11958 ) {</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="comment">// Previously, setting depth to 1 would redundantly disable threading, but now 2 is the minimum depth to avoid confusion</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&#39;thread_comments_depth&#39;</span> ) == <span class="charliteral">&#39;1&#39;</span> ) {</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            <a class="code" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a>( <span class="stringliteral">&#39;thread_comments_depth&#39;</span>, 2 );</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            <a class="code" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a>( <span class="stringliteral">&#39;thread_comments&#39;</span>, 0 );</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        }</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    }</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;}</div>
<div class="ttc" id="option_8php_html_a7c47bc5d444687bebd583e6b5dfc04bc"><div class="ttname"><a href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a></div><div class="ttdeci">update_option($option, $newvalue)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00214">option.php:214</a></div></div>
<div class="ttc" id="load-scripts_8php_html_aaf1220eff85fdd291725eabf743b2ed3"><div class="ttname"><a href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a></div><div class="ttdeci">get_option()</div><div class="ttdef"><b>Definition:</b> <a href="load-scripts_8php_source.html#l00042">load-scripts.php:42</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a657edc069a4c61d359944a04164a7ee3_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a657edc069a4c61d359944a04164a7ee3_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a657edc069a4c61d359944a04164a7ee3_cgraph" id="includes_2upgrade_8php_a657edc069a4c61d359944a04164a7ee3_cgraph">
<area shape="rect" id="node2" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="1079,112,1162,138"/><area shape="rect" id="node3" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc" title="update_option" alt="" coords="149,1024,252,1050"/><area shape="rect" id="node4" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="433,480,567,522"/><area shape="rect" id="node6" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="1311,618,1401,645"/><area shape="rect" id="node10" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="1055,1417,1186,1444"/><area shape="rect" id="node12" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1303,1353,1409,1380"/><area shape="rect" id="node16" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="445,644,555,670"/><area shape="rect" id="node20" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="1081,922,1160,949"/><area shape="rect" id="node40" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="459,1277,541,1304"/><area shape="rect" id="node41" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="643,1176,749,1202"/><area shape="rect" id="node45" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="300,1024,385,1050"/><area shape="rect" id="node46" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="442,1176,558,1202"/><area shape="rect" id="node5" href="wp-includes_2functions_8php.html#a06d38a93c806c187fd21200c1baa9f53" title="wp_die" alt="" coords="871,61,934,88"/><area shape="rect" id="node7" href="formatting_8php.html#a77a1b666b7ca0e393239a9e1d1af72d3" title="esc_html" alt="" coords="659,416,733,442"/><area shape="rect" id="node8" href="formatting_8php.html#a745879b47424ac7b0d3b95a1edec8361" title="wp_check_invalid_utf8" alt="" coords="827,213,978,240"/><area shape="rect" id="node9" href="formatting_8php.html#ab9121c7a11ad101936875a65b233e126" title="_wp_specialchars" alt="" coords="840,453,965,480"/><area shape="rect" id="node14" href="formatting_8php.html#a4389f130de336d59e890c79b10a60beb" title="wp_specialchars_decode" alt="" coords="1037,416,1204,442"/><area shape="rect" id="node15" href="kses_8php.html#abc0e5ed7e9bad89cc998a35b48653fdb" title="wp_kses_normalize_entities" alt="" coords="1028,466,1213,493"/><area shape="rect" id="node11" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="1312,1417,1400,1444"/><area shape="rect" id="node13" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1302,1480,1410,1506"/><area shape="rect" id="node17" href="formatting_8php.html#a1a391a56d1c6c0e52239a553a0dbfb73" title="sanitize_email" alt="" coords="850,770,955,797"/><area shape="rect" id="node18" href="formatting_8php.html#aa394269ea323c88435820bb0a0f5912f" title="is_email" alt="" coords="661,821,731,848"/><area shape="rect" id="node22" href="wp-admin_2includes_2template_8php.html#ac54155d98db655b34d0c2c87d1e53c64" title="add_settings_error" alt="" coords="631,669,761,696"/><area shape="rect" id="node23" href="kses_8php.html#aa0817828c22f5e89ff755ae1ad1de60c" title="wp_kses_post" alt="" coords="643,517,749,544"/><area shape="rect" id="node30" href="kses_8php.html#a050aa6ac503f4f1a2eb655efe9b42dc6" title="wp_kses_data" alt="" coords="643,618,749,645"/><area shape="rect" id="node32" href="formatting_8php.html#ad9e809b6901d247527672e11ce5d7368" title="esc_url_raw" alt="" coords="651,466,741,493"/><area shape="rect" id="node39" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332" title="get_available_languages" alt="" coords="615,568,777,594"/><area shape="rect" id="node19" href="wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532" title="_deprecated_argument" alt="" coords="825,872,980,898"/><area shape="rect" id="node21" href="wp-includes_2plugin_8php.html#af891e88ab346a2da31111facfcf6b2cf" title="_wp_call_all_hook" alt="" coords="1293,922,1419,949"/><area shape="rect" id="node24" href="kses_8php.html#a16c90f8f4b5152db3c88044526e28f59" title="wp_kses" alt="" coords="866,529,939,556"/><area shape="rect" id="node25" href="wp-includes_2functions_8php.html#a410d6d8e60b99a2fbc62fe8116978711" title="wp_allowed_protocols" alt="" coords="1047,365,1195,392"/><area shape="rect" id="node26" href="kses_8php.html#a6a32ba00333b67cff42a76ec3762e5c3" title="wp_kses_no_null" alt="" coords="1726,221,1847,248"/><area shape="rect" id="node27" href="kses_8php.html#a3dec56a527f620ff81fa9dc188238b4f" title="wp_kses_js_entities" alt="" coords="1051,568,1190,594"/><area shape="rect" id="node28" href="kses_8php.html#a387ea2ab906936be7f094a0152f7886a" title="wp_kses_hook" alt="" coords="1067,618,1175,645"/><area shape="rect" id="node29" href="kses_8php.html#a1157570413297149e62e627d8e10c6b9" title="wp_kses_split" alt="" coords="1069,669,1173,696"/><area shape="rect" id="node31" href="wp-includes_2plugin_8php.html#ae088c31761ae2cdcff6491755b1bdab6" title="current_filter" alt="" coords="856,618,949,645"/><area shape="rect" id="node33" href="formatting_8php.html#a42f495a436026ff2811d0d80caca937d" title="esc_url" alt="" coords="871,340,935,366"/><area shape="rect" id="node34" href="formatting_8php.html#a07cee162d2dea8a7e788f6542534490a" title="_deep_replace" alt="" coords="1067,264,1174,290"/><area shape="rect" id="node35" href="kses_8php.html#a6164e160cf41fb1682f086b13ce434a0" title="wp_kses_bad_protocol" alt="" coords="1043,162,1198,189"/><area shape="rect" id="node36" href="kses_8php.html#ac1591c243a4c8272a934db51a9b53259" title="wp_kses_bad_protocol_once" alt="" coords="1261,162,1451,189"/><area shape="rect" id="node37" href="kses_8php.html#a6a97826fbe8f92352f4acc5143cdb0f7" title="wp_kses_bad_protocol\l_once2" alt="" coords="1499,155,1653,196"/><area shape="rect" id="node38" href="kses_8php.html#a6b7c56d4169bffd3e6943c570f4c4b94" title="wp_kses_decode_entities" alt="" coords="1701,162,1872,189"/><area shape="rect" id="node42" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="640,1378,752,1405"/><area shape="rect" id="node43" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="631,1226,761,1253"/><area shape="rect" id="node44" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="855,1176,950,1202"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a657edc069a4c61d359944a04164a7ee3_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a657edc069a4c61d359944a04164a7ee3_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a657edc069a4c61d359944a04164a7ee3_icgraph" id="includes_2upgrade_8php_a657edc069a4c61d359944a04164a7ee3_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5b4be04ded870faab3352e69cb616b04"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_300 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 3.0.</p>
<dl class="section since"><dt>Since</dt><dd>3.0.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01064">1064</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="options-permalink_8php_source.html#l00077">$prefix</a>, <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="option_8php_source.html#l00811">add_site_option()</a>, <a class="el" href="option_8php_source.html#l00753">get_site_option()</a>, <a class="el" href="wp-includes_2functions_8php_source.html#l03293">is_main_site()</a>, <a class="el" href="load_8php_source.html#l00677">is_multisite()</a>, <a class="el" href="formatting_8php_source.html#l02772">like_escape()</a>, and <a class="el" href="schema_8php_source.html#l00791">populate_roles_300()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                       {</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 15093 )</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        <a class="code" href="schema_8php.html#a1960b9961b3d8f38c5af16ae7317548d">populate_roles_300</a>();</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 14139 &amp;&amp; <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() &amp;&amp; <a class="code" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a>() &amp;&amp; ! defined( <span class="stringliteral">&#39;MULTISITE&#39;</span> ) &amp;&amp; <a class="code" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa">get_site_option</a>( <span class="stringliteral">&#39;siteurl&#39;</span> ) === <span class="keyword">false</span> )</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <a class="code" href="option_8php.html#a2c2c039acbd1f0ddc4063fbcfb11b3a2">add_site_option</a>( <span class="stringliteral">&#39;siteurl&#39;</span>, <span class="stringliteral">&#39;&#39;</span> );</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="comment">// 3.0 screen options key name changes.</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a>() &amp;&amp; !defined(<span class="stringliteral">&#39;DO_NOT_UPGRADE_GLOBAL_TABLES&#39;</span>) ) {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <a class="code" href="options-permalink_8php.html#a09e8cf95b9d29955a0bfabca9b420edc">$prefix</a> = <a class="code" href="formatting_8php.html#ae6dd2fda749296bff9887b354def70b9">like_escape</a>($wpdb-&gt;base_prefix);</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;DELETE FROM $wpdb-&gt;usermeta WHERE meta_key LIKE &#39;{$prefix}%meta-box-hidden%&#39; OR meta_key LIKE &#39;{$prefix}%closedpostboxes%&#39; OR meta_key LIKE &#39;{$prefix}%manage-%-columns-hidden%&#39; OR meta_key LIKE &#39;{$prefix}%meta-box-order%&#39; OR meta_key LIKE &#39;{$prefix}%metaboxorder%&#39; OR meta_key LIKE &#39;{$prefix}%screen_layout%&#39;</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="stringliteral">                     OR meta_key = &#39;manageedittagscolumnshidden&#39; OR meta_key=&#39;managecategoriescolumnshidden&#39; OR meta_key = &#39;manageedit-tagscolumnshidden&#39; OR meta_key = &#39;manageeditcolumnshidden&#39; OR meta_key = &#39;categories_per_page&#39; OR meta_key = &#39;edit_tags_per_page&#39;&quot;</span> );</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    }</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;}</div>
<div class="ttc" id="option_8php_html_a2a460377f0ab22fe938a0937c8fb17fa"><div class="ttname"><a href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa">get_site_option</a></div><div class="ttdeci">get_site_option($option, $default=false, $use_cache=true)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00753">option.php:753</a></div></div>
<div class="ttc" id="formatting_8php_html_ae6dd2fda749296bff9887b354def70b9"><div class="ttname"><a href="formatting_8php.html#ae6dd2fda749296bff9887b354def70b9">like_escape</a></div><div class="ttdeci">like_escape($text)</div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l02772">formatting.php:2772</a></div></div>
<div class="ttc" id="options-permalink_8php_html_a09e8cf95b9d29955a0bfabca9b420edc"><div class="ttname"><a href="options-permalink_8php.html#a09e8cf95b9d29955a0bfabca9b420edc">$prefix</a></div><div class="ttdeci">$prefix</div><div class="ttdef"><b>Definition:</b> <a href="options-permalink_8php_source.html#l00077">options-permalink.php:77</a></div></div>
<div class="ttc" id="option_8php_html_a2c2c039acbd1f0ddc4063fbcfb11b3a2"><div class="ttname"><a href="option_8php.html#a2c2c039acbd1f0ddc4063fbcfb11b3a2">add_site_option</a></div><div class="ttdeci">add_site_option($option, $value)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00811">option.php:811</a></div></div>
<div class="ttc" id="wp-includes_2functions_8php_html_af56ce4c5410aedf5dda37e798124b74a"><div class="ttname"><a href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a></div><div class="ttdeci">is_main_site($site_id=null)</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2functions_8php_source.html#l03293">functions.php:3293</a></div></div>
<div class="ttc" id="schema_8php_html_a1960b9961b3d8f38c5af16ae7317548d"><div class="ttname"><a href="schema_8php.html#a1960b9961b3d8f38c5af16ae7317548d">populate_roles_300</a></div><div class="ttdeci">populate_roles_300()</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00791">schema.php:791</a></div></div>
<div class="ttc" id="load_8php_html_a72e5386fcd7a5ce7526d208d0b03a0af"><div class="ttname"><a href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a></div><div class="ttdeci">is_multisite()</div><div class="ttdef"><b>Definition:</b> <a href="load_8php_source.html#l00677">load.php:677</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a5b4be04ded870faab3352e69cb616b04_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a5b4be04ded870faab3352e69cb616b04_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a5b4be04ded870faab3352e69cb616b04_cgraph" id="includes_2upgrade_8php_a5b4be04ded870faab3352e69cb616b04_cgraph">
<area shape="rect" id="node2" href="option_8php.html#a2c2c039acbd1f0ddc4063fbcfb11b3a2" title="add_site_option" alt="" coords="160,1272,273,1299"/><area shape="rect" id="node11" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="1393,1627,1481,1653"/><area shape="rect" id="node45" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa" title="get_site_option" alt="" coords="722,1399,833,1425"/><area shape="rect" id="node46" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a" title="is_main_site" alt="" coords="169,1728,264,1755"/><area shape="rect" id="node48" href="formatting_8php.html#ae6dd2fda749296bff9887b354def70b9" title="like_escape" alt="" coords="171,1829,262,1856"/><area shape="rect" id="node49" href="schema_8php.html#a1960b9961b3d8f38c5af16ae7317548d" title="populate_roles_300" alt="" coords="149,1880,284,1907"/><area shape="rect" id="node3" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="515,801,648,842"/><area shape="rect" id="node5" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="1392,613,1483,640"/><area shape="rect" id="node12" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1385,1272,1490,1299"/><area shape="rect" id="node16" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="357,1069,442,1096"/><area shape="rect" id="node18" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="1163,917,1241,944"/><area shape="rect" id="node20" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="527,543,636,569"/><area shape="rect" id="node40" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="1149,1323,1255,1349"/><area shape="rect" id="node44" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="523,1424,639,1451"/><area shape="rect" id="node4" href="wp-includes_2functions_8php.html#a06d38a93c806c187fd21200c1baa9f53" title="wp_die" alt="" coords="953,816,1015,843"/><area shape="rect" id="node6" href="formatting_8php.html#a77a1b666b7ca0e393239a9e1d1af72d3" title="esc_html" alt="" coords="740,669,815,696"/><area shape="rect" id="node7" href="formatting_8php.html#a745879b47424ac7b0d3b95a1edec8361" title="wp_check_invalid_utf8" alt="" coords="909,613,1059,640"/><area shape="rect" id="node9" href="formatting_8php.html#ab9121c7a11ad101936875a65b233e126" title="_wp_specialchars" alt="" coords="921,715,1047,741"/><area shape="rect" id="node8" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="1161,613,1243,640"/><area shape="rect" id="node10" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="1137,1171,1267,1197"/><area shape="rect" id="node14" href="formatting_8php.html#a4389f130de336d59e890c79b10a60beb" title="wp_specialchars_decode" alt="" coords="1119,715,1285,741"/><area shape="rect" id="node15" href="kses_8php.html#abc0e5ed7e9bad89cc998a35b48653fdb" title="wp_kses_normalize_entities" alt="" coords="1109,360,1295,387"/><area shape="rect" id="node13" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1383,1120,1491,1147"/><area shape="rect" id="node17" href="wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532" title="_deprecated_argument" alt="" coords="907,867,1061,893"/><area shape="rect" id="node39" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="943,1171,1025,1197"/><area shape="rect" id="node19" href="wp-includes_2plugin_8php.html#af891e88ab346a2da31111facfcf6b2cf" title="_wp_call_all_hook" alt="" coords="1374,917,1501,944"/><area shape="rect" id="node21" href="formatting_8php.html#a1a391a56d1c6c0e52239a553a0dbfb73" title="sanitize_email" alt="" coords="931,512,1037,539"/><area shape="rect" id="node22" href="formatting_8php.html#aa394269ea323c88435820bb0a0f5912f" title="is_email" alt="" coords="742,765,813,792"/><area shape="rect" id="node23" href="wp-admin_2includes_2template_8php.html#ac54155d98db655b34d0c2c87d1e53c64" title="add_settings_error" alt="" coords="713,416,842,443"/><area shape="rect" id="node24" href="kses_8php.html#aa0817828c22f5e89ff755ae1ad1de60c" title="wp_kses_post" alt="" coords="725,315,830,341"/><area shape="rect" id="node31" href="kses_8php.html#a050aa6ac503f4f1a2eb655efe9b42dc6" title="wp_kses_data" alt="" coords="725,467,830,493"/><area shape="rect" id="node33" href="formatting_8php.html#ad9e809b6901d247527672e11ce5d7368" title="esc_url_raw" alt="" coords="732,233,823,260"/><area shape="rect" id="node38" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332" title="get_available_languages" alt="" coords="696,568,859,595"/><area shape="rect" id="node25" href="kses_8php.html#a16c90f8f4b5152db3c88044526e28f59" title="wp_kses" alt="" coords="947,321,1021,348"/><area shape="rect" id="node26" href="wp-includes_2functions_8php.html#a410d6d8e60b99a2fbc62fe8116978711" title="wp_allowed_protocols" alt="" coords="1128,259,1276,285"/><area shape="rect" id="node27" href="kses_8php.html#a6a32ba00333b67cff42a76ec3762e5c3" title="wp_kses_no_null" alt="" coords="1377,132,1498,159"/><area shape="rect" id="node28" href="kses_8php.html#a3dec56a527f620ff81fa9dc188238b4f" title="wp_kses_js_entities" alt="" coords="1133,309,1271,336"/><area shape="rect" id="node29" href="kses_8php.html#a387ea2ab906936be7f094a0152f7886a" title="wp_kses_hook" alt="" coords="1148,461,1256,488"/><area shape="rect" id="node30" href="kses_8php.html#a1157570413297149e62e627d8e10c6b9" title="wp_kses_split" alt="" coords="1150,411,1254,437"/><area shape="rect" id="node32" href="wp-includes_2plugin_8php.html#ae088c31761ae2cdcff6491755b1bdab6" title="current_filter" alt="" coords="937,461,1031,488"/><area shape="rect" id="node34" href="formatting_8php.html#a42f495a436026ff2811d0d80caca937d" title="esc_url" alt="" coords="952,183,1016,209"/><area shape="rect" id="node35" href="formatting_8php.html#a07cee162d2dea8a7e788f6542534490a" title="_deep_replace" alt="" coords="1149,107,1255,133"/><area shape="rect" id="node36" href="kses_8php.html#a6164e160cf41fb1682f086b13ce434a0" title="wp_kses_bad_protocol" alt="" coords="1125,5,1279,32"/><area shape="rect" id="node37" href="kses_8php.html#ac1591c243a4c8272a934db51a9b53259" title="wp_kses_bad_protocol_once" alt="" coords="1343,5,1532,32"/><area shape="rect" id="node41" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="1146,1221,1258,1248"/><area shape="rect" id="node42" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="1137,1475,1267,1501"/><area shape="rect" id="node43" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="1390,1500,1485,1527"/><area shape="rect" id="node47" href="load_8php.html#a49b99067b44a28b2df04dcbd50569624" title="get_current_blog_id" alt="" coords="332,1728,467,1755"/><area shape="rect" id="node50" href="capabilities_8php.html#a41bea05b81b5374112aab194c590dd80" title="get_role" alt="" coords="365,1880,433,1907"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a5b4be04ded870faab3352e69cb616b04_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a5b4be04ded870faab3352e69cb616b04_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a5b4be04ded870faab3352e69cb616b04_icgraph" id="includes_2upgrade_8php_a5b4be04ded870faab3352e69cb616b04_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a308cd978af2b74dfdf5ebfac83df9b3e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_330 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 3.3.</p>
<dl class="section since"><dt>Since</dt><dd>3.3.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01087">1087</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="menu_8php_source.html#l00054">$i</a>, <a class="el" href="async-upload_8php_source.html#l00082">$id</a>, <a class="el" href="options_8php_source.html#l00208">$name</a>, <a class="el" href="wp-admin_2widgets_8php_source.html#l00076">$sidebars_widgets</a>, <a class="el" href="wp-includes_2widgets_8php_source.html#l00353">$wp_registered_widgets</a>, <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="admin_8php_source.html#l00044">elseif</a>, <a class="el" href="load-scripts_8php_source.html#l00042">get_option()</a>, <a class="el" href="wp-includes_2functions_8php_source.html#l03293">is_main_site()</a>, <a class="el" href="wp-includes_2widgets_8php_source.html#l01167">retrieve_widgets()</a>, <a class="el" href="formatting_8php_source.html#l00951">sanitize_title()</a>, and <a class="el" href="option_8php_source.html#l00214">update_option()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                       {</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>, <a class="code" href="wp-includes_2widgets_8php.html#a24c1fc3a7e94da5ac9b3846b6d93f2a7">$wp_registered_widgets</a>, <a class="code" href="wp-admin_2widgets_8php.html#a233259fe7379e46b62e0a6d786f8f921">$sidebars_widgets</a>;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 19061 &amp;&amp; <a class="code" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a>() &amp;&amp; ! defined( <span class="stringliteral">&#39;DO_NOT_UPGRADE_GLOBAL_TABLES&#39;</span> ) ) {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;DELETE FROM $wpdb-&gt;usermeta WHERE meta_key IN (&#39;show_admin_bar_admin&#39;, &#39;plugins_last_view&#39;)&quot;</span> );</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    }</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &gt;= 11548 )</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    $sidebars_widgets = <a class="code" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&#39;sidebars_widgets&#39;</span>, array() );</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    $_sidebars_widgets = array();</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keywordflow">if</span> ( isset($sidebars_widgets[<span class="stringliteral">&#39;wp_inactive_widgets&#39;</span>]) || empty($sidebars_widgets) )</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        $sidebars_widgets[<span class="stringliteral">&#39;array_version&#39;</span>] = 3;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( !isset($sidebars_widgets[<span class="stringliteral">&#39;array_version&#39;</span>]) )</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        $sidebars_widgets[&#39;array_version&#39;] = 1;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <a class="code" href="namespaceswitch.html">switch</a> ( $sidebars_widgets[&#39;array_version&#39;] ) {</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        <span class="keywordflow">case</span> 1 :</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            <span class="keywordflow">foreach</span> ( (array) $sidebars_widgets as $index =&gt; $sidebar )</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            <span class="keywordflow">if</span> ( is_array($sidebar) )</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            <span class="keywordflow">foreach</span> ( (array) $sidebar as <a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> =&gt; <a class="code" href="options_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> ) {</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = strtolower(<a class="code" href="options_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>);</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                <span class="keywordflow">if</span> ( isset($wp_registered_widgets[<a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a>]) ) {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                    $_sidebars_widgets[$index][<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] = <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a>;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                }</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                $id = <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>(<a class="code" href="options_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>);</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                <span class="keywordflow">if</span> ( isset($wp_registered_widgets[$id]) ) {</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                    $_sidebars_widgets[$index][<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] = <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a>;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                }</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                $found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                <span class="keywordflow">foreach</span> ( $wp_registered_widgets as $widget_id =&gt; $widget ) {</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                    <span class="keywordflow">if</span> ( strtolower($widget[<span class="stringliteral">&#39;name&#39;</span>]) == strtolower(<a class="code" href="options_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>) ) {</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                        $_sidebars_widgets[$index][<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] = $widget[<span class="stringliteral">&#39;id&#39;</span>];</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                        $found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                    } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>($widget[<span class="stringliteral">&#39;name&#39;</span>]) == <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>(<a class="code" href="options_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>) ) {</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                        $_sidebars_widgets[$index][<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] = $widget[<span class="stringliteral">&#39;id&#39;</span>];</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                        $found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                    }</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                }</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                <span class="keywordflow">if</span> ( $found )</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                unset($_sidebars_widgets[$index][<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>]);</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;            }</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            $_sidebars_widgets[<span class="stringliteral">&#39;array_version&#39;</span>] = 2;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;            $sidebars_widgets = $_sidebars_widgets;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;            unset($_sidebars_widgets);</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <span class="keywordflow">case</span> 2 :</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            $sidebars_widgets = <a class="code" href="wp-includes_2widgets_8php.html#a0696ef1f645f9f4ab0b6b67023d21bba">retrieve_widgets</a>();</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            $sidebars_widgets[<span class="stringliteral">&#39;array_version&#39;</span>] = 3;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;            <a class="code" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a>( <span class="stringliteral">&#39;sidebars_widgets&#39;</span>, $sidebars_widgets );</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    }</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;}</div>
<div class="ttc" id="option_8php_html_a7c47bc5d444687bebd583e6b5dfc04bc"><div class="ttname"><a href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a></div><div class="ttdeci">update_option($option, $newvalue)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00214">option.php:214</a></div></div>
<div class="ttc" id="wp-admin_2widgets_8php_html_a233259fe7379e46b62e0a6d786f8f921"><div class="ttname"><a href="wp-admin_2widgets_8php.html#a233259fe7379e46b62e0a6d786f8f921">$sidebars_widgets</a></div><div class="ttdeci">if(!current_theme_supports( 'widgets')) $sidebars_widgets</div><div class="ttdef"><b>Definition:</b> <a href="wp-admin_2widgets_8php_source.html#l00076">widgets.php:76</a></div></div>
<div class="ttc" id="menu_8php_html_a83018d9153d17d91fbcf3bc10158d34f"><div class="ttname"><a href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a></div><div class="ttdeci">$i</div><div class="ttdef"><b>Definition:</b> <a href="menu_8php_source.html#l00054">menu.php:54</a></div></div>
<div class="ttc" id="load-scripts_8php_html_aaf1220eff85fdd291725eabf743b2ed3"><div class="ttname"><a href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a></div><div class="ttdeci">get_option()</div><div class="ttdef"><b>Definition:</b> <a href="load-scripts_8php_source.html#l00042">load-scripts.php:42</a></div></div>
<div class="ttc" id="admin_8php_html_af1c9ecf26c0cfd247c0760dd4b594a6d"><div class="ttname"><a href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a></div><div class="ttdeci">if(get_option('db_upgraded')) elseif(get_option('db_version')!=$wp_db_version &amp;&amp;empty($_POST))</div><div class="ttdef"><b>Definition:</b> <a href="admin_8php_source.html#l00044">admin.php:44</a></div></div>
<div class="ttc" id="async-upload_8php_html_ad69de186eb69f332f105ae157136192e"><div class="ttname"><a href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a></div><div class="ttdeci">if(isset($_REQUEST['post_id'])) $id</div><div class="ttdef"><b>Definition:</b> <a href="async-upload_8php_source.html#l00082">async-upload.php:82</a></div></div>
<div class="ttc" id="wp-includes_2functions_8php_html_af56ce4c5410aedf5dda37e798124b74a"><div class="ttname"><a href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a></div><div class="ttdeci">is_main_site($site_id=null)</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2functions_8php_source.html#l03293">functions.php:3293</a></div></div>
<div class="ttc" id="namespaceswitch_html"><div class="ttname"><a href="namespaceswitch.html">switch</a></div></div>
<div class="ttc" id="formatting_8php_html_ac6495c47468fb816d78bb2d2b326d808"><div class="ttname"><a href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a></div><div class="ttdeci">sanitize_title($title, $fallback_title= '', $context= 'save')</div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l00951">formatting.php:951</a></div></div>
<div class="ttc" id="wp-includes_2widgets_8php_html_a0696ef1f645f9f4ab0b6b67023d21bba"><div class="ttname"><a href="wp-includes_2widgets_8php.html#a0696ef1f645f9f4ab0b6b67023d21bba">retrieve_widgets</a></div><div class="ttdeci">retrieve_widgets($theme_changed=false)</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2widgets_8php_source.html#l01167">widgets.php:1167</a></div></div>
<div class="ttc" id="wp-includes_2widgets_8php_html_a24c1fc3a7e94da5ac9b3846b6d93f2a7"><div class="ttname"><a href="wp-includes_2widgets_8php.html#a24c1fc3a7e94da5ac9b3846b6d93f2a7">$wp_registered_widgets</a></div><div class="ttdeci">global $wp_registered_widgets</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2widgets_8php_source.html#l00353">widgets.php:353</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
<div class="ttc" id="options_8php_html_ab2fc40d43824ea3e1ce5d86dee0d763b"><div class="ttname"><a href="options_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a></div><div class="ttdeci">$name</div><div class="ttdef"><b>Definition:</b> <a href="options_8php_source.html#l00208">options.php:208</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a308cd978af2b74dfdf5ebfac83df9b3e_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a308cd978af2b74dfdf5ebfac83df9b3e_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a308cd978af2b74dfdf5ebfac83df9b3e_cgraph" id="includes_2upgrade_8php_a308cd978af2b74dfdf5ebfac83df9b3e_cgraph">
<area shape="rect" id="node2" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="1365,296,1448,323"/><area shape="rect" id="node3" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a" title="is_main_site" alt="" coords="159,1917,254,1944"/><area shape="rect" id="node6" href="wp-includes_2widgets_8php.html#a0696ef1f645f9f4ab0b6b67023d21bba" title="retrieve_widgets" alt="" coords="149,616,264,643"/><area shape="rect" id="node26" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc" title="update_option" alt="" coords="739,853,841,880"/><area shape="rect" id="node46" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808" title="sanitize_title" alt="" coords="334,1765,429,1792"/><area shape="rect" id="node4" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="1569,1791,1657,1817"/><area shape="rect" id="node5" href="load_8php.html#a49b99067b44a28b2df04dcbd50569624" title="get_current_blog_id" alt="" coords="314,1968,449,1995"/><area shape="rect" id="node7" href="wp-includes_2theme_8php.html#a4c3486e66730d9c0f77be28199f63069" title="get_theme_mod" alt="" coords="324,245,439,272"/><area shape="rect" id="node43" href="wp-includes_2theme_8php.html#ad614e6c66f3f9623fef2bf3d738dcb27" title="remove_theme_mod" alt="" coords="312,549,451,576"/><area shape="rect" id="node45" href="wp-includes_2widgets_8php.html#a686371d9e504afdb48e88618d4b7a872" title="wp_set_sidebars_widgets" alt="" coords="499,764,669,791"/><area shape="rect" id="node8" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="1739,853,1829,880"/><area shape="rect" id="node9" href="wp-includes_2theme_8php.html#a20e8d2b5ee7de6a42990d6e4cdc3c592" title="get_stylesheet_directory_uri" alt="" coords="911,245,1096,272"/><area shape="rect" id="node12" href="wp-includes_2theme_8php.html#a39342df15893fdd8e811652c9a194123" title="get_template_directory_uri" alt="" coords="916,169,1091,196"/><area shape="rect" id="node14" href="wp-includes_2theme_8php.html#ab752fdfaa2a6941bf399b239522b823d" title="get_theme_mods" alt="" coords="523,499,645,525"/><area shape="rect" id="node10" href="wp-includes_2theme_8php.html#a6d9dd71b2ef87985d6a908cdcbf99f9a" title="get_stylesheet" alt="" coords="1157,448,1264,475"/><area shape="rect" id="node11" href="wp-includes_2theme_8php.html#a3774c14dce86f8da773097f15d36235e" title="get_theme_root_uri" alt="" coords="1144,195,1277,221"/><area shape="rect" id="node13" href="wp-includes_2theme_8php.html#ae447eda8b2f98e3794afd123d8a7b2dc" title="get_template" alt="" coords="1162,144,1259,171"/><area shape="rect" id="node15" href="option_8php.html#a44451bc2bc382b2c24f4baeef80a3714" title="delete_option" alt="" coords="954,803,1053,829"/><area shape="rect" id="node25" href="load-scripts_8php.html#a0b327581800dba50ad70720e23ae2ed2" title="is_admin" alt="" coords="753,448,827,475"/><area shape="rect" id="node42" href="wp-includes_2theme_8php.html#a930e87e99fca734cbd2913800e7bcf4d" title="wp_get_theme" alt="" coords="950,448,1057,475"/><area shape="rect" id="node16" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="1144,803,1277,845"/><area shape="rect" id="node19" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="1745,448,1823,475"/><area shape="rect" id="node21" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="1341,1360,1472,1387"/><area shape="rect" id="node24" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="1354,1208,1459,1235"/><area shape="rect" id="node17" href="wp-includes_2functions_8php.html#a06d38a93c806c187fd21200c1baa9f53" title="wp_die" alt="" coords="1582,1107,1645,1133"/><area shape="rect" id="node18" href="formatting_8php.html#a77a1b666b7ca0e393239a9e1d1af72d3" title="esc_html" alt="" coords="1369,955,1444,981"/><area shape="rect" id="node20" href="wp-includes_2plugin_8php.html#af891e88ab346a2da31111facfcf6b2cf" title="_wp_call_all_hook" alt="" coords="1877,448,2004,475"/><area shape="rect" id="node22" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1561,1360,1666,1387"/><area shape="rect" id="node23" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1559,1461,1667,1488"/><area shape="rect" id="node27" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="1156,752,1265,779"/><area shape="rect" id="node36" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="1169,1477,1252,1504"/><area shape="rect" id="node40" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="961,1173,1046,1200"/><area shape="rect" id="node41" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="1153,1123,1269,1149"/><area shape="rect" id="node28" href="formatting_8php.html#a1a391a56d1c6c0e52239a553a0dbfb73" title="sanitize_email" alt="" coords="1561,1005,1666,1032"/><area shape="rect" id="node29" href="formatting_8php.html#aa394269ea323c88435820bb0a0f5912f" title="is_email" alt="" coords="1371,853,1442,880"/><area shape="rect" id="node31" href="wp-admin_2includes_2template_8php.html#ac54155d98db655b34d0c2c87d1e53c64" title="add_settings_error" alt="" coords="1342,549,1471,576"/><area shape="rect" id="node32" href="kses_8php.html#aa0817828c22f5e89ff755ae1ad1de60c" title="wp_kses_post" alt="" coords="1354,600,1459,627"/><area shape="rect" id="node33" href="kses_8php.html#a050aa6ac503f4f1a2eb655efe9b42dc6" title="wp_kses_data" alt="" coords="1354,651,1459,677"/><area shape="rect" id="node34" href="formatting_8php.html#ad9e809b6901d247527672e11ce5d7368" title="esc_url_raw" alt="" coords="1361,701,1452,728"/><area shape="rect" id="node35" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332" title="get_available_languages" alt="" coords="1325,752,1488,779"/><area shape="rect" id="node30" href="wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532" title="_deprecated_argument" alt="" coords="1536,904,1691,931"/><area shape="rect" id="node37" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="1351,1461,1463,1488"/><area shape="rect" id="node38" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="1341,1563,1472,1589"/><area shape="rect" id="node39" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="1566,1233,1661,1260"/><area shape="rect" id="node44" href="wp-includes_2theme_8php.html#a988b84695fdd2db26389f63d2017d6bf" title="remove_theme_mods" alt="" coords="717,549,863,576"/><area shape="rect" id="node47" href="formatting_8php.html#a05e464b55ec2c8b334abed9864d014e9" title="remove_accents" alt="" coords="526,1816,642,1843"/><area shape="rect" id="node48" href="formatting_8php.html#a618ba7bdc2cf2790af2e9fa968f03615" title="seems_utf8" alt="" coords="745,1816,835,1843"/><area shape="rect" id="node49" href="l10n_8php.html#a6ec9fd4baced85768ba16386e9e1b339" title="get_locale" alt="" coords="749,1867,831,1893"/><area shape="rect" id="node50" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa" title="get_site_option" alt="" coords="948,1664,1059,1691"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a308cd978af2b74dfdf5ebfac83df9b3e_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a308cd978af2b74dfdf5ebfac83df9b3e_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a308cd978af2b74dfdf5ebfac83df9b3e_icgraph" id="includes_2upgrade_8php_a308cd978af2b74dfdf5ebfac83df9b3e_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a718607ec4fb72257807ec66ae24b503e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_340 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 3.4.</p>
<dl class="section since"><dt>Since</dt><dd>3.4.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01156">1156</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="option_8php_source.html#l00292">add_option()</a>, <a class="el" href="option_8php_source.html#l00359">delete_option()</a>, <a class="el" href="load-scripts_8php_source.html#l00042">get_option()</a>, <a class="el" href="wp-includes_2functions_8php_source.html#l03293">is_main_site()</a>, and <a class="el" href="edit-form-advanced_8php_source.html#l00139">null</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                       {</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 19798 ) {</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        $wpdb-&gt;hide_errors();</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;options DROP COLUMN blog_id&quot;</span> );</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        $wpdb-&gt;show_errors();</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    }</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 19799 ) {</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        $wpdb-&gt;hide_errors();</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;comments DROP INDEX comment_approved&quot;</span>);</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        $wpdb-&gt;show_errors();</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    }</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 20022 &amp;&amp; <a class="code" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a>() &amp;&amp; ! defined( <span class="stringliteral">&#39;DO_NOT_UPGRADE_GLOBAL_TABLES&#39;</span> ) ) {</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;DELETE FROM $wpdb-&gt;usermeta WHERE meta_key = &#39;themes_last_view&#39;&quot;</span> );</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    }</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 20080 ) {</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;yes&#39;</span> == $wpdb-&gt;get_var( <span class="stringliteral">&quot;SELECT autoload FROM $wpdb-&gt;options WHERE option_name = &#39;uninstall_plugins&#39;&quot;</span> ) ) {</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;            $uninstall_plugins = <a class="code" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&#39;uninstall_plugins&#39;</span> );</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;            <a class="code" href="option_8php.html#a44451bc2bc382b2c24f4baeef80a3714">delete_option</a>( <span class="stringliteral">&#39;uninstall_plugins&#39;</span> );</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            <a class="code" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494">add_option</a>( <span class="stringliteral">&#39;uninstall_plugins&#39;</span>, $uninstall_plugins, <a class="code" href="edit-form-advanced_8php.html#a46b3622ccc6d393dfd97e355b7bd0bd6">null</a>, <span class="stringliteral">&#39;no&#39;</span> );</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        }</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    }</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;}</div>
<div class="ttc" id="option_8php_html_afacc3facc45e9b1cf03120755d40f494"><div class="ttname"><a href="option_8php.html#afacc3facc45e9b1cf03120755d40f494">add_option</a></div><div class="ttdeci">add_option($option, $value= '', $deprecated= '', $autoload= 'yes')</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00292">option.php:292</a></div></div>
<div class="ttc" id="load-scripts_8php_html_aaf1220eff85fdd291725eabf743b2ed3"><div class="ttname"><a href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a></div><div class="ttdeci">get_option()</div><div class="ttdef"><b>Definition:</b> <a href="load-scripts_8php_source.html#l00042">load-scripts.php:42</a></div></div>
<div class="ttc" id="wp-includes_2functions_8php_html_af56ce4c5410aedf5dda37e798124b74a"><div class="ttname"><a href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a></div><div class="ttdeci">is_main_site($site_id=null)</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2functions_8php_source.html#l03293">functions.php:3293</a></div></div>
<div class="ttc" id="edit-form-advanced_8php_html_a46b3622ccc6d393dfd97e355b7bd0bd6"><div class="ttname"><a href="edit-form-advanced_8php.html#a46b3622ccc6d393dfd97e355b7bd0bd6">null</a></div><div class="ttdeci">if(current_theme_supports( 'post-formats')&amp;&amp;post_type_supports($post_type, 'post-formats')) add_meta_box( 'formatdiv' null</div><div class="ttdef"><b>Definition:</b> <a href="edit-form-advanced_8php_source.html#l00139">edit-form-advanced.php:139</a></div></div>
<div class="ttc" id="option_8php_html_a44451bc2bc382b2c24f4baeef80a3714"><div class="ttname"><a href="option_8php.html#a44451bc2bc382b2c24f4baeef80a3714">delete_option</a></div><div class="ttdeci">delete_option($option)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00359">option.php:359</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a718607ec4fb72257807ec66ae24b503e_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a718607ec4fb72257807ec66ae24b503e_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a718607ec4fb72257807ec66ae24b503e_cgraph" id="includes_2upgrade_8php_a718607ec4fb72257807ec66ae24b503e_cgraph">
<area shape="rect" id="node2" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="156,1062,241,1089"/><area shape="rect" id="node11" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="943,570,1026,597"/><area shape="rect" id="node46" href="option_8php.html#a44451bc2bc382b2c24f4baeef80a3714" title="delete_option" alt="" coords="149,1355,248,1382"/><area shape="rect" id="node48" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a" title="is_main_site" alt="" coords="151,1583,246,1610"/><area shape="rect" id="node3" href="wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532" title="_deprecated_argument" alt="" coords="689,823,844,850"/><area shape="rect" id="node4" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="945,1431,1024,1458"/><area shape="rect" id="node7" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="297,875,430,916"/><area shape="rect" id="node13" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="919,1229,1050,1255"/><area shape="rect" id="node15" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1167,1127,1273,1154"/><area shape="rect" id="node19" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="309,519,418,546"/><area shape="rect" id="node40" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="322,1102,405,1129"/><area shape="rect" id="node41" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="507,1279,613,1306"/><area shape="rect" id="node45" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="305,1022,421,1049"/><area shape="rect" id="node6" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="1175,545,1265,571"/><area shape="rect" id="node5" href="wp-includes_2plugin_8php.html#af891e88ab346a2da31111facfcf6b2cf" title="_wp_call_all_hook" alt="" coords="1157,1431,1283,1458"/><area shape="rect" id="node8" href="wp-includes_2functions_8php.html#a06d38a93c806c187fd21200c1baa9f53" title="wp_die" alt="" coords="735,874,798,901"/><area shape="rect" id="node9" href="formatting_8php.html#a77a1b666b7ca0e393239a9e1d1af72d3" title="esc_html" alt="" coords="523,671,597,698"/><area shape="rect" id="node10" href="formatting_8php.html#a745879b47424ac7b0d3b95a1edec8361" title="wp_check_invalid_utf8" alt="" coords="691,570,842,597"/><area shape="rect" id="node12" href="formatting_8php.html#ab9121c7a11ad101936875a65b233e126" title="_wp_specialchars" alt="" coords="704,671,829,698"/><area shape="rect" id="node17" href="formatting_8php.html#a4389f130de336d59e890c79b10a60beb" title="wp_specialchars_decode" alt="" coords="901,671,1068,698"/><area shape="rect" id="node18" href="kses_8php.html#abc0e5ed7e9bad89cc998a35b48653fdb" title="wp_kses_normalize_entities" alt="" coords="892,519,1077,546"/><area shape="rect" id="node14" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="1176,1330,1264,1357"/><area shape="rect" id="node16" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="1166,1203,1274,1230"/><area shape="rect" id="node20" href="formatting_8php.html#a1a391a56d1c6c0e52239a553a0dbfb73" title="sanitize_email" alt="" coords="714,165,819,191"/><area shape="rect" id="node21" href="formatting_8php.html#aa394269ea323c88435820bb0a0f5912f" title="is_email" alt="" coords="525,773,595,799"/><area shape="rect" id="node22" href="wp-admin_2includes_2template_8php.html#ac54155d98db655b34d0c2c87d1e53c64" title="add_settings_error" alt="" coords="495,621,625,647"/><area shape="rect" id="node23" href="kses_8php.html#aa0817828c22f5e89ff755ae1ad1de60c" title="wp_kses_post" alt="" coords="507,367,613,394"/><area shape="rect" id="node30" href="kses_8php.html#a050aa6ac503f4f1a2eb655efe9b42dc6" title="wp_kses_data" alt="" coords="507,418,613,445"/><area shape="rect" id="node32" href="formatting_8php.html#ad9e809b6901d247527672e11ce5d7368" title="esc_url_raw" alt="" coords="515,305,605,331"/><area shape="rect" id="node39" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332" title="get_available_languages" alt="" coords="479,570,641,597"/><area shape="rect" id="node24" href="kses_8php.html#a16c90f8f4b5152db3c88044526e28f59" title="wp_kses" alt="" coords="730,367,803,394"/><area shape="rect" id="node25" href="wp-includes_2functions_8php.html#a410d6d8e60b99a2fbc62fe8116978711" title="wp_allowed_protocols" alt="" coords="911,317,1059,343"/><area shape="rect" id="node26" href="kses_8php.html#a6a32ba00333b67cff42a76ec3762e5c3" title="wp_kses_no_null" alt="" coords="1590,71,1711,98"/><area shape="rect" id="node27" href="kses_8php.html#a3dec56a527f620ff81fa9dc188238b4f" title="wp_kses_js_entities" alt="" coords="915,418,1054,445"/><area shape="rect" id="node28" href="kses_8php.html#a387ea2ab906936be7f094a0152f7886a" title="wp_kses_hook" alt="" coords="931,469,1039,495"/><area shape="rect" id="node29" href="kses_8php.html#a1157570413297149e62e627d8e10c6b9" title="wp_kses_split" alt="" coords="933,367,1037,394"/><area shape="rect" id="node31" href="wp-includes_2plugin_8php.html#ae088c31761ae2cdcff6491755b1bdab6" title="current_filter" alt="" coords="720,418,813,445"/><area shape="rect" id="node33" href="formatting_8php.html#a42f495a436026ff2811d0d80caca937d" title="esc_url" alt="" coords="735,291,799,318"/><area shape="rect" id="node34" href="formatting_8php.html#a07cee162d2dea8a7e788f6542534490a" title="_deep_replace" alt="" coords="931,165,1038,191"/><area shape="rect" id="node35" href="kses_8php.html#a6164e160cf41fb1682f086b13ce434a0" title="wp_kses_bad_protocol" alt="" coords="907,13,1062,39"/><area shape="rect" id="node36" href="kses_8php.html#ac1591c243a4c8272a934db51a9b53259" title="wp_kses_bad_protocol_once" alt="" coords="1125,13,1315,39"/><area shape="rect" id="node37" href="kses_8php.html#a6a97826fbe8f92352f4acc5143cdb0f7" title="wp_kses_bad_protocol\l_once2" alt="" coords="1363,5,1517,47"/><area shape="rect" id="node38" href="kses_8php.html#a6b7c56d4169bffd3e6943c570f4c4b94" title="wp_kses_decode_entities" alt="" coords="1565,13,1736,39"/><area shape="rect" id="node42" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="504,1077,616,1103"/><area shape="rect" id="node43" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="495,1026,625,1053"/><area shape="rect" id="node44" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="719,1001,814,1027"/><area shape="rect" id="node47" href="cache_8php.html#a5051b30effe4731d830d0a838121b867" title="wp_cache_delete" alt="" coords="302,1482,425,1509"/><area shape="rect" id="node49" href="load_8php.html#a49b99067b44a28b2df04dcbd50569624" title="get_current_blog_id" alt="" coords="296,1634,431,1661"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a718607ec4fb72257807ec66ae24b503e_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a718607ec4fb72257807ec66ae24b503e_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a718607ec4fb72257807ec66ae24b503e_icgraph" id="includes_2upgrade_8php_a718607ec4fb72257807ec66ae24b503e_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8d099d53ff8846ac3d0e0ad7069b052b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_350 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute changes made in <a class="el" href="namespace_word_press.html">WordPress</a> 3.5.</p>
<dl class="section since"><dt>Since</dt><dd>3.5.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01189">1189</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="options_8php_source.html#l00208">$name</a>, <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="wp-includes_2post_8php_source.html#l01082">get_post_types()</a>, <a class="el" href="wp-includes_2taxonomy_8php_source.html#l00138">get_taxonomies()</a>, <a class="el" href="wp-includes_2taxonomy_8php_source.html#l00969">get_term_by()</a>, <a class="el" href="wp-includes_2functions_8php_source.html#l03293">is_main_site()</a>, <a class="el" href="admin-ajax_8php_source.html#l00064">str_replace</a>, <a class="el" href="option_8php_source.html#l00214">update_option()</a>, and <a class="el" href="wp-includes_2taxonomy_8php_source.html#l01800">wp_delete_term()</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                       {</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 22006 &amp;&amp; $wpdb-&gt;get_var( <span class="stringliteral">&quot;SELECT link_id FROM $wpdb-&gt;links LIMIT 1&quot;</span> ) )</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        <a class="code" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a>( <span class="stringliteral">&#39;link_manager_enabled&#39;</span>, 1 ); <span class="comment">// Previously set to 0 by populate_options()</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 21811 &amp;&amp; <a class="code" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a>() &amp;&amp; ! defined( <span class="stringliteral">&#39;DO_NOT_UPGRADE_GLOBAL_TABLES&#39;</span> ) ) {</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        $meta_keys = array();</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <span class="keywordflow">foreach</span> ( array_merge( <a class="code" href="wp-includes_2post_8php.html#a608a82c55bc57d0bc9b34888b92212e1">get_post_types</a>(), <a class="code" href="wp-includes_2taxonomy_8php.html#a2564bddeb1e0131321dbaf7e14087265">get_taxonomies</a>() ) as <a class="code" href="options_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> ) {</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;            <span class="keywordflow">if</span> ( <span class="keyword">false</span> !== strpos( $name, <span class="charliteral">&#39;-&#39;</span> ) )</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            $meta_keys[] = <span class="stringliteral">&#39;edit_&#39;</span> . <a class="code" href="admin-ajax_8php.html#a7e2b5c5f59b53e18d1dc6bf6ff251ed2">str_replace</a>( <span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;_&#39;</span>, $name ) . <span class="stringliteral">&#39;_per_page&#39;</span>;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        }</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        <span class="keywordflow">if</span> ( $meta_keys ) {</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            $meta_keys = implode( <span class="stringliteral">&quot;&#39;, &#39;&quot;</span>, $meta_keys );</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;DELETE FROM $wpdb-&gt;usermeta WHERE meta_key IN (&#39;$meta_keys&#39;)&quot;</span> );</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        }</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    }</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 22422 &amp;&amp; $term = <a class="code" href="wp-includes_2taxonomy_8php.html#ab1da12e0f558ba88fb9dedc117650053">get_term_by</a>( <span class="stringliteral">&#39;slug&#39;</span>, <span class="stringliteral">&#39;post-format-standard&#39;</span>, <span class="stringliteral">&#39;post_format&#39;</span> ) )</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        <a class="code" href="wp-includes_2taxonomy_8php.html#ad28d62c01fc8952379351022b765987e">wp_delete_term</a>( $term-&gt;term_id, <span class="stringliteral">&#39;post_format&#39;</span> );</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;}</div>
<div class="ttc" id="option_8php_html_a7c47bc5d444687bebd583e6b5dfc04bc"><div class="ttname"><a href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a></div><div class="ttdeci">update_option($option, $newvalue)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00214">option.php:214</a></div></div>
<div class="ttc" id="wp-includes_2taxonomy_8php_html_ab1da12e0f558ba88fb9dedc117650053"><div class="ttname"><a href="wp-includes_2taxonomy_8php.html#ab1da12e0f558ba88fb9dedc117650053">get_term_by</a></div><div class="ttdeci">get_term_by($field, $value, $taxonomy, $output=OBJECT, $filter= 'raw')</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2taxonomy_8php_source.html#l00969">taxonomy.php:969</a></div></div>
<div class="ttc" id="wp-includes_2taxonomy_8php_html_a2564bddeb1e0131321dbaf7e14087265"><div class="ttname"><a href="wp-includes_2taxonomy_8php.html#a2564bddeb1e0131321dbaf7e14087265">get_taxonomies</a></div><div class="ttdeci">get_taxonomies($args=array(), $output= 'names', $operator= 'and')</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2taxonomy_8php_source.html#l00138">taxonomy.php:138</a></div></div>
<div class="ttc" id="wp-includes_2functions_8php_html_af56ce4c5410aedf5dda37e798124b74a"><div class="ttname"><a href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a></div><div class="ttdeci">is_main_site($site_id=null)</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2functions_8php_source.html#l03293">functions.php:3293</a></div></div>
<div class="ttc" id="wp-includes_2taxonomy_8php_html_ad28d62c01fc8952379351022b765987e"><div class="ttname"><a href="wp-includes_2taxonomy_8php.html#ad28d62c01fc8952379351022b765987e">wp_delete_term</a></div><div class="ttdeci">wp_delete_term($term, $taxonomy, $args=array())</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2taxonomy_8php_source.html#l01800">taxonomy.php:1800</a></div></div>
<div class="ttc" id="admin-ajax_8php_html_a7e2b5c5f59b53e18d1dc6bf6ff251ed2"><div class="ttname"><a href="admin-ajax_8php.html#a7e2b5c5f59b53e18d1dc6bf6ff251ed2">str_replace</a></div><div class="ttdeci">if(!empty($_GET['action'])&amp;&amp;in_array($_GET['action'], $core_actions_get)) add_action( 'wp_ajax_'.$_GET['action'] str_replace( '-', '_', $_GET['action'])</div><div class="ttdef"><b>Definition:</b> <a href="admin-ajax_8php_source.html#l00064">admin-ajax.php:64</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a608a82c55bc57d0bc9b34888b92212e1"><div class="ttname"><a href="wp-includes_2post_8php.html#a608a82c55bc57d0bc9b34888b92212e1">get_post_types</a></div><div class="ttdeci">get_post_types($args=array(), $output= 'names', $operator= 'and')</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l01082">post.php:1082</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
<div class="ttc" id="options_8php_html_ab2fc40d43824ea3e1ce5d86dee0d763b"><div class="ttname"><a href="options_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a></div><div class="ttdeci">$name</div><div class="ttdef"><b>Definition:</b> <a href="options_8php_source.html#l00208">options.php:208</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a8d099d53ff8846ac3d0e0ad7069b052b_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a8d099d53ff8846ac3d0e0ad7069b052b_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a8d099d53ff8846ac3d0e0ad7069b052b_cgraph" id="includes_2upgrade_8php_a8d099d53ff8846ac3d0e0ad7069b052b_cgraph">
<area shape="rect" id="node2" href="wp-includes_2post_8php.html#a608a82c55bc57d0bc9b34888b92212e1" title="get_post_types" alt="" coords="151,148,262,175"/><area shape="rect" id="node6" href="wp-includes_2taxonomy_8php.html#a2564bddeb1e0131321dbaf7e14087265" title="get_taxonomies" alt="" coords="149,291,264,317"/><area shape="rect" id="node7" href="wp-includes_2taxonomy_8php.html#ab1da12e0f558ba88fb9dedc117650053" title="get_term_by" alt="" coords="159,1120,254,1147"/><area shape="rect" id="node21" href="wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a" title="is_main_site" alt="" coords="159,816,254,843"/><area shape="rect" id="node24" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc" title="update_option" alt="" coords="155,525,258,552"/><area shape="rect" id="node42" href="wp-includes_2taxonomy_8php.html#ad28d62c01fc8952379351022b765987e" title="wp_delete_term" alt="" coords="150,1576,263,1603"/><area shape="rect" id="node3" href="wp-includes_2functions_8php.html#ab34fe39d060b41a5eba441a38bc15d60" title="wp_filter_object_list" alt="" coords="330,56,465,83"/><area shape="rect" id="node4" href="wp-includes_2functions_8php.html#aa44843f036fd9002375780aee4d7f325" title="wp_list_filter" alt="" coords="569,5,662,32"/><area shape="rect" id="node5" href="wp-includes_2functions_8php.html#a9c2c031049fe62766774b0bb843647d5" title="wp_list_pluck" alt="" coords="565,56,665,83"/><area shape="rect" id="node8" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="1137,639,1228,665"/><area shape="rect" id="node9" href="wp-includes_2taxonomy_8php.html#a7236b1f5cd8e83a6210bddafb917835b" title="get_term" alt="" coords="361,1120,434,1147"/><area shape="rect" id="node10" href="wp-includes_2taxonomy_8php.html#a16a01a06b9e3eca5ddef6cc18333b4d6" title="sanitize_term" alt="" coords="565,968,665,995"/><area shape="rect" id="node13" href="wp-includes_2taxonomy_8php.html#a5f7e3a6dba12bb44cbe203aefce3ef8d" title="taxonomy_exists" alt="" coords="947,1652,1069,1679"/><area shape="rect" id="node14" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="954,855,1062,881"/><area shape="rect" id="node16" href="class-wp-error_8php.html#a741b5ec807dbba8d2a0851e32e7d926c" title="is_wp_error" alt="" coords="571,1525,659,1552"/><area shape="rect" id="node17" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808" title="sanitize_title" alt="" coords="766,1373,861,1400"/><area shape="rect" id="node19" href="formatting_8php.html#a6dba609f82ebf662ef06615fac81a032" title="wp_unslash" alt="" coords="768,1323,859,1349"/><area shape="rect" id="node15" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="955,715,1061,741"/><area shape="rect" id="node11" href="wp-includes_2taxonomy_8php.html#ad93663de61f9cb44810edc0c761c6ac4" title="sanitize_term_field" alt="" coords="748,968,879,995"/><area shape="rect" id="node12" href="formatting_8php.html#a77a1b666b7ca0e393239a9e1d1af72d3" title="esc_html" alt="" coords="971,613,1045,640"/><area shape="rect" id="node18" href="formatting_8php.html#a05e464b55ec2c8b334abed9864d014e9" title="remove_accents" alt="" coords="950,1348,1066,1375"/><area shape="rect" id="node20" href="formatting_8php.html#a3b974f63529424e457b55f009a795461" title="stripslashes_deep" alt="" coords="945,1297,1071,1324"/><area shape="rect" id="node22" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="964,779,1052,805"/><area shape="rect" id="node23" href="load_8php.html#a49b99067b44a28b2df04dcbd50569624" title="get_current_blog_id" alt="" coords="330,867,465,893"/><area shape="rect" id="node25" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="549,294,682,335"/><area shape="rect" id="node27" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="759,360,868,387"/><area shape="rect" id="node36" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="574,613,657,640"/><area shape="rect" id="node37" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="748,664,879,691"/><area shape="rect" id="node38" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="761,765,866,792"/><area shape="rect" id="node39" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="355,525,440,552"/><area shape="rect" id="node40" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="557,411,673,437"/><area shape="rect" id="node41" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="576,1424,655,1451"/><area shape="rect" id="node26" href="wp-includes_2functions_8php.html#a06d38a93c806c187fd21200c1baa9f53" title="wp_die" alt="" coords="782,229,845,256"/><area shape="rect" id="node28" href="formatting_8php.html#a1a391a56d1c6c0e52239a553a0dbfb73" title="sanitize_email" alt="" coords="955,461,1061,488"/><area shape="rect" id="node29" href="formatting_8php.html#aa394269ea323c88435820bb0a0f5912f" title="is_email" alt="" coords="973,512,1043,539"/><area shape="rect" id="node30" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="967,1221,1049,1248"/><area shape="rect" id="node31" href="wp-admin_2includes_2template_8php.html#ac54155d98db655b34d0c2c87d1e53c64" title="add_settings_error" alt="" coords="943,563,1073,589"/><area shape="rect" id="node32" href="kses_8php.html#aa0817828c22f5e89ff755ae1ad1de60c" title="wp_kses_post" alt="" coords="955,208,1061,235"/><area shape="rect" id="node33" href="kses_8php.html#a050aa6ac503f4f1a2eb655efe9b42dc6" title="wp_kses_data" alt="" coords="955,259,1061,285"/><area shape="rect" id="node34" href="formatting_8php.html#ad9e809b6901d247527672e11ce5d7368" title="esc_url_raw" alt="" coords="963,309,1053,336"/><area shape="rect" id="node35" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332" title="get_available_languages" alt="" coords="927,360,1089,387"/><area shape="rect" id="node43" href="wp-includes_2taxonomy_8php.html#ab018538c65d390d81d99166fa2f7c2e8" title="clean_object_term_cache" alt="" coords="312,1424,483,1451"/><area shape="rect" id="node44" href="wp-includes_2taxonomy_8php.html#aacbbf84cd1b7052520b4663a1cee14d9" title="clean_term_cache" alt="" coords="333,1323,461,1349"/><area shape="rect" id="node45" href="wp-includes_2taxonomy_8php.html#aa73d2fdc1c00f823e31ca7e90f904a5e" title="get_taxonomy" alt="" coords="761,1677,865,1704"/><area shape="rect" id="node46" href="wp-includes_2taxonomy_8php.html#a17ad0f2ad8a5f0b72d2c8221b02ab84c" title="is_taxonomy_hierarchical" alt="" coords="531,1779,700,1805"/><area shape="rect" id="node47" href="wp-includes_2taxonomy_8php.html#a7f1cbda8dbf1ed78826d62cec1fbd7d4" title="term_exists" alt="" coords="570,1576,661,1603"/><area shape="rect" id="node48" href="wp-includes_2taxonomy_8php.html#a19f6a158be4230ff7cd638dfd435f7ef" title="wp_get_object_terms" alt="" coords="543,1829,688,1856"/><area shape="rect" id="node49" href="wp-includes_2functions_8php.html#aa3f6fdf5e7702fdd93e84301ea7987aa" title="wp_parse_args" alt="" coords="759,1880,868,1907"/><area shape="rect" id="node50" href="wp-includes_2taxonomy_8php.html#a584c2ddd3b03a0a3f9c88b9e50cfc7e4" title="wp_set_object_terms" alt="" coords="325,1677,470,1704"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a8d099d53ff8846ac3d0e0ad7069b052b_icgraph.png" border="0" usemap="#includes_2upgrade_8php_a8d099d53ff8846ac3d0e0ad7069b052b_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a8d099d53ff8846ac3d0e0ad7069b052b_icgraph" id="includes_2upgrade_8php_a8d099d53ff8846ac3d0e0ad7069b052b_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="149,5,237,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac5fd71d697cebc747e03eb3f7159bb75"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Functions to be called in install and upgrade scripts.</p>
<p>{ </p>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00330">330</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="version_8php_source.html#l00014">$wp_db_version</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01413">__get_option()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01937">maybe_disable_automattic_widgets()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01954">maybe_disable_link_manager()</a>, <a class="el" href="schema_8php_source.html#l00329">populate_options()</a>, <a class="el" href="option_8php_source.html#l00214">update_option()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00418">upgrade_100()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00471">upgrade_101()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00489">upgrade_110()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00549">upgrade_130()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00631">upgrade_160()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00712">upgrade_210()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00756">upgrade_230()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00944">upgrade_230_old_tables()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00930">upgrade_230_options_table()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00967">upgrade_250()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00981">upgrade_252()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l00992">upgrade_260()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01004">upgrade_270()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01020">upgrade_280()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01047">upgrade_290()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01064">upgrade_300()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01087">upgrade_330()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01156">upgrade_340()</a>, <a class="el" href="includes_2upgrade_8php_source.html#l01189">upgrade_350()</a>, and <a class="el" href="includes_2upgrade_8php_source.html#l00956">upgrade_old_slugs()</a>.</p>
<div class="fragment"><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                       {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    global $wp_current_db_version, <a class="code" href="version_8php.html#a54d5b26d7b1ffa70fc22506a2cfedfea">$wp_db_version</a>;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    $wp_current_db_version = <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;db_version&#39;</span>);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">// We are up-to-date. Nothing to do.</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">if</span> ( $wp_db_version == $wp_current_db_version )</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">// If the version is not set in the DB, try to guess the version.</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">if</span> ( empty($wp_current_db_version) ) {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        $wp_current_db_version = 0;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="comment">// If the template option exists, we have 1.5.</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        $template = <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;template&#39;</span>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="keywordflow">if</span> ( !empty($template) )</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            $wp_current_db_version = 2541;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 6039 )</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a8bbabcdc52ae172d75e457cab5aed16b">upgrade_230_options_table</a>();</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <a class="code" href="schema_8php.html#abcd0383676547c96be6f8bf8208cc545">populate_options</a>();</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 2541 ) {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#ac9f9f0f1c15e3c295fbe0eea4fcad01b">upgrade_100</a>();</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a6e6d4fb5df8f86dc0aafa740bf1dfe60">upgrade_101</a>();</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#afe18c72dcd93806bfefc8bde68fccd8a">upgrade_110</a>();</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#aa1681e2b2e9fc1c0ebaa20a05c278067">upgrade_130</a>();</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 3308 )</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a3fb25174b5e402c9666da33248094bfe">upgrade_160</a>();</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 4772 )</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#aab67ca7d2045305d3847acdc086ffae3">upgrade_210</a>();</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 4351 )</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#af5d2c7b121d8c5a2936b991c31739be7">upgrade_old_slugs</a>();</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 5539 )</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#ae2592de93ead8b5ad27d0c4881f04d4c">upgrade_230</a>();</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 6124 )</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a27bc17575990d42ea587d1473b2344a5">upgrade_230_old_tables</a>();</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 7499 )</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a8de9897e7cf8de14bb1d857f63d7eb31">upgrade_250</a>();</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 7935 )</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#aa067f5e7c95f1f875412140fc6c3b0c6">upgrade_252</a>();</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 8201 )</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#ad54593aefc766c0b0070e2d4d09d9b6b">upgrade_260</a>();</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 8989 )</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a368ab1a3cf990a5d56d850ebf43134e3">upgrade_270</a>();</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 10360 )</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a0070e44c50c79d7fd455a3b1ea6f13d9">upgrade_280</a>();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 11958 )</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a657edc069a4c61d359944a04164a7ee3">upgrade_290</a>();</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 15260 )</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a5b4be04ded870faab3352e69cb616b04">upgrade_300</a>();</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 19389 )</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a308cd978af2b74dfdf5ebfac83df9b3e">upgrade_330</a>();</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 20080 )</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a718607ec4fb72257807ec66ae24b503e">upgrade_340</a>();</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 22422 )</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a8d099d53ff8846ac3d0e0ad7069b052b">upgrade_350</a>();</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#abcaf2c635c689728811b6cadec1ba7c7">maybe_disable_link_manager</a>();</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#a1fb4ce36d884c19a927a8f6d0c9128a3">maybe_disable_automattic_widgets</a>();</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <a class="code" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a>( <span class="stringliteral">&#39;db_version&#39;</span>, $wp_db_version );</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <a class="code" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a>( <span class="stringliteral">&#39;db_upgraded&#39;</span>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;}</div>
<div class="ttc" id="includes_2upgrade_8php_html_abcaf2c635c689728811b6cadec1ba7c7"><div class="ttname"><a href="includes_2upgrade_8php.html#abcaf2c635c689728811b6cadec1ba7c7">maybe_disable_link_manager</a></div><div class="ttdeci">maybe_disable_link_manager()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01954">upgrade.php:1954</a></div></div>
<div class="ttc" id="option_8php_html_a7c47bc5d444687bebd583e6b5dfc04bc"><div class="ttname"><a href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc">update_option</a></div><div class="ttdeci">update_option($option, $newvalue)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00214">option.php:214</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_ad54593aefc766c0b0070e2d4d09d9b6b"><div class="ttname"><a href="includes_2upgrade_8php.html#ad54593aefc766c0b0070e2d4d09d9b6b">upgrade_260</a></div><div class="ttdeci">upgrade_260()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00992">upgrade.php:992</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a913d174175f69bd5da3dba3288acc2b1"><div class="ttname"><a href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a></div><div class="ttdeci">__get_option($setting)</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01413">upgrade.php:1413</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a308cd978af2b74dfdf5ebfac83df9b3e"><div class="ttname"><a href="includes_2upgrade_8php.html#a308cd978af2b74dfdf5ebfac83df9b3e">upgrade_330</a></div><div class="ttdeci">upgrade_330()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01087">upgrade.php:1087</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_aa1681e2b2e9fc1c0ebaa20a05c278067"><div class="ttname"><a href="includes_2upgrade_8php.html#aa1681e2b2e9fc1c0ebaa20a05c278067">upgrade_130</a></div><div class="ttdeci">upgrade_130()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00549">upgrade.php:549</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a5b4be04ded870faab3352e69cb616b04"><div class="ttname"><a href="includes_2upgrade_8php.html#a5b4be04ded870faab3352e69cb616b04">upgrade_300</a></div><div class="ttdeci">upgrade_300()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01064">upgrade.php:1064</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a27bc17575990d42ea587d1473b2344a5"><div class="ttname"><a href="includes_2upgrade_8php.html#a27bc17575990d42ea587d1473b2344a5">upgrade_230_old_tables</a></div><div class="ttdeci">upgrade_230_old_tables()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00944">upgrade.php:944</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a657edc069a4c61d359944a04164a7ee3"><div class="ttname"><a href="includes_2upgrade_8php.html#a657edc069a4c61d359944a04164a7ee3">upgrade_290</a></div><div class="ttdeci">upgrade_290()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01047">upgrade.php:1047</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a8de9897e7cf8de14bb1d857f63d7eb31"><div class="ttname"><a href="includes_2upgrade_8php.html#a8de9897e7cf8de14bb1d857f63d7eb31">upgrade_250</a></div><div class="ttdeci">upgrade_250()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00967">upgrade.php:967</a></div></div>
<div class="ttc" id="schema_8php_html_abcd0383676547c96be6f8bf8208cc545"><div class="ttname"><a href="schema_8php.html#abcd0383676547c96be6f8bf8208cc545">populate_options</a></div><div class="ttdeci">populate_options()</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00329">schema.php:329</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_af5d2c7b121d8c5a2936b991c31739be7"><div class="ttname"><a href="includes_2upgrade_8php.html#af5d2c7b121d8c5a2936b991c31739be7">upgrade_old_slugs</a></div><div class="ttdeci">upgrade_old_slugs()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00956">upgrade.php:956</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_aab67ca7d2045305d3847acdc086ffae3"><div class="ttname"><a href="includes_2upgrade_8php.html#aab67ca7d2045305d3847acdc086ffae3">upgrade_210</a></div><div class="ttdeci">upgrade_210()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00712">upgrade.php:712</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a368ab1a3cf990a5d56d850ebf43134e3"><div class="ttname"><a href="includes_2upgrade_8php.html#a368ab1a3cf990a5d56d850ebf43134e3">upgrade_270</a></div><div class="ttdeci">upgrade_270()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01004">upgrade.php:1004</a></div></div>
<div class="ttc" id="version_8php_html_a54d5b26d7b1ffa70fc22506a2cfedfea"><div class="ttname"><a href="version_8php.html#a54d5b26d7b1ffa70fc22506a2cfedfea">$wp_db_version</a></div><div class="ttdeci">$wp_db_version</div><div class="ttdef"><b>Definition:</b> <a href="version_8php_source.html#l00014">version.php:14</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a8bbabcdc52ae172d75e457cab5aed16b"><div class="ttname"><a href="includes_2upgrade_8php.html#a8bbabcdc52ae172d75e457cab5aed16b">upgrade_230_options_table</a></div><div class="ttdeci">upgrade_230_options_table()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00930">upgrade.php:930</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a718607ec4fb72257807ec66ae24b503e"><div class="ttname"><a href="includes_2upgrade_8php.html#a718607ec4fb72257807ec66ae24b503e">upgrade_340</a></div><div class="ttdeci">upgrade_340()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01156">upgrade.php:1156</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a6e6d4fb5df8f86dc0aafa740bf1dfe60"><div class="ttname"><a href="includes_2upgrade_8php.html#a6e6d4fb5df8f86dc0aafa740bf1dfe60">upgrade_101</a></div><div class="ttdeci">upgrade_101()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00471">upgrade.php:471</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_afe18c72dcd93806bfefc8bde68fccd8a"><div class="ttname"><a href="includes_2upgrade_8php.html#afe18c72dcd93806bfefc8bde68fccd8a">upgrade_110</a></div><div class="ttdeci">upgrade_110()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00489">upgrade.php:489</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_aa067f5e7c95f1f875412140fc6c3b0c6"><div class="ttname"><a href="includes_2upgrade_8php.html#aa067f5e7c95f1f875412140fc6c3b0c6">upgrade_252</a></div><div class="ttdeci">upgrade_252()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00981">upgrade.php:981</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a1fb4ce36d884c19a927a8f6d0c9128a3"><div class="ttname"><a href="includes_2upgrade_8php.html#a1fb4ce36d884c19a927a8f6d0c9128a3">maybe_disable_automattic_widgets</a></div><div class="ttdeci">maybe_disable_automattic_widgets()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01937">upgrade.php:1937</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_ae2592de93ead8b5ad27d0c4881f04d4c"><div class="ttname"><a href="includes_2upgrade_8php.html#ae2592de93ead8b5ad27d0c4881f04d4c">upgrade_230</a></div><div class="ttdeci">upgrade_230()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00756">upgrade.php:756</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_ac9f9f0f1c15e3c295fbe0eea4fcad01b"><div class="ttname"><a href="includes_2upgrade_8php.html#ac9f9f0f1c15e3c295fbe0eea4fcad01b">upgrade_100</a></div><div class="ttdeci">upgrade_100()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00418">upgrade.php:418</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a0070e44c50c79d7fd455a3b1ea6f13d9"><div class="ttname"><a href="includes_2upgrade_8php.html#a0070e44c50c79d7fd455a3b1ea6f13d9">upgrade_280</a></div><div class="ttdeci">upgrade_280()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01020">upgrade.php:1020</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a8d099d53ff8846ac3d0e0ad7069b052b"><div class="ttname"><a href="includes_2upgrade_8php.html#a8d099d53ff8846ac3d0e0ad7069b052b">upgrade_350</a></div><div class="ttdeci">upgrade_350()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01189">upgrade.php:1189</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a3fb25174b5e402c9666da33248094bfe"><div class="ttname"><a href="includes_2upgrade_8php.html#a3fb25174b5e402c9666da33248094bfe">upgrade_160</a></div><div class="ttdeci">upgrade_160()</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00631">upgrade.php:631</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_ac5fd71d697cebc747e03eb3f7159bb75_cgraph.png" border="0" usemap="#includes_2upgrade_8php_ac5fd71d697cebc747e03eb3f7159bb75_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_ac5fd71d697cebc747e03eb3f7159bb75_cgraph" id="includes_2upgrade_8php_ac5fd71d697cebc747e03eb3f7159bb75_cgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1" title="__get_option" alt="" coords="583,851,679,878"/><area shape="rect" id="node5" href="includes_2upgrade_8php.html#a1fb4ce36d884c19a927a8f6d0c9128a3" title="maybe_disable_automattic\l_widgets" alt="" coords="352,840,529,881"/><area shape="rect" id="node6" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc" title="update_option" alt="" coords="579,531,682,558"/><area shape="rect" id="node19" href="includes_2upgrade_8php.html#abcaf2c635c689728811b6cadec1ba7c7" title="maybe_disable_link\l_manager" alt="" coords="373,111,509,152"/><area shape="rect" id="node20" href="schema_8php.html#abcd0383676547c96be6f8bf8208cc545" title="populate_options" alt="" coords="381,1007,501,1034"/><area shape="rect" id="node24" href="includes_2upgrade_8php.html#ac9f9f0f1c15e3c295fbe0eea4fcad01b" title="upgrade_100" alt="" coords="393,333,489,359"/><area shape="rect" id="node26" href="includes_2upgrade_8php.html#a6e6d4fb5df8f86dc0aafa740bf1dfe60" title="upgrade_101" alt="" coords="175,1109,271,1135"/><area shape="rect" id="node28" href="includes_2upgrade_8php.html#afe18c72dcd93806bfefc8bde68fccd8a" title="upgrade_110" alt="" coords="393,687,489,714"/><area shape="rect" id="node30" href="includes_2upgrade_8php.html#aa1681e2b2e9fc1c0ebaa20a05c278067" title="upgrade_130" alt="" coords="175,611,271,638"/><area shape="rect" id="node34" href="includes_2upgrade_8php.html#a3fb25174b5e402c9666da33248094bfe" title="upgrade_160" alt="" coords="175,1159,271,1186"/><area shape="rect" id="node36" href="includes_2upgrade_8php.html#aab67ca7d2045305d3847acdc086ffae3" title="upgrade_210" alt="" coords="175,1210,271,1237"/><area shape="rect" id="node37" href="includes_2upgrade_8php.html#ae2592de93ead8b5ad27d0c4881f04d4c" title="upgrade_230" alt="" coords="393,383,489,410"/><area shape="rect" id="node38" href="includes_2upgrade_8php.html#a27bc17575990d42ea587d1473b2344a5" title="upgrade_230_old_tables" alt="" coords="141,1261,304,1287"/><area shape="rect" id="node39" href="includes_2upgrade_8php.html#a8bbabcdc52ae172d75e457cab5aed16b" title="upgrade_230_options\l_table" alt="" coords="150,1312,295,1353"/><area shape="rect" id="node40" href="includes_2upgrade_8php.html#a8de9897e7cf8de14bb1d857f63d7eb31" title="upgrade_250" alt="" coords="175,1378,271,1405"/><area shape="rect" id="node41" href="includes_2upgrade_8php.html#aa067f5e7c95f1f875412140fc6c3b0c6" title="upgrade_252" alt="" coords="175,1429,271,1455"/><area shape="rect" id="node42" href="includes_2upgrade_8php.html#ad54593aefc766c0b0070e2d4d09d9b6b" title="upgrade_260" alt="" coords="175,1479,271,1506"/><area shape="rect" id="node43" href="includes_2upgrade_8php.html#a368ab1a3cf990a5d56d850ebf43134e3" title="upgrade_270" alt="" coords="175,1530,271,1557"/><area shape="rect" id="node44" href="includes_2upgrade_8php.html#a0070e44c50c79d7fd455a3b1ea6f13d9" title="upgrade_280" alt="" coords="393,906,489,933"/><area shape="rect" id="node45" href="includes_2upgrade_8php.html#a657edc069a4c61d359944a04164a7ee3" title="upgrade_290" alt="" coords="393,59,489,86"/><area shape="rect" id="node46" href="includes_2upgrade_8php.html#a5b4be04ded870faab3352e69cb616b04" title="upgrade_300" alt="" coords="749,1257,845,1283"/><area shape="rect" id="node47" href="includes_2upgrade_8php.html#a308cd978af2b74dfdf5ebfac83df9b3e" title="upgrade_330" alt="" coords="393,282,489,309"/><area shape="rect" id="node48" href="includes_2upgrade_8php.html#a718607ec4fb72257807ec66ae24b503e" title="upgrade_340" alt="" coords="583,722,679,749"/><area shape="rect" id="node49" href="includes_2upgrade_8php.html#a8d099d53ff8846ac3d0e0ad7069b052b" title="upgrade_350" alt="" coords="175,535,271,562"/><area shape="rect" id="node50" href="includes_2upgrade_8php.html#af5d2c7b121d8c5a2936b991c31739be7" title="upgrade_old_slugs" alt="" coords="157,1581,288,1607"/><area shape="rect" id="node3" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="1092,902,1223,929"/><area shape="rect" id="node4" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="1101,1003,1213,1030"/><area shape="rect" id="node7" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="911,735,1044,776"/><area shape="rect" id="node8" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="923,329,1032,355"/><area shape="rect" id="node10" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="1112,329,1203,355"/><area shape="rect" id="node11" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="936,633,1019,659"/><area shape="rect" id="node12" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="1271,582,1376,609"/><area shape="rect" id="node13" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="1092,742,1223,769"/><area shape="rect" id="node15" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="1105,582,1210,609"/><area shape="rect" id="node16" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="755,633,840,659"/><area shape="rect" id="node17" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="919,481,1035,507"/><area shape="rect" id="node18" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="938,851,1017,878"/><area shape="rect" id="node9" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="1116,101,1199,127"/><area shape="rect" id="node14" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="1279,1181,1367,1207"/><area shape="rect" id="node21" href="option_8php.html#a44451bc2bc382b2c24f4baeef80a3714" title="delete_option" alt="" coords="748,902,847,929"/><area shape="rect" id="node22" href="wp-includes_2theme_8php.html#a930e87e99fca734cbd2913800e7bcf4d" title="wp_get_theme" alt="" coords="577,1054,684,1081"/><area shape="rect" id="node23" href="load-scripts_8php.html#a371846605f59defff0f8d8ef2bf0cc06" title="wp_guess_url" alt="" coords="580,1105,681,1131"/><area shape="rect" id="node25" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808" title="sanitize_title" alt="" coords="583,358,678,385"/><area shape="rect" id="node27" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4" title="add_clean_index" alt="" coords="381,1109,500,1135"/><area shape="rect" id="node29" href="includes_2upgrade_8php.html#a0a23ab0934c3f2e5618f931a4ea4c483" title="get_alloptions_110" alt="" coords="732,953,863,979"/><area shape="rect" id="node31" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336" title="deslash" alt="" coords="407,586,474,613"/><area shape="rect" id="node32" href="link-template_8php.html#a79b798d609e7c891cee471adea3a2376" title="get_permalink" alt="" coords="926,177,1029,203"/><area shape="rect" id="node33" href="includes_2upgrade_8php.html#aabe08bc33812c096cbe094c1fa7c95ef" title="make_site_theme" alt="" coords="378,535,503,562"/><area shape="rect" id="node35" href="wp-includes_2post_8php.html#a5ac8d9eefeeb2ac8b45650a335971b81" title="get_post_meta" alt="" coords="387,1159,495,1186"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab30e0db0ffe1bede090b8e6b8f116db9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_network </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute network level changes</p>
<dl class="section since"><dt>Since</dt><dd>3.0.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01216">1216</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="theme-editor_8php_source.html#l00051">$stylesheet</a>, <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, <a class="el" href="option_8php_source.html#l00869">delete_site_option()</a>, <a class="el" href="option_8php_source.html#l00753">get_site_option()</a>, <a class="el" href="option_8php_source.html#l00912">update_site_option()</a>, and <a class="el" href="wp-includes_2theme_8php_source.html#l00027">wp_get_themes()</a>.</p>
<div class="fragment"><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                           {</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="comment">// 2.8</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 11549 ) {</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        $wpmu_sitewide_plugins = <a class="code" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa">get_site_option</a>( <span class="stringliteral">&#39;wpmu_sitewide_plugins&#39;</span> );</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        $active_sitewide_plugins = <a class="code" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa">get_site_option</a>( <span class="stringliteral">&#39;active_sitewide_plugins&#39;</span> );</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        <span class="keywordflow">if</span> ( $wpmu_sitewide_plugins ) {</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;            <span class="keywordflow">if</span> ( !$active_sitewide_plugins )</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;                $sitewide_plugins = (array) $wpmu_sitewide_plugins;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;                $sitewide_plugins = array_merge( (array) $active_sitewide_plugins, (array) $wpmu_sitewide_plugins );</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;            <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;active_sitewide_plugins&#39;</span>, $sitewide_plugins );</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        }</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <a class="code" href="option_8php.html#a7e3ba182891821061bdf3aa08b0895fd">delete_site_option</a>( <span class="stringliteral">&#39;wpmu_sitewide_plugins&#39;</span> );</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <a class="code" href="option_8php.html#a7e3ba182891821061bdf3aa08b0895fd">delete_site_option</a>( <span class="stringliteral">&#39;deactivated_sitewide_plugins&#39;</span> );</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        $start = 0;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <span class="keywordflow">while</span>( $rows = $wpdb-&gt;get_results( <span class="stringliteral">&quot;SELECT meta_key, meta_value FROM {$wpdb-&gt;sitemeta} ORDER BY meta_id LIMIT $start, 20&quot;</span> ) ) {</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;            <span class="keywordflow">foreach</span>( $rows as $row ) {</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;                $value = $row-&gt;meta_value;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                <span class="keywordflow">if</span> ( !@unserialize( $value ) )</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;                    $value = stripslashes( $value );</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;                <span class="keywordflow">if</span> ( $value !== $row-&gt;meta_value ) {</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                    <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( $row-&gt;meta_key, $value );</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                }</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;            }</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;            $start += 20;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        }</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    }</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="comment">// 3.0</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 13576 )</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;        <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;global_terms_enabled&#39;</span>, <span class="charliteral">&#39;1&#39;</span> );</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="comment">// 3.3</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 19390 )</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;initial_db_version&#39;</span>, $wp_current_db_version );</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 19470 ) {</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        <span class="keywordflow">if</span> ( <span class="keyword">false</span> === <a class="code" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa">get_site_option</a>( <span class="stringliteral">&#39;active_sitewide_plugins&#39;</span> ) )</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;            <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;active_sitewide_plugins&#39;</span>, array() );</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    }</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="comment">// 3.4</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 20148 ) {</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        <span class="comment">// &#39;allowedthemes&#39; keys things by stylesheet. &#39;allowed_themes&#39; keyed things by name.</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        $allowedthemes  = <a class="code" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa">get_site_option</a>( <span class="stringliteral">&#39;allowedthemes&#39;</span>  );</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        $allowed_themes = <a class="code" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa">get_site_option</a>( <span class="stringliteral">&#39;allowed_themes&#39;</span> );</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        <span class="keywordflow">if</span> ( <span class="keyword">false</span> === $allowedthemes &amp;&amp; is_array( $allowed_themes ) &amp;&amp; $allowed_themes ) {</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;            $converted = array();</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;            $themes = <a class="code" href="wp-includes_2theme_8php.html#ad028eec53a1a467937aedb9b38db9524">wp_get_themes</a>();</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;            <span class="keywordflow">foreach</span> ( $themes as <a class="code" href="theme-editor_8php.html#aa81e52c2f5a3428bd01f6bb37483d2ed">$stylesheet</a> =&gt; $theme_data ) {</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                <span class="keywordflow">if</span> ( isset( $allowed_themes[ $theme_data-&gt;get(<span class="stringliteral">&#39;Name&#39;</span>) ] ) )</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                    $converted[ <a class="code" href="theme-editor_8php.html#aa81e52c2f5a3428bd01f6bb37483d2ed">$stylesheet</a> ] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;            }</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;            <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;allowedthemes&#39;</span>, $converted );</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;            <a class="code" href="option_8php.html#a7e3ba182891821061bdf3aa08b0895fd">delete_site_option</a>( <span class="stringliteral">&#39;allowed_themes&#39;</span> );</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        }</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    }</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <span class="comment">// 3.5</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 21823 )</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;ms_files_rewriting&#39;</span>, <span class="charliteral">&#39;1&#39;</span> );</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    <span class="comment">// 3.5.2</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 24448 ) {</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        $illegal_names = <a class="code" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa">get_site_option</a>( <span class="stringliteral">&#39;illegal_names&#39;</span> );</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        <span class="keywordflow">if</span> ( is_array( $illegal_names ) &amp;&amp; count( $illegal_names ) === 1 ) {</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;            $illegal_name = reset( $illegal_names );</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;            $illegal_names = explode( <span class="charliteral">&#39; &#39;</span>, $illegal_name );</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;            <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;illegal_names&#39;</span>, $illegal_names );</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        }</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    }</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;}</div>
<div class="ttc" id="option_8php_html_a2a460377f0ab22fe938a0937c8fb17fa"><div class="ttname"><a href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa">get_site_option</a></div><div class="ttdeci">get_site_option($option, $default=false, $use_cache=true)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00753">option.php:753</a></div></div>
<div class="ttc" id="option_8php_html_a7e3ba182891821061bdf3aa08b0895fd"><div class="ttname"><a href="option_8php.html#a7e3ba182891821061bdf3aa08b0895fd">delete_site_option</a></div><div class="ttdeci">delete_site_option($option)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00869">option.php:869</a></div></div>
<div class="ttc" id="theme-editor_8php_html_aa81e52c2f5a3428bd01f6bb37483d2ed"><div class="ttname"><a href="theme-editor_8php.html#aa81e52c2f5a3428bd01f6bb37483d2ed">$stylesheet</a></div><div class="ttdeci">else $stylesheet</div><div class="ttdef"><b>Definition:</b> <a href="theme-editor_8php_source.html#l00051">theme-editor.php:51</a></div></div>
<div class="ttc" id="option_8php_html_a7ffd65e258601322158dc39ee84b3121"><div class="ttname"><a href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a></div><div class="ttdeci">update_site_option($option, $value)</div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00912">option.php:912</a></div></div>
<div class="ttc" id="wp-includes_2theme_8php_html_ad028eec53a1a467937aedb9b38db9524"><div class="ttname"><a href="wp-includes_2theme_8php.html#ad028eec53a1a467937aedb9b38db9524">wp_get_themes</a></div><div class="ttdeci">wp_get_themes($args=array())</div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2theme_8php_source.html#l00027">theme.php:27</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_ab30e0db0ffe1bede090b8e6b8f116db9_cgraph.png" border="0" usemap="#includes_2upgrade_8php_ab30e0db0ffe1bede090b8e6b8f116db9_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_ab30e0db0ffe1bede090b8e6b8f116db9_cgraph" id="includes_2upgrade_8php_ab30e0db0ffe1bede090b8e6b8f116db9_cgraph">
<area shape="rect" id="node2" href="option_8php.html#a7e3ba182891821061bdf3aa08b0895fd" title="delete_site_option" alt="" coords="1332,2275,1459,2302"/><area shape="rect" id="node16" href="option_8php.html#a2a460377f0ab22fe938a0937c8fb17fa" title="get_site_option" alt="" coords="1525,2022,1636,2049"/><area shape="rect" id="node21" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121" title="update_site_option" alt="" coords="1133,1211,1264,1238"/><area shape="rect" id="node35" href="wp-includes_2theme_8php.html#ad028eec53a1a467937aedb9b38db9524" title="wp_get_themes" alt="" coords="173,1738,287,1765"/><area shape="rect" id="node3" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc" title="do_action" alt="" coords="1726,1642,1805,1669"/><area shape="rect" id="node5" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af" title="is_multisite" alt="" coords="2101,2351,2189,2378"/><area shape="rect" id="node6" href="option_8php.html#a44451bc2bc382b2c24f4baeef80a3714" title="delete_option" alt="" coords="1531,2123,1630,2150"/><area shape="rect" id="node15" href="cache_8php.html#a5051b30effe4731d830d0a838121b867" title="wp_cache_delete" alt="" coords="1704,2250,1827,2277"/><area shape="rect" id="node4" href="wp-includes_2plugin_8php.html#af891e88ab346a2da31111facfcf6b2cf" title="_wp_call_all_hook" alt="" coords="1898,1642,2025,1669"/><area shape="rect" id="node7" href="option_8php.html#a14e2fdc9d3820ce05d908085036ab590" title="wp_protect_special\l_option" alt="" coords="1699,1052,1832,1093"/><area shape="rect" id="node11" href="option_8php.html#aeff01ba12b3fd6f81d3235d4f39a0963" title="wp_load_alloptions" alt="" coords="1896,2149,2027,2175"/><area shape="rect" id="node14" href="cache_8php.html#a6bee95fa01e871fb41c0f8b5fef71265" title="wp_cache_set" alt="" coords="1909,1566,2014,1593"/><area shape="rect" id="node8" href="wp-includes_2functions_8php.html#a06d38a93c806c187fd21200c1baa9f53" title="wp_die" alt="" coords="1930,983,1993,1010"/><area shape="rect" id="node10" href="formatting_8php.html#a77a1b666b7ca0e393239a9e1d1af72d3" title="esc_html" alt="" coords="1924,806,1999,833"/><area shape="rect" id="node9" href="load-scripts_8php.html#a54639394aa645a2277ea41f3cbd23247" title="apply_filters" alt="" coords="2099,527,2190,554"/><area shape="rect" id="node12" href="cache_8php.html#a52d28494b9cb573cc6e70fb1443bc0d9" title="wp_cache_get" alt="" coords="2092,1971,2197,1998"/><area shape="rect" id="node13" href="cache_8php.html#ac8a445bf911474acff976c696058ec1a" title="wp_cache_add" alt="" coords="2091,2123,2199,2150"/><area shape="rect" id="node17" href="option_8php.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c" title="get_option" alt="" coords="1724,1895,1807,1922"/><area shape="rect" id="node19" href="wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4" title="maybe_unserialize" alt="" coords="1896,1845,2027,1871"/><area shape="rect" id="node18" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72" title="untrailingslashit" alt="" coords="1905,1895,2017,1922"/><area shape="rect" id="node20" href="wp-includes_2functions_8php.html#a72356a96b9449d3b2acd81b36cfc5c45" title="is_serialized" alt="" coords="2097,1554,2192,1581"/><area shape="rect" id="node22" href="option_8php.html#a2c2c039acbd1f0ddc4063fbcfb11b3a2" title="add_site_option" alt="" coords="1339,1363,1452,1390"/><area shape="rect" id="node24" href="formatting_8php.html#aec1146dad5e11a514cf39ac8857fff84" title="sanitize_option" alt="" coords="1711,451,1820,478"/><area shape="rect" id="node33" href="wp-includes_2functions_8php.html#a1bace460c1029f9db159014e197b0744" title="maybe_serialize" alt="" coords="1707,1262,1823,1289"/><area shape="rect" id="node34" href="option_8php.html#a7c47bc5d444687bebd583e6b5dfc04bc" title="update_option" alt="" coords="1344,1490,1447,1517"/><area shape="rect" id="node23" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494" title="add_option" alt="" coords="1538,1465,1623,1491"/><area shape="rect" id="node25" href="formatting_8php.html#a1a391a56d1c6c0e52239a553a0dbfb73" title="sanitize_email" alt="" coords="1909,299,2014,326"/><area shape="rect" id="node26" href="formatting_8php.html#aa394269ea323c88435820bb0a0f5912f" title="is_email" alt="" coords="1926,350,1997,377"/><area shape="rect" id="node27" href="load-scripts_8php.html#aaf1220eff85fdd291725eabf743b2ed3" title="get_option" alt="" coords="1920,654,2003,681"/><area shape="rect" id="node28" href="wp-admin_2includes_2template_8php.html#ac54155d98db655b34d0c2c87d1e53c64" title="add_settings_error" alt="" coords="1897,401,2026,427"/><area shape="rect" id="node29" href="kses_8php.html#aa0817828c22f5e89ff755ae1ad1de60c" title="wp_kses_post" alt="" coords="1909,451,2014,478"/><area shape="rect" id="node30" href="kses_8php.html#a050aa6ac503f4f1a2eb655efe9b42dc6" title="wp_kses_data" alt="" coords="1909,502,2014,529"/><area shape="rect" id="node31" href="formatting_8php.html#ad9e809b6901d247527672e11ce5d7368" title="esc_url_raw" alt="" coords="1916,553,2007,579"/><area shape="rect" id="node32" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332" title="get_available_languages" alt="" coords="1880,603,2043,630"/><area shape="rect" id="node36" href="class_w_p___theme.html#acb15582c6f903e3d5a66c720b24cc432" title="WP_Theme\\get_allowed" alt="" coords="692,173,855,199"/><area shape="rect" id="node37" href="class_w_p___theme.html#ae854e38cc1bd61933ea9671da8e94000" title="WP_Theme\\get_allowed\l_on_network" alt="" coords="907,2131,1069,2172"/><area shape="rect" id="node38" href="class_w_p___theme.html#a06745c488c314b6bbb2b66fc2f96dc29" title="WP_Theme\\get_allowed\l_on_site" alt="" coords="1117,1761,1280,1803"/><area shape="rect" id="node43" href="wp-includes_2theme_8php.html#a34248f5671bdfca1d7480501e82b97f5" title="get_raw_theme_root" alt="" coords="335,1706,473,1733"/><area shape="rect" id="node46" href="wp-includes_2theme_8php.html#a20dcd9008e0bc3bd2d08b3d0374fd71d" title="search_theme_directories" alt="" coords="688,1655,859,1682"/><area shape="rect" id="node48" href="wp-includes_2theme_8php.html#a6d9dd71b2ef87985d6a908cdcbf99f9a" title="get_stylesheet" alt="" coords="1712,350,1819,377"/><area shape="rect" id="node49" href="wp-includes_2functions_8php.html#aa3f6fdf5e7702fdd93e84301ea7987aa" title="wp_parse_args" alt="" coords="349,299,459,326"/><area shape="rect" id="node39" href="load_8php.html#a49b99067b44a28b2df04dcbd50569624" title="get_current_blog_id" alt="" coords="1328,2022,1463,2049"/><area shape="rect" id="node40" href="ms-blogs_8php.html#ad7c90de7a9734c0cf051edff556efcee" title="switch_to_blog" alt="" coords="1527,1971,1635,1998"/><area shape="rect" id="node41" href="ms-blogs_8php.html#aa6ec3a2b8c0ff571962ccc9bcdb82ced" title="restore_current_blog" alt="" coords="1511,1870,1651,1897"/><area shape="rect" id="node42" href="load-scripts_8php.html#a0b327581800dba50ad70720e23ae2ed2" title="is_admin" alt="" coords="1358,1971,1433,1998"/><area shape="rect" id="node44" href="wp-includes_2theme_8php.html#a35eb3726dc115173daf72cb391164c97" title="get_theme_roots" alt="" coords="521,1706,640,1733"/><area shape="rect" id="node45" href="option_8php.html#ababa2424b834614908fbd0c9e97783f6" title="get_site_transient" alt="" coords="1136,2123,1261,2150"/><area shape="rect" id="node47" href="option_8php.html#abb01837a781b0f4f98d06284203b8e81" title="set_site_transient" alt="" coords="925,1617,1051,1643"/><area shape="rect" id="node50" href="formatting_8php.html#a17647ed96ed8c87e16b1af5b63fb2cb8" title="wp_parse_str" alt="" coords="531,122,630,149"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af5d2c7b121d8c5a2936b991c31739be7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">upgrade_old_slugs </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Upgrade old slugs made in version 2.2.</p>
<dl class="section since"><dt>Since</dt><dd>2.2.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00956">956</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00330">upgrade_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                             {</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="comment">// upgrade people who were using the Redirect Old Slugs plugin</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;postmeta SET meta_key = &#39;_wp_old_slug&#39; WHERE meta_key = &#39;old_slug&#39;&quot;</span>);</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;}</div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_af5d2c7b121d8c5a2936b991c31739be7_icgraph.png" border="0" usemap="#includes_2upgrade_8php_af5d2c7b121d8c5a2936b991c31739be7_icgraph" alt=""/></div>
<map name="includes_2upgrade_8php_af5d2c7b121d8c5a2936b991c31739be7_icgraph" id="includes_2upgrade_8php_af5d2c7b121d8c5a2936b991c31739be7_icgraph">
<area shape="rect" id="node2" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75" title="upgrade_all" alt="" coords="184,5,272,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2559abc904c6b5dacc954e4589d450a2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">wp_check_mysql_version </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>{ </p>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l01925">1925</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>References <a class="el" href="schema_8php_source.html#l00012">$wpdb</a>, and <a class="el" href="class-wp-error_8php_source.html#l00204">is_wp_error()</a>.</p>
<div class="fragment"><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;                                  {</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    $result = $wpdb-&gt;check_database_version();</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="class-wp-error_8php.html#a741b5ec807dbba8d2a0851e32e7d926c">is_wp_error</a>( $result ) )</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;        die( $result-&gt;get_error_message() );</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;}</div>
<div class="ttc" id="class-wp-error_8php_html_a741b5ec807dbba8d2a0851e32e7d926c"><div class="ttname"><a href="class-wp-error_8php.html#a741b5ec807dbba8d2a0851e32e7d926c">is_wp_error</a></div><div class="ttdeci">is_wp_error($thing)</div><div class="ttdef"><b>Definition:</b> <a href="class-wp-error_8php_source.html#l00204">class-wp-error.php:204</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00012">schema.php:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="includes_2upgrade_8php_a2559abc904c6b5dacc954e4589d450a2_cgraph.png" border="0" usemap="#includes_2upgrade_8php_a2559abc904c6b5dacc954e4589d450a2_cgraph" alt=""/></div>
<map name="includes_2upgrade_8php_a2559abc904c6b5dacc954e4589d450a2_cgraph" id="includes_2upgrade_8php_a2559abc904c6b5dacc954e4589d450a2_cgraph">
<area shape="rect" id="node2" href="class-wp-error_8php.html#a741b5ec807dbba8d2a0851e32e7d926c" title="is_wp_error" alt="" coords="223,5,311,32"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="aad8d91e6a86c1c561f1ed66bc19e5a63"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="xmlrpc_8php.html#a2167f8b1a4e7f342493af006894c9036">if</a> ( !function_exists( 'install_global_terms' ) ) () endif</td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="namespace_word_press.html">WordPress</a> Administration API <a class="el" href="namespace_word_press.html">WordPress</a> Schema API</p>
<p>Install global terms.</p>
<dl class="section since"><dt>Since</dt><dd>3.0.0 </dd></dl>

<p>Definition at line <a class="el" href="includes_2upgrade_8php_source.html#l00021">21</a> of file <a class="el" href="includes_2upgrade_8php_source.html">upgrade.php</a>.</p>

<p>Referenced by <a class="el" href="includes_2upgrade_8php_source.html#l00418">upgrade_100()</a>, and <a class="el" href="includes_2upgrade_8php_source.html#l00631">upgrade_160()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_79890bca8fbc0ee2b6546e46598bfe95.html">WordPress</a></li><li class="navelem"><a class="el" href="dir_f92dd464cb6663caef516a3718975864.html">wp-admin</a></li><li class="navelem"><a class="el" href="dir_cdf65898bd0a1d0be54dc05819c3d264.html">includes</a></li><li class="navelem"><a class="el" href="includes_2upgrade_8php.html">upgrade.php</a></li>
    <li class="footer">Generated on Fri Nov 21 2014 10:28:13 for My Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
